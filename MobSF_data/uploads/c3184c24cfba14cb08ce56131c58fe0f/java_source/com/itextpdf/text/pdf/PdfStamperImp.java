/*
 * Decompiled with CFR 0_132.
 */
package com.itextpdf.text.pdf;

import com.itextpdf.awt.geom.Point;
import com.itextpdf.text.DocumentException;
import com.itextpdf.text.ExceptionConverter;
import com.itextpdf.text.Image;
import com.itextpdf.text.Rectangle;
import com.itextpdf.text.Version;
import com.itextpdf.text.error_messages.MessageLocalization;
import com.itextpdf.text.exceptions.BadPasswordException;
import com.itextpdf.text.log.Counter;
import com.itextpdf.text.log.CounterFactory;
import com.itextpdf.text.pdf.AcroFields;
import com.itextpdf.text.pdf.ByteBuffer;
import com.itextpdf.text.pdf.FdfReader;
import com.itextpdf.text.pdf.ICC_Profile;
import com.itextpdf.text.pdf.IntHashtable;
import com.itextpdf.text.pdf.NumberArray;
import com.itextpdf.text.pdf.OutputStreamCounter;
import com.itextpdf.text.pdf.PRIndirectReference;
import com.itextpdf.text.pdf.PRStream;
import com.itextpdf.text.pdf.PageResources;
import com.itextpdf.text.pdf.PdfAction;
import com.itextpdf.text.pdf.PdfAnnotation;
import com.itextpdf.text.pdf.PdfAppearance;
import com.itextpdf.text.pdf.PdfArray;
import com.itextpdf.text.pdf.PdfContentByte;
import com.itextpdf.text.pdf.PdfContents;
import com.itextpdf.text.pdf.PdfDate;
import com.itextpdf.text.pdf.PdfDictionary;
import com.itextpdf.text.pdf.PdfDocument;
import com.itextpdf.text.pdf.PdfEncryption;
import com.itextpdf.text.pdf.PdfException;
import com.itextpdf.text.pdf.PdfFormField;
import com.itextpdf.text.pdf.PdfImportedPage;
import com.itextpdf.text.pdf.PdfIndirectObject;
import com.itextpdf.text.pdf.PdfIndirectReference;
import com.itextpdf.text.pdf.PdfLayer;
import com.itextpdf.text.pdf.PdfName;
import com.itextpdf.text.pdf.PdfNameTree;
import com.itextpdf.text.pdf.PdfNumber;
import com.itextpdf.text.pdf.PdfOCG;
import com.itextpdf.text.pdf.PdfOCProperties;
import com.itextpdf.text.pdf.PdfObject;
import com.itextpdf.text.pdf.PdfPageLabels;
import com.itextpdf.text.pdf.PdfReader;
import com.itextpdf.text.pdf.PdfReaderInstance;
import com.itextpdf.text.pdf.PdfRectangle;
import com.itextpdf.text.pdf.PdfStamper;
import com.itextpdf.text.pdf.PdfStream;
import com.itextpdf.text.pdf.PdfString;
import com.itextpdf.text.pdf.PdfTemplate;
import com.itextpdf.text.pdf.PdfTransition;
import com.itextpdf.text.pdf.PdfWriter;
import com.itextpdf.text.pdf.RandomAccessFileOrArray;
import com.itextpdf.text.pdf.StampContent;
import com.itextpdf.text.pdf.XfaForm;
import com.itextpdf.text.pdf.collection.PdfCollection;
import com.itextpdf.text.pdf.internal.PdfVersionImp;
import com.itextpdf.text.pdf.internal.PdfViewerPreferencesImp;
import com.itextpdf.text.xml.xmp.PdfProperties;
import com.itextpdf.text.xml.xmp.XmpBasicProperties;
import com.itextpdf.text.xml.xmp.XmpWriter;
import com.itextpdf.xmp.XMPException;
import com.itextpdf.xmp.XMPMeta;
import com.itextpdf.xmp.XMPMetaFactory;
import com.itextpdf.xmp.options.SerializeOptions;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.io.Serializable;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.LinkedHashSet;
import java.util.List;
import java.util.ListIterator;
import java.util.Map;
import java.util.Set;

class PdfStamperImp
extends PdfWriter {
    protected Counter COUNTER = CounterFactory.getCounter(PdfStamper.class);
    private double[] DEFAULT_MATRIX = new double[]{1.0, 0.0, 0.0, 1.0, 0.0, 0.0};
    protected AcroFields acroFields;
    protected boolean append;
    protected boolean closed = false;
    protected HashSet<PdfTemplate> fieldTemplates = new HashSet();
    protected boolean fieldsAdded = false;
    protected RandomAccessFileOrArray file;
    protected boolean flat = false;
    protected boolean flatFreeText = false;
    protected boolean flatannotations = false;
    protected int initialXrefSize;
    protected IntHashtable marked;
    IntHashtable myXref = new IntHashtable();
    protected int[] namePtr = new int[]{0};
    protected HashMap<Object, PdfObject> namedDestinations = new HashMap();
    protected PdfAction openAction;
    private boolean originalLayersAreRead = false;
    HashMap<PdfDictionary, PageStamp> pagesToContent = new HashMap();
    protected HashSet<String> partialFlattening = new HashSet();
    PdfReader reader;
    HashMap<PdfReader, RandomAccessFileOrArray> readers2file = new HashMap();
    HashMap<PdfReader, IntHashtable> readers2intrefs = new HashMap();
    private boolean rotateContents = true;
    protected int sigFlags = 0;
    protected boolean useVp = false;
    protected PdfViewerPreferencesImp viewerPreferences = new PdfViewerPreferencesImp();

    /*
     * Enabled force condition propagation
     * Lifted jumps to return sites
     */
    protected PdfStamperImp(PdfReader pdfReader, OutputStream arrby, char c2, boolean bl2) {
        super(new PdfDocument(), (OutputStream)arrby);
        if (!pdfReader.isOpenedWithFullPermissions()) throw new BadPasswordException(MessageLocalization.getComposedMessage("pdfreader.not.opened.with.owner.password", new Object[0]));
        if (pdfReader.isTampered()) throw new DocumentException(MessageLocalization.getComposedMessage("the.original.document.was.reused.read.it.again.from.file", new Object[0]));
        pdfReader.setTampered(true);
        this.reader = pdfReader;
        this.file = pdfReader.getSafeFile();
        this.append = bl2;
        if (pdfReader.isEncrypted() && (bl2 || PdfReader.unethicalreading)) {
            this.crypto = new PdfEncryption(pdfReader.getDecrypt());
        }
        if (bl2) {
            int n2;
            if (pdfReader.isRebuilt()) throw new DocumentException(MessageLocalization.getComposedMessage("append.mode.requires.a.document.without.errors.even.if.recovery.was.possible", new Object[0]));
            this.pdf_version.setAppendmode(true);
            if (c2 == '\u0000') {
                this.pdf_version.setPdfVersion(pdfReader.getPdfVersion());
            } else {
                this.pdf_version.setPdfVersion(c2);
            }
            arrby = new byte[8192];
            while ((n2 = this.file.read(arrby)) > 0) {
                this.os.write(arrby, 0, n2);
            }
            this.prevxref = pdfReader.getLastXref();
            pdfReader.setAppendable(true);
        } else {
            char c3 = c2;
            if (c2 == '\u0000') {
                c3 = pdfReader.getPdfVersion();
            }
            super.setPdfVersion(c3);
        }
        if (pdfReader.isTagged()) {
            this.setTagged();
        }
        super.open();
        this.pdf.addWriter(this);
        if (bl2) {
            this.body.setRefnum(pdfReader.getXrefSize());
            this.marked = new IntHashtable();
            if (pdfReader.isNewXrefType()) {
                this.fullCompression = true;
            }
            if (pdfReader.isHybridXref()) {
                this.fullCompression = false;
            }
        }
        this.initialXrefSize = pdfReader.getXrefSize();
        this.readColorProfile();
    }

    private void addOrder(PdfLayer pdfLayer, PdfArray pdfArray, Map<String, PdfLayer> map) {
        int n2 = 0;
        while (n2 < pdfArray.size()) {
            int n3;
            Object object = pdfArray.getPdfObject(n2);
            if (object.isIndirect()) {
                object = map.get(object.toString());
                n3 = n2;
                if (object != null) {
                    object.setOnPanel(true);
                    this.registerLayer((PdfOCG)object);
                    if (pdfLayer != null) {
                        pdfLayer.addChild((PdfLayer)object);
                    }
                    int n4 = pdfArray.size();
                    int n5 = n2 + 1;
                    n3 = n2;
                    if (n4 > n5) {
                        n3 = n2;
                        if (pdfArray.getPdfObject(n5).isArray()) {
                            this.addOrder((PdfLayer)object, (PdfArray)pdfArray.getPdfObject(n5), map);
                            n3 = n5;
                        }
                    }
                }
            } else {
                n3 = n2;
                if (object.isArray()) {
                    if ((object = (PdfArray)object).isEmpty()) {
                        return;
                    }
                    PdfObject pdfObject = object.getPdfObject(0);
                    if (pdfObject.isString()) {
                        pdfObject = new PdfLayer(pdfObject.toString());
                        pdfObject.setOnPanel(true);
                        this.registerLayer((PdfOCG)((Object)pdfObject));
                        if (pdfLayer != null) {
                            pdfLayer.addChild((PdfLayer)pdfObject);
                        }
                        PdfArray pdfArray2 = new PdfArray();
                        object = object.listIterator();
                        while (object.hasNext()) {
                            pdfArray2.add((PdfObject)object.next());
                        }
                        this.addOrder((PdfLayer)pdfObject, pdfArray2, map);
                        n3 = n2;
                    } else {
                        this.addOrder(pdfLayer, (PdfArray)pdfObject, map);
                        n3 = n2;
                    }
                }
            }
            n2 = n3 + 1;
        }
    }

    static void findAllObjects(PdfReader pdfReader, PdfObject pdfObject, IntHashtable intHashtable) {
        if (pdfObject == null) {
            return;
        }
        int n2 = pdfObject.type();
        if (n2 != 10) {
            switch (n2) {
                default: {
                    return;
                }
                case 6: 
                case 7: {
                    pdfObject = (PdfDictionary)pdfObject;
                    Iterator<PdfName> iterator = pdfObject.getKeys().iterator();
                    while (iterator.hasNext()) {
                        PdfStamperImp.findAllObjects(pdfReader, pdfObject.get(iterator.next()), intHashtable);
                    }
                    return;
                }
                case 5: 
            }
            pdfObject = (PdfArray)pdfObject;
            for (n2 = 0; n2 < pdfObject.size(); ++n2) {
                PdfStamperImp.findAllObjects(pdfReader, pdfObject.getPdfObject(n2), intHashtable);
            }
            return;
        }
        PRIndirectReference pRIndirectReference = (PRIndirectReference)pdfObject;
        if (pdfReader != pRIndirectReference.getReader()) {
            return;
        }
        if (intHashtable.containsKey(pRIndirectReference.getNumber())) {
            return;
        }
        intHashtable.put(pRIndirectReference.getNumber(), 1);
        PdfStamperImp.findAllObjects(pdfReader, PdfReader.getPdfObject(pdfObject), intHashtable);
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive block sorting
     * Lifted jumps to return sites
     */
    private void flattenAnnotations(boolean var1_1) {
        if (this.append) {
            if (var1_1 == false) throw new IllegalArgumentException(MessageLocalization.getComposedMessage("annotation.flattening.is.not.supported.in.append.mode", new Object[0]));
            throw new IllegalArgumentException(MessageLocalization.getComposedMessage("freetext.flattening.is.not.supported.in.append.mode", new Object[0]));
        }
        var3_2 = 1;
        while (var3_2 <= this.reader.getNumberOfPages()) {
            block22 : {
                var9_9 = this.reader.getPageN(var3_2);
                var10_10 = var9_9.getAsArray(PdfName.ANNOTS);
                if (var10_10 == null) break block22;
                var2_3 = 0;
                while (var2_3 < var10_10.size()) {
                    block24 : {
                        block26 : {
                            block25 : {
                                block23 : {
                                    var6_6 = var10_10.getDirectObject(var2_3);
                                    if (!(var6_6 instanceof PdfIndirectReference) || var6_6.isIndirect()) break block23;
                                    var5_5 = var2_3;
                                    break block24;
                                }
                                if (var6_6 instanceof PdfDictionary) break block25;
                                var5_5 = var2_3;
                                break block24;
                            }
                            var8_8 = (PdfDictionary)var6_6;
                            if (!var1_1) break block26;
                            if (var8_8.get(PdfName.SUBTYPE).equals(PdfName.FREETEXT)) ** GOTO lbl-1000
                            var5_5 = var2_3;
                            break block24;
                        }
                        if (var8_8.get(PdfName.SUBTYPE).equals(PdfName.WIDGET)) {
                            var5_5 = var2_3;
                        } else lbl-1000: // 2 sources:
                        {
                            var4_4 = (var6_6 = var8_8.getAsNumber(PdfName.F)) != null ? var6_6.intValue() : 0;
                            var5_5 = var2_3;
                            if ((var4_4 & 4) != 0) {
                                var5_5 = var2_3;
                                if ((var4_4 & 2) == 0) {
                                    var7_7 = var8_8.get(PdfName.AP);
                                    if (var7_7 == null) {
                                        var5_5 = var2_3;
                                    } else {
                                        var6_6 = var7_7;
                                        if (var7_7 instanceof PdfIndirectReference) {
                                            var6_6 = PdfReader.getPdfObject((PdfObject)var7_7);
                                        }
                                        var13_13 = (PdfDictionary)var6_6;
                                        var6_6 = var13_13.get(PdfName.N);
                                        var11_11 = var13_13.getAsStream(PdfName.N);
                                        var7_7 = null;
                                        var12_12 = PdfReader.getPdfObject((PdfObject)var6_6);
                                        if (var6_6 instanceof PdfIndirectReference && !var6_6.isIndirect()) {
                                            var6_6 = new PdfAppearance((PdfIndirectReference)var6_6);
                                        } else if (var12_12 instanceof PdfStream) {
                                            ((PdfDictionary)var12_12).put(PdfName.SUBTYPE, PdfName.FORM);
                                            var6_6 = new PdfAppearance((PdfIndirectReference)var6_6);
                                        } else {
                                            var6_6 = var7_7;
                                            if (var12_12.isDictionary()) {
                                                var13_13 = var13_13.getAsName(PdfName.AS);
                                                var6_6 = var7_7;
                                                if (var13_13 != null) {
                                                    var12_12 = (PdfIndirectReference)((PdfDictionary)var12_12).get((PdfName)var13_13);
                                                    var6_6 = var7_7;
                                                    if (var12_12 != null) {
                                                        var6_6 = var7_7 = new PdfAppearance((PdfIndirectReference)var12_12);
                                                        if (var12_12.isIndirect()) {
                                                            ((PdfDictionary)PdfReader.getPdfObject((PdfObject)var12_12)).put(PdfName.SUBTYPE, PdfName.FORM);
                                                            var6_6 = var7_7;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        var5_5 = var2_3;
                                        if (var6_6 != null) {
                                            var12_12 = PdfReader.getNormalizedRectangle(var8_8.getAsArray(PdfName.RECT));
                                            var8_8 = PdfReader.getNormalizedRectangle(var11_11.getAsArray(PdfName.BBOX));
                                            var13_13 = this.getOverContent(var3_2);
                                            var13_13.setLiteral("Q ");
                                            var7_7 = var8_8;
                                            if (var11_11.getAsArray(PdfName.MATRIX) != null) {
                                                var7_7 = var8_8;
                                                if (!Arrays.equals(this.DEFAULT_MATRIX, var11_11.getAsArray(PdfName.MATRIX).asDoubleArray())) {
                                                    var7_7 = this.transformBBoxByMatrix((Rectangle)var8_8, var11_11.getAsArray(PdfName.MATRIX).asDoubleArray());
                                                }
                                            }
                                            var13_13.addTemplate((PdfTemplate)var6_6, var12_12.getWidth() / var7_7.getWidth(), 0.0f, 0.0f, var12_12.getHeight() / var7_7.getHeight(), var12_12.getLeft(), var12_12.getBottom());
                                            var13_13.setLiteral("q ");
                                            var10_10.remove(var2_3);
                                            var5_5 = var2_3 - 1;
                                        }
                                    }
                                }
                            }
                        }
                    }
                    var2_3 = var5_5 + 1;
                }
                if (var10_10.isEmpty()) {
                    PdfReader.killIndirect(var9_9.get(PdfName.ANNOTS));
                    var9_9.remove(PdfName.ANNOTS);
                }
            }
            ++var3_2;
        }
    }

    private PdfArray getLastChildInNameTree(PdfDictionary pdfDictionary) {
        PdfArray pdfArray = pdfDictionary.getAsArray(PdfName.KIDS);
        if (pdfArray != null) {
            return this.getLastChildInNameTree(pdfArray.getAsDict(pdfArray.size() - 1));
        }
        return pdfDictionary.getAsArray(PdfName.NAMES);
    }

    private static void moveRectangle(PdfDictionary pdfDictionary, PdfReader object, int n2, PdfName pdfName, String string2) {
        if ((object = object.getBoxSize(n2, string2)) == null) {
            pdfDictionary.remove(pdfName);
            return;
        }
        pdfDictionary.put(pdfName, new PdfRectangle((Rectangle)object));
    }

    private void outlineTravel(PRIndirectReference pRIndirectReference) {
        while (pRIndirectReference != null) {
            PdfDictionary pdfDictionary = (PdfDictionary)PdfReader.getPdfObjectRelease(pRIndirectReference);
            PRIndirectReference pRIndirectReference2 = (PRIndirectReference)pdfDictionary.get(PdfName.FIRST);
            if (pRIndirectReference2 != null) {
                this.outlineTravel(pRIndirectReference2);
            }
            PdfReader.killIndirect(pdfDictionary.get(PdfName.DEST));
            PdfReader.killIndirect(pdfDictionary.get(PdfName.A));
            PdfReader.killIndirect(pRIndirectReference);
            pRIndirectReference = (PRIndirectReference)pdfDictionary.get(PdfName.NEXT);
        }
    }

    private Rectangle transformBBoxByMatrix(Rectangle object, double[] arrd) {
        ArrayList<Double> arrayList = new ArrayList<Double>();
        ArrayList<Double> arrayList2 = new ArrayList<Double>();
        Point point = this.transformPoint(object.getLeft(), object.getBottom(), arrd);
        arrayList.add(point.x);
        arrayList2.add(point.y);
        point = this.transformPoint(object.getRight(), object.getTop(), arrd);
        arrayList.add(point.x);
        arrayList2.add(point.y);
        point = this.transformPoint(object.getLeft(), object.getTop(), arrd);
        arrayList.add(point.x);
        arrayList2.add(point.y);
        object = this.transformPoint(object.getRight(), object.getBottom(), arrd);
        arrayList.add(object.x);
        arrayList2.add(object.y);
        return new Rectangle(((Double)Collections.min(arrayList)).floatValue(), ((Double)Collections.min(arrayList2)).floatValue(), ((Double)Collections.max(arrayList)).floatValue(), ((Double)Collections.max(arrayList2)).floatValue());
    }

    private Point transformPoint(double d2, double d3, double[] arrd) {
        Point point = new Point();
        point.x = arrd[0] * d2 + arrd[2] * d3 + arrd[4];
        point.y = arrd[1] * d2 + arrd[3] * d3 + arrd[5];
        return point;
    }

    @Override
    public void addAnnotation(PdfAnnotation pdfAnnotation) {
        throw new RuntimeException(MessageLocalization.getComposedMessage("unsupported.in.this.context.use.pdfstamper.addannotation", new Object[0]));
    }

    @Override
    void addAnnotation(PdfAnnotation pdfAnnotation, int n2) {
        if (pdfAnnotation.isAnnotation()) {
            pdfAnnotation.setPage(n2);
        }
        this.addAnnotation(pdfAnnotation, this.reader.getPageN(n2));
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    void addAnnotation(PdfAnnotation serializable, PdfDictionary pdfObject) {
        try {
            ArrayList<PdfAnnotation> arrayList = new ArrayList<PdfAnnotation>();
            if (serializable.isForm()) {
                this.fieldsAdded = true;
                this.getAcroFields();
                serializable = (PdfFormField)serializable;
                if (serializable.getParent() != null) {
                    return;
                }
                this.expandFields((PdfFormField)serializable, arrayList);
            } else {
                arrayList.add((PdfAnnotation)serializable);
            }
            int n2 = 0;
            while (n2 < arrayList.size()) {
                PdfObject pdfObject2;
                PdfAnnotation pdfAnnotation;
                block14 : {
                    block17 : {
                        Rectangle rectangle;
                        block15 : {
                            block16 : {
                                pdfAnnotation = (PdfAnnotation)arrayList.get(n2);
                                pdfObject2 = pdfObject;
                                if (pdfAnnotation.getPlaceInPage() > 0) {
                                    pdfObject2 = this.reader.getPageN(pdfAnnotation.getPlaceInPage());
                                }
                                if (pdfAnnotation.isForm()) {
                                    if (!pdfAnnotation.isUsed() && (serializable = pdfAnnotation.getTemplates()) != null) {
                                        this.fieldTemplates.addAll((Collection<PdfTemplate>)((Object)serializable));
                                    }
                                    if ((serializable = (PdfFormField)pdfAnnotation).getParent() == null) {
                                        this.addDocumentField(serializable.getIndirectReference());
                                    }
                                }
                                if (!pdfAnnotation.isAnnotation()) break block14;
                                serializable = PdfReader.getPdfObject(pdfObject2.get(PdfName.ANNOTS), pdfObject2);
                                if (serializable != null && serializable.isArray()) {
                                    serializable = (PdfArray)serializable;
                                } else {
                                    serializable = new PdfArray();
                                    pdfObject2.put(PdfName.ANNOTS, (PdfObject)serializable);
                                    this.markUsed(pdfObject2);
                                }
                                serializable.add(pdfAnnotation.getIndirectReference());
                                this.markUsed((PdfObject)serializable);
                                if (pdfAnnotation.isUsed() || (pdfObject = (PdfRectangle)pdfAnnotation.get(PdfName.RECT)) == null || pdfObject.left() == 0.0f && pdfObject.right() == 0.0f && pdfObject.top() == 0.0f && pdfObject.bottom() == 0.0f) break block14;
                                int n3 = this.reader.getPageRotation((PdfDictionary)pdfObject2);
                                rectangle = this.reader.getPageSizeWithRotation((PdfDictionary)pdfObject2);
                                if (n3 == 90) break block15;
                                if (n3 == 180) break block16;
                                if (n3 != 270) break block14;
                                serializable = PdfName.RECT;
                                pdfObject = new PdfRectangle(pdfObject.bottom(), rectangle.getRight() - pdfObject.left(), pdfObject.top(), rectangle.getRight() - pdfObject.right());
                                break block17;
                            }
                            serializable = PdfName.RECT;
                            pdfObject = new PdfRectangle(rectangle.getRight() - pdfObject.left(), rectangle.getTop() - pdfObject.bottom(), rectangle.getRight() - pdfObject.right(), rectangle.getTop() - pdfObject.top());
                            break block17;
                        }
                        serializable = PdfName.RECT;
                        pdfObject = new PdfRectangle(rectangle.getTop() - pdfObject.top(), pdfObject.right(), rectangle.getTop() - pdfObject.bottom(), pdfObject.left());
                    }
                    pdfAnnotation.put((PdfName)serializable, pdfObject);
                }
                if (!pdfAnnotation.isUsed()) {
                    pdfAnnotation.setUsed();
                    this.addToBody((PdfObject)pdfAnnotation, pdfAnnotation.getIndirectReference());
                }
                ++n2;
                pdfObject = pdfObject2;
            }
            return;
        }
        catch (IOException iOException) {
            throw new ExceptionConverter(iOException);
        }
    }

    public void addComments(FdfReader object) {
        if (this.readers2intrefs.containsKey(object)) {
            return;
        }
        Object object2 = object.getCatalog().getAsDict(PdfName.FDF);
        if (object2 == null) {
            return;
        }
        if ((object2 = object2.getAsArray(PdfName.ANNOTS)) != null) {
            int n2;
            Object object3;
            int n3;
            PdfObject pdfObject;
            PdfObject pdfObject2;
            if (object2.size() == 0) {
                return;
            }
            int n4 = 0;
            this.registerReader((PdfReader)object, false);
            Object object4 = new IntHashtable();
            Serializable serializable = new HashMap();
            ArrayList<Object> arrayList = new ArrayList<Object>();
            for (n2 = 0; n2 < object2.size(); ++n2) {
                object3 = object2.getPdfObject(n2);
                pdfObject2 = (PdfDictionary)PdfReader.getPdfObject((PdfObject)object3);
                pdfObject = pdfObject2.getAsNumber(PdfName.PAGE);
                if (pdfObject == null || pdfObject.intValue() >= this.reader.getNumberOfPages()) continue;
                PdfStamperImp.findAllObjects((PdfReader)object, (PdfObject)object3, (IntHashtable)object4);
                arrayList.add(object3);
                if (object3.type() != 10 || (pdfObject2 = PdfReader.getPdfObject(pdfObject2.get(PdfName.NM))) == null || pdfObject2.type() != 3) continue;
                serializable.put(pdfObject2.toString(), object3);
            }
            object3 = object4.getKeys();
            n2 = 0;
            do {
                if (n2 >= ((int[])object3).length) break;
                n3 = object3[n2];
                object2 = object4 = object.getPdfObject(n3);
                if (object4.type() == 6) {
                    pdfObject2 = (PdfDictionary)object4;
                    pdfObject = PdfReader.getPdfObject(pdfObject2.get(PdfName.IRT));
                    object2 = object4;
                    if (pdfObject != null) {
                        object2 = object4;
                        if (pdfObject.type() == 3) {
                            pdfObject = (PdfObject)serializable.get(pdfObject.toString());
                            object2 = object4;
                            if (pdfObject != null) {
                                object2 = new PdfDictionary();
                                object2.merge((PdfDictionary)pdfObject2);
                                object2.put(PdfName.IRT, pdfObject);
                            }
                        }
                    }
                }
                this.addToBody((PdfObject)object2, this.getNewObjectNumber((PdfReader)object, n3, 0));
                ++n2;
            } while (true);
            for (n3 = n4; n3 < arrayList.size(); ++n3) {
                object4 = (PdfObject)arrayList.get(n3);
                object = ((PdfDictionary)PdfReader.getPdfObject((PdfObject)object4)).getAsNumber(PdfName.PAGE);
                serializable = this.reader.getPageN(object.intValue() + 1);
                object = object2 = (PdfArray)PdfReader.getPdfObject(serializable.get(PdfName.ANNOTS), (PdfObject)serializable);
                if (object2 == null) {
                    object = new PdfArray();
                    serializable.put(PdfName.ANNOTS, (PdfObject)object);
                    this.markUsed((PdfObject)serializable);
                }
                this.markUsed((PdfObject)object);
                object.add((PdfObject)object4);
            }
        }
    }

    void addDocumentField(PdfIndirectReference pdfIndirectReference) {
        PdfObject pdfObject = this.reader.getCatalog();
        PdfObject pdfObject2 = (PdfDictionary)PdfReader.getPdfObject(pdfObject.get(PdfName.ACROFORM), pdfObject);
        PdfDictionary pdfDictionary = pdfObject2;
        if (pdfObject2 == null) {
            pdfDictionary = new PdfDictionary();
            pdfObject.put(PdfName.ACROFORM, pdfDictionary);
            this.markUsed(pdfObject);
        }
        pdfObject = (PdfArray)PdfReader.getPdfObject(pdfDictionary.get(PdfName.FIELDS), pdfDictionary);
        pdfObject2 = pdfObject;
        if (pdfObject == null) {
            pdfObject2 = new PdfArray();
            pdfDictionary.put(PdfName.FIELDS, pdfObject2);
            this.markUsed(pdfDictionary);
        }
        if (!pdfDictionary.contains(PdfName.DA)) {
            pdfDictionary.put(PdfName.DA, new PdfString("/Helv 0 Tf 0 g "));
            this.markUsed(pdfDictionary);
        }
        pdfObject2.add(pdfIndirectReference);
        this.markUsed(pdfObject2);
    }

    protected void addFieldResources() {
        PdfDictionary pdfDictionary;
        if (this.fieldTemplates.isEmpty()) {
            return;
        }
        Object object = this.reader.getCatalog();
        PdfDictionary pdfDictionary2 = pdfDictionary = (PdfDictionary)PdfReader.getPdfObject(object.get(PdfName.ACROFORM), (PdfObject)object);
        if (pdfDictionary == null) {
            pdfDictionary2 = new PdfDictionary();
            object.put(PdfName.ACROFORM, pdfDictionary2);
            this.markUsed((PdfObject)object);
        }
        object = (PdfDictionary)PdfReader.getPdfObject(pdfDictionary2.get(PdfName.DR), pdfDictionary2);
        pdfDictionary = object;
        if (object == null) {
            pdfDictionary = new PdfDictionary();
            pdfDictionary2.put(PdfName.DR, pdfDictionary);
            this.markUsed(pdfDictionary2);
        }
        this.markUsed(pdfDictionary);
        object = this.fieldTemplates.iterator();
        while (object.hasNext()) {
            PdfFormField.mergeResources(pdfDictionary, (PdfDictionary)((PdfTemplate)object.next()).getResources(), this);
        }
        PdfDictionary pdfDictionary3 = pdfDictionary.getAsDict(PdfName.FONT);
        object = pdfDictionary3;
        if (pdfDictionary3 == null) {
            object = new PdfDictionary();
            pdfDictionary.put(PdfName.FONT, (PdfObject)object);
        }
        if (!object.contains(PdfName.HELV)) {
            pdfDictionary = new PdfDictionary(PdfName.FONT);
            pdfDictionary.put(PdfName.BASEFONT, PdfName.HELVETICA);
            pdfDictionary.put(PdfName.ENCODING, PdfName.WIN_ANSI_ENCODING);
            pdfDictionary.put(PdfName.NAME, PdfName.HELV);
            pdfDictionary.put(PdfName.SUBTYPE, PdfName.TYPE1);
            object.put(PdfName.HELV, this.addToBody(pdfDictionary).getIndirectReference());
        }
        if (!object.contains(PdfName.ZADB)) {
            pdfDictionary = new PdfDictionary(PdfName.FONT);
            pdfDictionary.put(PdfName.BASEFONT, PdfName.ZAPFDINGBATS);
            pdfDictionary.put(PdfName.NAME, PdfName.ZADB);
            pdfDictionary.put(PdfName.SUBTYPE, PdfName.TYPE1);
            object.put(PdfName.ZADB, this.addToBody(pdfDictionary).getIndirectReference());
        }
        if (pdfDictionary2.get(PdfName.DA) == null) {
            pdfDictionary2.put(PdfName.DA, new PdfString("/Helv 0 Tf 0 g "));
            this.markUsed(pdfDictionary2);
        }
    }

    protected void addFileAttachments() {
        Serializable serializable = this.pdf.getDocumentFileAttachment();
        if (serializable.isEmpty()) {
            return;
        }
        PdfDictionary object2 = this.reader.getCatalog();
        Serializable serializable2 = (PdfDictionary)PdfReader.getPdfObject(object2.get(PdfName.NAMES), object2);
        PdfDictionary pdfDictionary = serializable2;
        if (serializable2 == null) {
            pdfDictionary = new PdfDictionary();
            object2.put(PdfName.NAMES, pdfDictionary);
            this.markUsed(object2);
        }
        this.markUsed(pdfDictionary);
        serializable2 = PdfNameTree.readTree((PdfDictionary)PdfReader.getPdfObjectRelease(pdfDictionary.get(PdfName.EMBEDDEDFILES)));
        for (Map.Entry entry : serializable.entrySet()) {
            CharSequence charSequence = (String)entry.getKey();
            int n2 = 0;
            charSequence = new StringBuilder((String)charSequence);
            while (serializable2.containsKey(charSequence.toString())) {
                charSequence.append(" ");
                charSequence.append(++n2);
            }
            serializable2.put(charSequence.toString(), entry.getValue());
        }
        serializable2 = PdfNameTree.writeTree((HashMap<String, ? extends PdfObject>)serializable2, this);
        serializable = pdfDictionary.get(PdfName.EMBEDDEDFILES);
        if (serializable != null) {
            PdfReader.killIndirect((PdfObject)serializable);
        }
        pdfDictionary.put(PdfName.EMBEDDEDFILES, this.addToBody((PdfObject)serializable2).getIndirectReference());
    }

    @Override
    public void addViewerPreference(PdfName pdfName, PdfObject pdfObject) {
        this.useVp = true;
        this.viewerPreferences.addViewerPreference(pdfName, pdfObject);
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive block sorting
     * Lifted jumps to return sites
     */
    protected void alterContents() {
        var2_1 = this.pagesToContent.values().iterator();
        while (var2_1.hasNext() != false) {
            block8 : {
                var3_3 = var2_1.next();
                var4_4 = var3_3.pageN;
                this.markUsed(var4_4);
                var1_2 = PdfReader.getPdfObject(var4_4.get(PdfName.CONTENTS), var4_4);
                if (var1_2 != null) break block8;
                var1_2 = new PdfArray();
                ** GOTO lbl20
            }
            if (var1_2.isArray()) {
                var1_2 = new PdfArray((PdfArray)var1_2);
                var4_4.put(PdfName.CONTENTS, var1_2);
            } else {
                if (var1_2.isStream()) {
                    var1_2 = new PdfArray();
                    var1_2.add(var4_4.get(PdfName.CONTENTS));
                } else {
                    var1_2 = new PdfArray();
                }
lbl20: // 3 sources:
                var4_4.put(PdfName.CONTENTS, var1_2);
            }
            var5_5 = new ByteBuffer();
            if (var3_3.under != null) {
                var5_5.append(PdfContents.SAVESTATE);
                this.applyRotation(var4_4, var5_5);
                var5_5.append(var3_3.under.getInternalBuffer());
                var5_5.append(PdfContents.RESTORESTATE);
            }
            if (var3_3.over != null) {
                var5_5.append(PdfContents.SAVESTATE);
            }
            var6_6 = new PdfStream(var5_5.toByteArray());
            var6_6.flateCompress(this.compressionLevel);
            var1_2.addFirst(this.addToBody((PdfObject)var6_6).getIndirectReference());
            var5_5.reset();
            if (var3_3.over != null) {
                var5_5.append(' ');
                var5_5.append(PdfContents.RESTORESTATE);
                var6_6 = var3_3.over.getInternalBuffer();
                var5_5.append(var6_6.getBuffer(), 0, var3_3.replacePoint);
                var5_5.append(PdfContents.SAVESTATE);
                this.applyRotation(var4_4, var5_5);
                var5_5.append(var6_6.getBuffer(), var3_3.replacePoint, var6_6.size() - var3_3.replacePoint);
                var5_5.append(PdfContents.RESTORESTATE);
                var4_4 = new PdfStream(var5_5.toByteArray());
                var4_4.flateCompress(this.compressionLevel);
                var1_2.add(this.addToBody(var4_4).getIndirectReference());
            }
            this.alterResources(var3_3);
        }
    }

    void alterResources(PageStamp pageStamp) {
        pageStamp.pageN.put(PdfName.RESOURCES, pageStamp.pageResources.getResources());
    }

    void applyRotation(PdfDictionary object, ByteBuffer byteBuffer) {
        if (!this.rotateContents) {
            return;
        }
        int n2 = (object = this.reader.getPageSizeWithRotation((PdfDictionary)object)).getRotation();
        if (n2 != 90) {
            float f2;
            if (n2 != 180) {
                if (n2 != 270) {
                    return;
                }
                byteBuffer.append(PdfContents.ROTATE270);
                byteBuffer.append('0').append(' ');
                f2 = object.getRight();
            } else {
                byteBuffer.append(PdfContents.ROTATE180);
                byteBuffer.append(object.getRight());
                byteBuffer.append(' ');
                f2 = object.getTop();
            }
            byteBuffer.append(f2);
            byteBuffer.append(PdfContents.ROTATEFINAL);
            return;
        }
        byteBuffer.append(PdfContents.ROTATE90);
        byteBuffer.append(object.getTop());
        byteBuffer.append(' ').append('0').append(PdfContents.ROTATEFINAL);
    }

    protected void close(PdfIndirectReference pdfIndirectReference, int n2) {
        Object object;
        PdfObject pdfObject;
        PdfIndirectReference pdfIndirectReference2;
        this.alterContents();
        int n3 = ((PRIndirectReference)this.reader.trailer.get(PdfName.ROOT)).getNumber();
        if (this.append) {
            object = this.marked.getKeys();
            for (int i2 = 0; i2 < ((int[])object).length; ++i2) {
                int n4 = object[i2];
                pdfObject = this.reader.getPdfObjectRelease(n4);
                if (pdfObject == null || n2 == n4 || n4 >= this.initialXrefSize) continue;
                pdfIndirectReference2 = pdfObject.getIndRef();
                boolean bl2 = n4 != n3;
                this.addToBody(pdfObject, pdfIndirectReference2, bl2);
            }
            for (n2 = this.initialXrefSize; n2 < this.reader.getXrefSize(); ++n2) {
                object = this.reader.getPdfObject(n2);
                if (object == null) continue;
                this.addToBody((PdfObject)object, this.getNewObjectNumber(this.reader, n2, 0));
            }
        } else {
            for (int i3 = 1; i3 < this.reader.getXrefSize(); ++i3) {
                object = this.reader.getPdfObjectRelease(i3);
                if (object == null || n2 == i3) continue;
                int n5 = this.getNewObjectNumber(this.reader, i3, 0);
                boolean bl3 = i3 != n3;
                this.addToBody((PdfObject)object, n5, bl3);
            }
        }
        pdfIndirectReference2 = null;
        if (this.crypto != null) {
            object = this.append ? this.reader.getCryptoRef() : this.addToBody((PdfObject)this.crypto.getEncryptionDictionary(), false).getIndirectReference();
            pdfObject = this.crypto.getFileID(true);
        } else {
            object = this.reader.trailer.getAsArray(PdfName.ID);
            object = object != null && object.getAsString(0) != null ? object.getAsString(0).getBytes() : PdfEncryption.createDocumentId();
            pdfObject = PdfEncryption.createInfoId((byte[])object, true);
            object = pdfIndirectReference2;
        }
        pdfIndirectReference2 = (PRIndirectReference)this.reader.trailer.get(PdfName.ROOT);
        pdfIndirectReference2 = new PdfIndirectReference(0, this.getNewObjectNumber(this.reader, pdfIndirectReference2.getNumber(), 0));
        this.body.writeCrossReferenceTable(this.os, pdfIndirectReference2, pdfIndirectReference, (PdfIndirectReference)object, pdfObject, this.prevxref);
        if (this.fullCompression) {
            PdfStamperImp.writeKeyInfo(this.os);
            this.os.write(PdfStamperImp.getISOBytes("startxref\n"));
            this.os.write(PdfStamperImp.getISOBytes(String.valueOf(this.body.offset())));
            this.os.write(PdfStamperImp.getISOBytes("\n%%EOF\n"));
        } else {
            new PdfWriter.PdfTrailer(this.body.size(), this.body.offset(), pdfIndirectReference2, pdfIndirectReference, (PdfIndirectReference)object, pdfObject, this.prevxref).toPdf(this, this.os);
        }
        this.os.flush();
        if (this.isCloseStream()) {
            this.os.close();
        }
        this.getCounter().written(this.os.getCounter());
    }

    /*
     * Loose catch block
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     * Lifted jumps to return sites
     */
    protected void close(Map<String, String> object) {
        PdfIndirectReference pdfIndirectReference;
        int n2;
        Object object2;
        PdfObject pdfObject;
        PdfDictionary pdfDictionary;
        block42 : {
            PdfDate pdfDate;
            Object object4;
            PdfDictionary pdfDictionary2;
            Object object3;
            block41 : {
                if (this.closed) {
                    return;
                }
                if (this.useVp) {
                    this.setViewerPreferences();
                }
                if (this.flat) {
                    this.flatFields();
                }
                if (this.flatFreeText) {
                    this.flatFreeTextFields();
                }
                if (this.flatannotations) {
                    this.flattenAnnotations();
                }
                this.addFieldResources();
                pdfDictionary = this.reader.getCatalog();
                this.getPdfVersion().addToCatalog(pdfDictionary);
                object2 = (PdfDictionary)PdfReader.getPdfObject(pdfDictionary.get(PdfName.ACROFORM), this.reader.getCatalog());
                if (this.acroFields != null && this.acroFields.getXfa().isChanged()) {
                    this.markUsed((PdfObject)object2);
                    if (!this.flat) {
                        this.acroFields.getXfa().setXfa(this);
                    }
                }
                if (this.sigFlags != 0 && object2 != null) {
                    object2.put(PdfName.SIGFLAGS, new PdfNumber(this.sigFlags));
                    this.markUsed((PdfObject)object2);
                    this.markUsed(pdfDictionary);
                }
                this.closed = true;
                this.addSharedObjectsToBody();
                this.setOutlines();
                this.setJavaScript();
                this.addFileAttachments();
                if (this.extraCatalog != null) {
                    pdfDictionary.mergeDifferent(this.extraCatalog);
                }
                if (this.openAction != null) {
                    pdfDictionary.put(PdfName.OPENACTION, this.openAction);
                }
                if (this.pdf.pageLabels != null) {
                    pdfDictionary.put(PdfName.PAGELABELS, this.pdf.pageLabels.getDictionary(this));
                }
                if (!this.documentOCG.isEmpty()) {
                    this.fillOCProperties(false);
                    object4 = pdfDictionary.getAsDict(PdfName.OCPROPERTIES);
                    if (object4 == null) {
                        this.reader.getCatalog().put(PdfName.OCPROPERTIES, this.OCProperties);
                    } else {
                        object4.put(PdfName.OCGS, this.OCProperties.get(PdfName.OCGS));
                        object2 = object3 = object4.getAsDict(PdfName.D);
                        if (object3 == null) {
                            object2 = new PdfDictionary();
                            object4.put(PdfName.D, (PdfObject)object2);
                        }
                        object2.put(PdfName.ORDER, this.OCProperties.getAsDict(PdfName.D).get(PdfName.ORDER));
                        object2.put(PdfName.RBGROUPS, this.OCProperties.getAsDict(PdfName.D).get(PdfName.RBGROUPS));
                        object2.put(PdfName.OFF, this.OCProperties.getAsDict(PdfName.D).get(PdfName.OFF));
                        object2.put(PdfName.AS, this.OCProperties.getAsDict(PdfName.D).get(PdfName.AS));
                    }
                    PdfWriter.checkPdfIsoConformance(this, 7, this.OCProperties);
                }
                n2 = (object3 = this.reader.getTrailer().getAsIndirectObject(PdfName.INFO)) != null ? object3.getNumber() : -1;
                PdfDictionary pdfDictionary3 = this.reader.getTrailer().getAsDict(PdfName.INFO);
                Object var8_18 = null;
                object2 = pdfDictionary3 != null && pdfDictionary3.get(PdfName.PRODUCER) != null ? pdfDictionary3.getAsString(PdfName.PRODUCER).toUnicodeString() : null;
                object4 = Version.getInstance();
                if (object2 != null && object4.getVersion().indexOf(object4.getProduct()) != -1) {
                    int n3 = object2.indexOf("; modified using");
                    object2 = n3 == -1 ? new StringBuffer((String)object2) : new StringBuffer(object2.substring(0, n3));
                    object2.append("; modified using ");
                    object2.append(object4.getVersion());
                    object4 = object2.toString();
                } else {
                    object4 = object4.getVersion();
                }
                pdfDictionary2 = new PdfDictionary();
                if (pdfDictionary3 != null) {
                    for (PdfName pdfName : pdfDictionary3.getKeys()) {
                        pdfDictionary2.put(pdfName, PdfReader.getPdfObject(pdfDictionary3.get(pdfName)));
                    }
                }
                if (object != null) {
                    for (Map.Entry entry : object.entrySet()) {
                        PdfName pdfName = new PdfName((String)entry.getKey());
                        String string2 = (String)entry.getValue();
                        if (string2 == null) {
                            pdfDictionary2.remove(pdfName);
                            continue;
                        }
                        pdfDictionary2.put(pdfName, new PdfString(string2, "UnicodeBig"));
                    }
                }
                pdfDate = new PdfDate();
                pdfDictionary2.put(PdfName.MODDATE, pdfDate);
                pdfDictionary2.put(PdfName.PRODUCER, new PdfString((String)object4, "UnicodeBig"));
                object2 = this.append && object3 != null ? this.addToBody((PdfObject)pdfDictionary2, object3.getNumber(), false) : this.addToBody((PdfObject)pdfDictionary2, false);
                pdfIndirectReference = object2.getIndirectReference();
                pdfObject = PdfReader.getPdfObject(pdfDictionary.get(PdfName.METADATA));
                if (pdfObject != null && pdfObject.isStream()) {
                    object2 = PdfReader.getStreamBytesRaw((PRStream)pdfObject);
                    PdfReader.killIndirect(pdfDictionary.get(PdfName.METADATA));
                } else {
                    object2 = null;
                }
                if (this.xmpMetadata != null) {
                    byte[] arrby = this.xmpMetadata;
                    object3 = var8_18;
                } else {
                    object3 = var8_18;
                    byte[] arrby = object2;
                    if (this.xmpWriter != null) {
                        try {
                            object3 = new ByteArrayOutputStream();
                            PdfProperties.setProducer(this.xmpWriter.getXmpMeta(), (String)object4);
                            XmpBasicProperties.setModDate(this.xmpWriter.getXmpMeta(), pdfDate.getW3CDate());
                            XmpBasicProperties.setMetaDataDate(this.xmpWriter.getXmpMeta(), pdfDate.getW3CDate());
                            this.xmpWriter.serialize((OutputStream)object3);
                            this.xmpWriter.close();
                            object3 = new PdfStream(object3.toByteArray());
                            Object object5 = object2;
                            break block41;
                        }
                        catch (XMPException xMPException) {}
                        this.xmpWriter = null;
                        Object object6 = object2;
                        object3 = var8_18;
                    }
                }
            }
            object2 = object3;
            if (object3 == null) {
                void var7_17;
                object2 = object3;
                if (var7_17 != null) {
                    try {
                        object2 = new ByteArrayOutputStream();
                        if (object != null && this.xmpMetadata == null) {
                            this.createXmpWriter((ByteArrayOutputStream)object2, pdfDictionary2).close();
                        } else {
                            object = XMPMetaFactory.parseFromBuffer((byte[])var7_17);
                            PdfProperties.setProducer((XMPMeta)object, (String)object4);
                            XmpBasicProperties.setModDate((XMPMeta)object, pdfDate.getW3CDate());
                            XmpBasicProperties.setMetaDataDate((XMPMeta)object, pdfDate.getW3CDate());
                            object3 = new SerializeOptions();
                            object3.setPadding(2000);
                            XMPMetaFactory.serialize((XMPMeta)object, (OutputStream)object2, (SerializeOptions)object3);
                        }
                        object2 = new PdfStream(object2.toByteArray());
                        break block42;
                    }
                    catch (XMPException xMPException) {}
                    object2 = new PdfStream((byte[])var7_17);
                    break block42;
                    catch (IOException iOException) {}
                    object2 = new PdfStream((byte[])var7_17);
                }
            }
        }
        if (object2 != null) {
            object2.put(PdfName.TYPE, PdfName.METADATA);
            object2.put(PdfName.SUBTYPE, PdfName.XML);
            if (this.crypto != null && !this.crypto.isMetadataEncrypted()) {
                object = new PdfArray();
                object.add(PdfName.CRYPT);
                object2.put(PdfName.FILTER, (PdfObject)object);
            }
            if (this.append && pdfObject != null) {
                this.body.add((PdfObject)object2, pdfObject.getIndRef());
            } else {
                pdfDictionary.put(PdfName.METADATA, this.body.add((PdfObject)object2).getIndirectReference());
                this.markUsed(pdfDictionary);
            }
        }
        if (!this.namedDestinations.isEmpty()) {
            this.updateNamedDestinations();
        }
        this.close(pdfIndirectReference, n2);
    }

    void correctAcroFieldPages(int n2) {
        if (this.acroFields == null) {
            return;
        }
        if (n2 > this.reader.getNumberOfPages()) {
            return;
        }
        for (AcroFields.Item item : this.acroFields.getFields().values()) {
            for (int i2 = 0; i2 < item.size(); ++i2) {
                int n3 = item.getPage(i2);
                if (n3 < n2) continue;
                item.forcePage(i2, n3 + 1);
            }
        }
    }

    @Override
    public void createXmpMetadata() {
        try {
            this.xmpWriter = this.createXmpWriter(null, this.reader.getInfo());
            this.xmpMetadata = null;
            return;
        }
        catch (IOException iOException) {
            iOException.printStackTrace();
            return;
        }
    }

    void deleteOutlines() {
        PdfDictionary pdfDictionary = this.reader.getCatalog();
        PdfObject pdfObject = pdfDictionary.get(PdfName.OUTLINES);
        if (pdfObject == null) {
            return;
        }
        if (pdfObject instanceof PRIndirectReference) {
            pdfObject = (PRIndirectReference)pdfObject;
            this.outlineTravel((PRIndirectReference)pdfObject);
            PdfReader.killIndirect(pdfObject);
        }
        pdfDictionary.remove(PdfName.OUTLINES);
        this.markUsed(pdfDictionary);
    }

    void eliminateAcroformObjects() {
        PdfObject pdfObject = this.reader.getCatalog().get(PdfName.ACROFORM);
        if (pdfObject == null) {
            return;
        }
        pdfObject = (PdfDictionary)PdfReader.getPdfObject(pdfObject);
        this.reader.killXref(pdfObject.get(PdfName.XFA));
        pdfObject.remove(PdfName.XFA);
        PdfObject pdfObject2 = pdfObject.get(PdfName.FIELDS);
        if (pdfObject2 != null) {
            PdfDictionary pdfDictionary = new PdfDictionary();
            pdfDictionary.put(PdfName.KIDS, pdfObject2);
            this.sweepKids(pdfDictionary);
            PdfReader.killIndirect(pdfObject2);
            pdfObject.put(PdfName.FIELDS, new PdfArray());
        }
        pdfObject.remove(PdfName.SIGFLAGS);
        pdfObject.remove(PdfName.NEEDAPPEARANCES);
        pdfObject.remove(PdfName.DR);
    }

    void expandFields(PdfFormField serializable, ArrayList<PdfAnnotation> arrayList) {
        arrayList.add((PdfAnnotation)serializable);
        serializable = serializable.getKids();
        if (serializable != null) {
            for (int i2 = 0; i2 < serializable.size(); ++i2) {
                this.expandFields((PdfFormField)serializable.get(i2), arrayList);
            }
        }
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive exception aggregation
     */
    protected void flatFields() {
        block41 : {
            block50 : {
                var13_1 = this.append;
                var10_2 = 0;
                if (var13_1) break block41;
                this.getAcroFields();
                var14_3 = this.acroFields.getFields();
                if (this.fieldsAdded && this.partialFlattening.isEmpty()) {
                    for (String var16_41 : var14_3.keySet()) {
                        this.partialFlattening.add(var16_41);
                    }
                }
                var15_40 = (var15_40 = this.reader.getCatalog().getAsDict(PdfName.ACROFORM)) != null ? (PdfArray)PdfReader.getPdfObject(var15_40.get(PdfName.FIELDS), (PdfObject)var15_40) : null;
                block4 : for (Map.Entry<String, AcroFields.Item> var14_5 : var14_3.entrySet()) {
                    var19_80 = var14_5.getKey();
                    if (!this.partialFlattening.isEmpty() && !this.partialFlattening.contains(var19_80)) continue;
                    var20_81 = var14_5.getValue();
                    var11_69 = 0;
                    var9_68 = var10_2;
                    block5 : do {
                        block44 : {
                            block42 : {
                                block43 : {
                                    var10_2 = var9_68;
                                    if (var11_69 >= var20_81.size()) continue block4;
                                    var21_82 = var20_81.getMerged(var11_69);
                                    var14_7 = var21_82.getAsNumber(PdfName.F);
                                    var10_2 = var14_7 != null ? var14_7.intValue() : 0;
                                    var12_70 = var20_81.getPage(var11_69);
                                    if (var12_70 < 1) ** GOTO lbl161
                                    var16_43 = var21_82.getAsDict(PdfName.AP);
                                    if (var16_43 != null) {
                                        var14_8 = var17_72 = var16_43.getAsStream(PdfName.N);
                                        if (var17_72 == null) {
                                            var14_9 = var16_43.getAsDict(PdfName.N);
                                        }
                                    } else {
                                        var14_10 = null;
                                    }
                                    if (!this.acroFields.isGenerateAppearances()) break block42;
                                    if (var16_43 == null || var14_11 == null) break block43;
                                    if (!var14_11.isStream()) break block44;
                                    var14_12 = (PdfStream)var14_11;
                                    var17_73 = var14_12.getAsArray(PdfName.BBOX);
                                    var22_83 = var21_82.getAsArray(PdfName.RECT);
                                    if (var17_73 == null || var22_83 == null) break block44;
                                    var1_60 = var22_83.getAsNumber(2).floatValue();
                                    var6_65 = var22_83.getAsNumber(var9_68).floatValue();
                                    var7_66 = var17_73.getAsNumber(2).floatValue() - var17_73.getAsNumber(var9_68).floatValue();
                                    var3_62 = var22_83.getAsNumber(3).floatValue();
                                    var4_63 = var22_83.getAsNumber(1).floatValue();
                                    var5_64 = var17_73.getAsNumber(3).floatValue() - var17_73.getAsNumber(1).floatValue();
                                    var2_61 = Float.MAX_VALUE;
                                    var1_60 = var7_66 != 0.0f ? (var1_60 - var6_65) / var7_66 : Float.MAX_VALUE;
                                    var6_65 = Math.abs(var1_60);
                                    var1_60 = var2_61;
                                    if (var5_64 != 0.0f) {
                                        var1_60 = (var3_62 - var4_63) / var5_64;
                                    }
                                    var1_60 = Math.abs(var1_60);
                                    if (var6_65 == 1.0f && var1_60 == 1.0f) break block44;
                                    var17_74 = new float[6];
                                    var17_74[var9_68] = var6_65;
                                    var17_74[1] = 0.0f;
                                    var17_74[2] = 0.0f;
                                    var17_74[3] = var1_60;
                                    var17_74[4] = 0.0f;
                                    var17_74[5] = 0.0f;
                                    var17_75 = new NumberArray(var17_74);
                                    var14_12.put(PdfName.MATRIX, var17_75);
                                    this.markUsed(var14_12);
                                    break block44;
                                }
                                this.acroFields.regenerateField(var19_80);
                                var14_13 = this.acroFields.getFieldItem(var19_80).getMerged(var11_69).getAsDict(PdfName.AP);
                                ** GOTO lbl92
                            }
                            if (var16_43 == null || var14_11 == null) break block44;
                            var14_14 = ((PdfDictionary)var14_11).getAsArray(PdfName.BBOX);
                            var17_76 = var21_82.getAsArray(PdfName.RECT);
                            if (var14_14 == null || var17_76 == null) break block44;
                            var1_60 = var14_14.getAsNumber(2).floatValue();
                            var2_61 = var14_14.getAsNumber(var9_68).floatValue();
                            var3_62 = var17_76.getAsNumber(2).floatValue();
                            var4_63 = var17_76.getAsNumber(var9_68).floatValue();
                            var5_64 = var14_14.getAsNumber(3).floatValue();
                            var6_65 = var14_14.getAsNumber(1).floatValue();
                            var7_66 = var17_76.getAsNumber(3).floatValue();
                            var8_67 = var17_76.getAsNumber(1).floatValue();
                            if (Math.abs(var1_60 - var2_61 - (var3_62 - var4_63)) <= 1.0f && Math.abs(var5_64 - var6_65 - (var7_66 - var8_67)) <= 1.0f) break block44;
                            this.acroFields.setGenerateAppearances(true);
                            this.acroFields.regenerateField(var19_80);
                            this.acroFields.setGenerateAppearances(false);
                            var14_15 = this.acroFields.getFieldItem(var19_80).getMerged(var11_69).getAsDict(PdfName.AP);
                            ** GOTO lbl92
                        }
lbl90: // 2 sources:
                        do {
                            block46 : {
                                block45 : {
                                    var14_17 = var16_43;
lbl92: // 3 sources:
                                    if (var14_18 == null || (var10_2 & 4) == 0 || (var10_2 & 2) != 0) break block45;
                                    var16_44 = var14_18.get(PdfName.N);
                                    if (var16_44 == null) ** GOTO lbl-1000
                                    var14_19 = PdfReader.getPdfObject(var16_44);
                                    if (var16_44 instanceof PdfIndirectReference && !var16_44.isIndirect()) {
                                        var14_20 = new PdfAppearance((PdfIndirectReference)var16_44);
                                    } else if (var14_19 instanceof PdfStream) {
                                        ((PdfDictionary)var14_19).put(PdfName.SUBTYPE, PdfName.FORM);
                                        var14_21 = new PdfAppearance((PdfIndirectReference)var16_44);
                                    } else if (var14_19 != null && var14_19.isDictionary() && (var16_45 = var21_82.getAsName(PdfName.AS)) != null && (var17_77 = (PdfIndirectReference)((PdfDictionary)var14_19).get(var16_45)) != null) {
                                        var14_22 = var16_46 = new PdfAppearance(var17_77);
                                        if (var17_77.isIndirect()) {
                                            ((PdfDictionary)PdfReader.getPdfObject(var17_77)).put(PdfName.SUBTYPE, PdfName.FORM);
                                            var14_23 = var16_46;
                                        }
                                    } else lbl-1000: // 2 sources:
                                    {
                                        var14_25 = null;
                                    }
                                    if (var14_26 != null) {
                                        var16_49 = PdfReader.getNormalizedRectangle(var21_82.getAsArray(PdfName.RECT));
                                        var17_78 = this.getOverContent(var12_70);
                                        var17_78.setLiteral("Q ");
                                        var17_78.addTemplate((PdfTemplate)var14_26, var16_49.getLeft(), var16_49.getBottom());
                                        var17_78.setLiteral("q ");
                                    }
                                }
                                if (this.partialFlattening.isEmpty() || (var21_82 = (var17_79 = this.reader.getPageN(var12_70)).getAsArray(PdfName.ANNOTS)) == null) break block46;
                                block7 : for (var9_68 = 0; var9_68 < var21_82.size(); ++var9_68) {
                                    var14_29 = var21_82.getPdfObject(var9_68);
                                    if (!var14_29.isIndirect() || !(var16_52 = var20_81.getWidgetRef(var11_69)).isIndirect() || (var10_2 = ((PRIndirectReference)var14_29).getNumber()) != (var14_31 = (PRIndirectReference)var16_52).getNumber()) continue;
                                    var21_82.remove(var9_68);
                                    do {
                                        block49 : {
                                            block48 : {
                                                block47 : {
                                                    var16_54 = (PRIndirectReference)((PdfDictionary)PdfReader.getPdfObject((PdfObject)var14_32)).get(PdfName.PARENT);
                                                    PdfReader.killIndirect((PdfObject)var14_32);
                                                    if (var16_54 != null) break block47;
                                                    var10_2 = 0;
                                                    while (var10_2 < var15_40.size()) {
                                                        var16_56 = var15_40.getPdfObject(var10_2);
                                                        var12_70 = var10_2;
                                                        if (var16_56.isIndirect()) {
                                                            var12_70 = var10_2;
                                                            if (((PRIndirectReference)var16_56).getNumber() == var14_32.getNumber()) {
                                                                var15_40.remove(var10_2);
                                                                var12_70 = var10_2 - 1;
                                                            }
                                                        }
                                                        var10_2 = var12_70 + 1;
                                                    }
                                                    break block48;
                                                }
                                                var22_83 = ((PdfDictionary)PdfReader.getPdfObject(var16_54)).getAsArray(PdfName.KIDS);
                                                var10_2 = 0;
                                                while (var10_2 < var22_83.size()) {
                                                    var23_84 = var22_83.getPdfObject(var10_2);
                                                    var12_70 = var10_2;
                                                    if (var23_84.isIndirect()) {
                                                        var12_70 = var10_2;
                                                        if (((PRIndirectReference)var23_84).getNumber() == var14_32.getNumber()) {
                                                            var22_83.remove(var10_2);
                                                            var12_70 = var10_2 - 1;
                                                        }
                                                    }
                                                    var10_2 = var12_70 + 1;
                                                }
                                                if (var22_83.isEmpty()) break block49;
                                            }
                                            --var9_68;
                                            continue block7;
                                        }
                                        var14_33 = var16_54;
                                    } while (true);
                                }
                                if (var21_82.isEmpty()) {
                                    PdfReader.killIndirect(var17_79.get(PdfName.ANNOTS));
                                    var17_79.remove(PdfName.ANNOTS);
                                }
                            }
                            ++var11_69;
                            var9_68 = 0;
                            continue block5;
                            break;
                        } while (true);
                        break;
                    } while (true);
                }
                if (this.fieldsAdded || !this.partialFlattening.isEmpty()) break block50;
                for (var10_2 = 1; var10_2 <= this.reader.getNumberOfPages(); ++var10_2) {
                    var14_37 = this.reader.getPageN(var10_2);
                    var15_40 = var14_37.getAsArray(PdfName.ANNOTS);
                    if (var15_40 == null) continue;
                    var9_68 = 0;
                    while (var9_68 < var15_40.size()) {
                        block52 : {
                            block53 : {
                                block51 : {
                                    var16_58 = var15_40.getDirectObject(var9_68);
                                    if (!(var16_58 instanceof PdfIndirectReference) || var16_58.isIndirect()) break block51;
                                    var11_69 = var9_68;
                                    break block52;
                                }
                                if (!var16_58.isDictionary()) break block53;
                                var11_69 = var9_68;
                                if (!PdfName.WIDGET.equals(((PdfDictionary)var16_58).get(PdfName.SUBTYPE))) break block52;
                            }
                            var15_40.remove(var9_68);
                            var11_69 = var9_68 - 1;
                        }
                        var9_68 = var11_69 + 1;
                    }
                    if (!var15_40.isEmpty()) continue;
                    PdfReader.killIndirect(var14_37.get(PdfName.ANNOTS));
                    var14_37.remove(PdfName.ANNOTS);
                }
                this.eliminateAcroformObjects();
            }
            return;
        }
        throw new IllegalArgumentException(MessageLocalization.getComposedMessage("field.flattening.is.not.supported.in.append.mode", new Object[0]));
        catch (DocumentException | IOException var14_38) {
            ** continue;
        }
    }

    protected void flatFreeTextFields() {
        this.flattenAnnotations(true);
    }

    protected void flattenAnnotations() {
        this.flattenAnnotations(false);
    }

    AcroFields getAcroFields() {
        if (this.acroFields == null) {
            this.acroFields = new AcroFields(this.reader, this);
        }
        return this.acroFields;
    }

    @Override
    protected Counter getCounter() {
        return this.COUNTER;
    }

    @Override
    public PdfContentByte getDirectContent() {
        throw new UnsupportedOperationException(MessageLocalization.getComposedMessage("use.pdfstamper.getundercontent.or.pdfstamper.getovercontent", new Object[0]));
    }

    @Override
    public PdfContentByte getDirectContentUnder() {
        throw new UnsupportedOperationException(MessageLocalization.getComposedMessage("use.pdfstamper.getundercontent.or.pdfstamper.getovercontent", new Object[0]));
    }

    protected HashMap<Object, PdfObject> getNamedDestinations() {
        return this.namedDestinations;
    }

    @Override
    protected int getNewObjectNumber(PdfReader object, int n2, int n3) {
        if ((object = this.readers2intrefs.get(object)) != null) {
            int n4;
            n3 = n4 = object.get(n2);
            if (n4 == 0) {
                n3 = this.getIndirectReferenceNumber();
                object.put(n2, n3);
            }
            return n3;
        }
        if (this.currentPdfReaderInstance == null) {
            int n5;
            if (this.append && n2 < this.initialXrefSize) {
                return n2;
            }
            n3 = n5 = this.myXref.get(n2);
            if (n5 == 0) {
                n3 = this.getIndirectReferenceNumber();
                this.myXref.put(n2, n3);
            }
            return n3;
        }
        return this.currentPdfReaderInstance.getNewObjectNumber(n2, n3);
    }

    PdfContentByte getOverContent(int n2) {
        if (n2 >= 1 && n2 <= this.reader.getNumberOfPages()) {
            PageStamp pageStamp = this.getPageStamp(n2);
            if (pageStamp.over == null) {
                pageStamp.over = new StampContent(this, pageStamp);
            }
            return pageStamp.over;
        }
        return null;
    }

    @Override
    public PdfIndirectReference getPageReference(int n2) {
        PRIndirectReference pRIndirectReference = this.reader.getPageOrigRef(n2);
        if (pRIndirectReference != null) {
            return pRIndirectReference;
        }
        throw new IllegalArgumentException(MessageLocalization.getComposedMessage("invalid.page.number.1", n2));
    }

    PageStamp getPageStamp(int n2) {
        PageStamp pageStamp;
        PdfDictionary pdfDictionary = this.reader.getPageN(n2);
        PageStamp pageStamp2 = pageStamp = this.pagesToContent.get(pdfDictionary);
        if (pageStamp == null) {
            pageStamp2 = new PageStamp(this, this.reader, pdfDictionary);
            this.pagesToContent.put(pdfDictionary, pageStamp2);
        }
        return pageStamp2;
    }

    public Map<String, PdfLayer> getPdfLayers() {
        if (!this.originalLayersAreRead) {
            this.originalLayersAreRead = true;
            this.readOCProperties();
        }
        HashMap<String, PdfLayer> hashMap = new HashMap<String, PdfLayer>();
        Iterator iterator = this.documentOCG.iterator();
        while (iterator.hasNext()) {
            PdfLayer pdfLayer = (PdfLayer)((PdfOCG)iterator.next());
            String string2 = pdfLayer.getTitle() == null ? pdfLayer.getAsString(PdfName.NAME).toString() : pdfLayer.getTitle();
            CharSequence charSequence = string2;
            if (hashMap.containsKey(string2)) {
                int n2 = 2;
                charSequence = new StringBuilder();
                do {
                    charSequence.append(string2);
                    charSequence.append("(");
                    charSequence.append(n2);
                    charSequence.append(")");
                    charSequence = charSequence.toString();
                    if (!hashMap.containsKey(charSequence)) break;
                    ++n2;
                    charSequence = new StringBuilder();
                } while (true);
            }
            hashMap.put((String)charSequence, pdfLayer);
        }
        return hashMap;
    }

    public PdfReader getPdfReader() {
        return this.reader;
    }

    @Override
    RandomAccessFileOrArray getReaderFile(PdfReader pdfReader) {
        if (this.readers2intrefs.containsKey(pdfReader)) {
            RandomAccessFileOrArray randomAccessFileOrArray = this.readers2file.get(pdfReader);
            if (randomAccessFileOrArray != null) {
                return randomAccessFileOrArray;
            }
            return pdfReader.getSafeFile();
        }
        if (this.currentPdfReaderInstance == null) {
            return this.file;
        }
        return this.currentPdfReaderInstance.getReaderFile();
    }

    PdfContentByte getUnderContent(int n2) {
        if (n2 >= 1 && n2 <= this.reader.getNumberOfPages()) {
            PageStamp pageStamp = this.getPageStamp(n2);
            if (pageStamp.under == null) {
                pageStamp.under = new StampContent(this, pageStamp);
            }
            return pageStamp.under;
        }
        return null;
    }

    void insertPage(int n2, Rectangle object) {
        block8 : {
            PdfObject pdfObject;
            PdfDictionary pdfDictionary;
            block7 : {
                PdfObject pdfObject2;
                int n3;
                PRIndirectReference pRIndirectReference;
                block6 : {
                    object = new Rectangle((Rectangle)object);
                    n3 = object.getRotation() % 360;
                    pdfDictionary = new PdfDictionary(PdfName.PAGE);
                    pdfDictionary.put(PdfName.RESOURCES, new PdfDictionary());
                    pdfDictionary.put(PdfName.ROTATE, new PdfNumber(n3));
                    pdfDictionary.put(PdfName.MEDIABOX, new PdfRectangle((Rectangle)object, n3));
                    pRIndirectReference = this.reader.addPdfObject(pdfDictionary);
                    if (n2 <= this.reader.getNumberOfPages()) break block6;
                    object = (PRIndirectReference)this.reader.getPageNRelease(this.reader.getNumberOfPages()).get(PdfName.PARENT);
                    pdfObject = new PRIndirectReference(this.reader, object.getNumber());
                    object = (PdfDictionary)PdfReader.getPdfObject(pdfObject);
                    pdfObject2 = (PdfArray)PdfReader.getPdfObject(object.get(PdfName.KIDS), (PdfObject)object);
                    pdfObject2.add(pRIndirectReference);
                    this.markUsed(pdfObject2);
                    this.reader.pageRefs.insertPage(n2, pRIndirectReference);
                    break block7;
                }
                n3 = n2;
                if (n2 < 1) {
                    n3 = 1;
                }
                object = this.reader.getPageN(n3);
                pdfObject2 = this.reader.getPageOrigRef(n3);
                this.reader.releasePage(n3);
                object = (PRIndirectReference)object.get(PdfName.PARENT);
                pdfObject = new PRIndirectReference(this.reader, object.getNumber());
                object = (PdfDictionary)PdfReader.getPdfObject(pdfObject);
                PdfArray pdfArray = (PdfArray)PdfReader.getPdfObject(object.get(PdfName.KIDS), (PdfObject)object);
                int n4 = pdfArray.size();
                int n5 = pdfObject2.getNumber();
                for (n2 = 0; n2 < n4; ++n2) {
                    if (n5 != ((PRIndirectReference)pdfArray.getPdfObject(n2)).getNumber()) continue;
                    pdfArray.add(n2, pRIndirectReference);
                    break;
                }
                if (n4 == pdfArray.size()) break block8;
                this.markUsed(pdfArray);
                this.reader.pageRefs.insertPage(n3, pRIndirectReference);
                this.correctAcroFieldPages(n3);
            }
            pdfDictionary.put(PdfName.PARENT, pdfObject);
            while (object != null) {
                this.markUsed((PdfObject)object);
                pdfObject = (PdfNumber)PdfReader.getPdfObjectRelease(object.get(PdfName.COUNT));
                object.put(PdfName.COUNT, new PdfNumber(pdfObject.intValue() + 1));
                object = object.getAsDict(PdfName.PARENT);
            }
            return;
        }
        throw new RuntimeException(MessageLocalization.getComposedMessage("internal.inconsistence", new Object[0]));
    }

    boolean isAppend() {
        return this.append;
    }

    boolean isContentWritten() {
        if (this.body.size() > 1) {
            return true;
        }
        return false;
    }

    boolean isRotateContents() {
        return this.rotateContents;
    }

    void makePackage(PdfCollection pdfCollection) {
        this.reader.getCatalog().put(PdfName.COLLECTION, pdfCollection);
    }

    protected void markUsed(int n2) {
        if (this.append) {
            this.marked.put(n2, 1);
        }
    }

    protected void markUsed(PdfObject pdfObject) {
        if (this.append && pdfObject != null) {
            pdfObject = pdfObject.type() == 10 ? (PRIndirectReference)pdfObject : pdfObject.getIndRef();
            if (pdfObject != null) {
                this.marked.put(pdfObject.getNumber(), 1);
            }
        }
    }

    boolean partialFormFlattening(String string2) {
        this.getAcroFields();
        if (!this.acroFields.getXfa().isXfaPresent()) {
            if (!this.acroFields.getFields().containsKey(string2)) {
                return false;
            }
            this.partialFlattening.add(string2);
            return true;
        }
        throw new UnsupportedOperationException(MessageLocalization.getComposedMessage("partial.form.flattening.is.not.supported.with.xfa.forms", new Object[0]));
    }

    protected void readColorProfile() {
        PdfArray pdfArray;
        PdfObject pdfObject = this.reader.getCatalog().getAsArray(PdfName.OUTPUTINTENTS);
        if (pdfObject != null && (pdfArray = pdfObject).size() > 0) {
            PdfObject pdfObject2;
            pdfObject = null;
            int n2 = 0;
            do {
                pdfObject2 = pdfObject;
                if (n2 >= pdfArray.size()) break;
                pdfObject2 = pdfArray.getAsDict(n2);
                if (pdfObject2 != null) {
                    pdfObject2 = pdfObject2.getAsStream(PdfName.DESTOUTPUTPROFILE);
                    pdfObject = pdfObject2;
                    if (pdfObject2 != null) break;
                }
                ++n2;
            } while (true);
            if (pdfObject2 instanceof PRStream) {
                try {
                    this.colorProfile = ICC_Profile.getInstance(PdfReader.getStreamBytes((PRStream)pdfObject2));
                    return;
                }
                catch (IOException iOException) {
                    throw new ExceptionConverter(iOException);
                }
            }
        }
    }

    protected void readOCProperties() {
        if (!this.documentOCG.isEmpty()) {
            return;
        }
        PdfDictionary pdfDictionary = this.reader.getCatalog().getAsDict(PdfName.OCPROPERTIES);
        if (pdfDictionary == null) {
            return;
        }
        Object object = pdfDictionary.getAsArray(PdfName.OCGS);
        HashMap<String, PdfLayer> hashMap = new HashMap<String, PdfLayer>();
        object = object.listIterator();
        while (object.hasNext()) {
            PdfIndirectReference pdfIndirectReference = (PdfIndirectReference)object.next();
            PdfLayer pdfLayer = new PdfLayer(null);
            pdfLayer.setRef(pdfIndirectReference);
            pdfLayer.setOnPanel(false);
            pdfLayer.merge((PdfDictionary)PdfReader.getPdfObject(pdfIndirectReference));
            hashMap.put(pdfIndirectReference.toString(), pdfLayer);
        }
        object = (pdfDictionary = pdfDictionary.getAsDict(PdfName.D)).getAsArray(PdfName.OFF);
        if (object != null) {
            object = object.listIterator();
            while (object.hasNext()) {
                hashMap.get(((PdfIndirectReference)object.next()).toString()).setOn(false);
            }
        }
        if ((object = pdfDictionary.getAsArray(PdfName.ORDER)) != null) {
            this.addOrder(null, (PdfArray)object, hashMap);
        }
        this.documentOCG.addAll(hashMap.values());
        this.OCGRadioGroup = pdfDictionary.getAsArray(PdfName.RBGROUPS);
        if (this.OCGRadioGroup == null) {
            this.OCGRadioGroup = new PdfArray();
        }
        this.OCGLocked = pdfDictionary.getAsArray(PdfName.LOCKED);
        if (this.OCGLocked == null) {
            this.OCGLocked = new PdfArray();
        }
    }

    @Override
    void registerLayer(PdfOCG pdfOCG) {
        if (!this.originalLayersAreRead) {
            this.originalLayersAreRead = true;
            this.readOCProperties();
        }
        super.registerLayer(pdfOCG);
    }

    public void registerReader(PdfReader pdfReader, boolean bl2) {
        if (this.readers2intrefs.containsKey(pdfReader)) {
            return;
        }
        this.readers2intrefs.put(pdfReader, new IntHashtable());
        if (bl2) {
            RandomAccessFileOrArray randomAccessFileOrArray = pdfReader.getSafeFile();
            this.readers2file.put(pdfReader, randomAccessFileOrArray);
            randomAccessFileOrArray.reOpen();
        }
    }

    void replacePage(PdfReader object, int n2, int n3) {
        PdfDictionary pdfDictionary = this.reader.getPageN(n3);
        if (!this.pagesToContent.containsKey(pdfDictionary)) {
            PdfImportedPage pdfImportedPage = this.getImportedPage((PdfReader)object, n2);
            PdfDictionary pdfDictionary2 = this.reader.getPageNRelease(n3);
            pdfDictionary2.remove(PdfName.RESOURCES);
            pdfDictionary2.remove(PdfName.CONTENTS);
            PdfStamperImp.moveRectangle(pdfDictionary2, (PdfReader)object, n2, PdfName.MEDIABOX, "media");
            PdfStamperImp.moveRectangle(pdfDictionary2, (PdfReader)object, n2, PdfName.CROPBOX, "crop");
            PdfStamperImp.moveRectangle(pdfDictionary2, (PdfReader)object, n2, PdfName.TRIMBOX, "trim");
            PdfStamperImp.moveRectangle(pdfDictionary2, (PdfReader)object, n2, PdfName.ARTBOX, "art");
            PdfStamperImp.moveRectangle(pdfDictionary2, (PdfReader)object, n2, PdfName.BLEEDBOX, "bleed");
            pdfDictionary2.put(PdfName.ROTATE, new PdfNumber(object.getPageRotation(n2)));
            this.getOverContent(n3).addTemplate((PdfTemplate)pdfImportedPage, 0.0f, 0.0f);
            object = this.pagesToContent.get(pdfDictionary);
            object.replacePoint = object.over.getInternalBuffer().size();
            return;
        }
        throw new IllegalStateException(MessageLocalization.getComposedMessage("this.page.cannot.be.replaced.new.content.was.already.added", new Object[0]));
    }

    @Override
    public void setAdditionalAction(PdfName pdfName, PdfAction pdfAction) {
        PdfDictionary pdfDictionary;
        if (!(pdfName.equals(DOCUMENT_CLOSE) || pdfName.equals(WILL_SAVE) || pdfName.equals(DID_SAVE) || pdfName.equals(WILL_PRINT) || pdfName.equals(DID_PRINT))) {
            throw new PdfException(MessageLocalization.getComposedMessage("invalid.additional.action.type.1", pdfName.toString()));
        }
        PdfDictionary pdfDictionary2 = pdfDictionary = this.reader.getCatalog().getAsDict(PdfName.AA);
        if (pdfDictionary == null) {
            if (pdfAction == null) {
                return;
            }
            pdfDictionary2 = new PdfDictionary();
            this.reader.getCatalog().put(PdfName.AA, pdfDictionary2);
        }
        this.markUsed(pdfDictionary2);
        if (pdfAction == null) {
            pdfDictionary2.remove(pdfName);
            return;
        }
        pdfDictionary2.put(pdfName, pdfAction);
    }

    @Override
    public void setDuration(int n2) {
        throw new UnsupportedOperationException(MessageLocalization.getComposedMessage("use.setpageaction.pdfname.actiontype.pdfaction.action.int.page", new Object[0]));
    }

    void setDuration(int n2, int n3) {
        PdfDictionary pdfDictionary = this.reader.getPageN(n3);
        if (n2 < 0) {
            pdfDictionary.remove(PdfName.DUR);
        } else {
            pdfDictionary.put(PdfName.DUR, new PdfNumber(n2));
        }
        this.markUsed(pdfDictionary);
    }

    public void setFlatAnnotations(boolean bl2) {
        this.flatannotations = bl2;
    }

    void setFormFlattening(boolean bl2) {
        this.flat = bl2;
    }

    void setFreeTextFlattening(boolean bl2) {
        this.flatFreeText = bl2;
    }

    protected void setJavaScript() {
        PdfDictionary pdfDictionary;
        HashMap<String, PdfObject> hashMap = this.pdf.getDocumentLevelJS();
        if (hashMap.isEmpty()) {
            return;
        }
        PdfDictionary pdfDictionary2 = this.reader.getCatalog();
        PdfDictionary pdfDictionary3 = pdfDictionary = (PdfDictionary)PdfReader.getPdfObject(pdfDictionary2.get(PdfName.NAMES), pdfDictionary2);
        if (pdfDictionary == null) {
            pdfDictionary3 = new PdfDictionary();
            pdfDictionary2.put(PdfName.NAMES, pdfDictionary3);
            this.markUsed(pdfDictionary2);
        }
        this.markUsed(pdfDictionary3);
        pdfDictionary = PdfNameTree.writeTree(hashMap, this);
        pdfDictionary3.put(PdfName.JAVASCRIPT, this.addToBody(pdfDictionary).getIndirectReference());
    }

    @Override
    public void setOpenAction(PdfAction pdfAction) {
        this.openAction = pdfAction;
    }

    @Override
    public void setOpenAction(String string2) {
        throw new UnsupportedOperationException(MessageLocalization.getComposedMessage("open.actions.by.name.are.not.supported", new Object[0]));
    }

    protected void setOutlines() {
        if (this.newBookmarks == null) {
            return;
        }
        this.deleteOutlines();
        if (this.newBookmarks.isEmpty()) {
            return;
        }
        PdfDictionary pdfDictionary = this.reader.getCatalog();
        boolean bl2 = pdfDictionary.get(PdfName.DESTS) != null;
        this.writeOutlines(pdfDictionary, bl2);
        this.markUsed(pdfDictionary);
    }

    @Override
    public void setPageAction(PdfName pdfName, PdfAction pdfAction) {
        throw new UnsupportedOperationException(MessageLocalization.getComposedMessage("use.setpageaction.pdfname.actiontype.pdfaction.action.int.page", new Object[0]));
    }

    void setPageAction(PdfName pdfName, PdfAction pdfAction, int n2) {
        PdfDictionary pdfDictionary;
        if (!pdfName.equals(PAGE_OPEN) && !pdfName.equals(PAGE_CLOSE)) {
            throw new PdfException(MessageLocalization.getComposedMessage("invalid.page.additional.action.type.1", pdfName.toString()));
        }
        PdfDictionary pdfDictionary2 = this.reader.getPageN(n2);
        PdfDictionary pdfDictionary3 = pdfDictionary = (PdfDictionary)PdfReader.getPdfObject(pdfDictionary2.get(PdfName.AA), pdfDictionary2);
        if (pdfDictionary == null) {
            pdfDictionary3 = new PdfDictionary();
            pdfDictionary2.put(PdfName.AA, pdfDictionary3);
            this.markUsed(pdfDictionary2);
        }
        pdfDictionary3.put(pdfName, pdfAction);
        this.markUsed(pdfDictionary3);
    }

    void setRotateContents(boolean bl2) {
        this.rotateContents = bl2;
    }

    @Override
    public void setSigFlags(int n2) {
        this.sigFlags = n2 | this.sigFlags;
    }

    @Override
    public void setThumbnail(Image image) {
        throw new UnsupportedOperationException(MessageLocalization.getComposedMessage("use.pdfstamper.setthumbnail", new Object[0]));
    }

    void setThumbnail(Image object, int n2) {
        object = this.getImageReference(this.addDirectImageSimple((Image)object));
        this.reader.resetReleasePage();
        this.reader.getPageN(n2).put(PdfName.THUMB, (PdfObject)object);
        this.reader.resetReleasePage();
    }

    @Override
    public void setTransition(PdfTransition pdfTransition) {
        throw new UnsupportedOperationException(MessageLocalization.getComposedMessage("use.setpageaction.pdfname.actiontype.pdfaction.action.int.page", new Object[0]));
    }

    void setTransition(PdfTransition pdfTransition, int n2) {
        PdfDictionary pdfDictionary = this.reader.getPageN(n2);
        if (pdfTransition == null) {
            pdfDictionary.remove(PdfName.TRANS);
        } else {
            pdfDictionary.put(PdfName.TRANS, pdfTransition.getTransitionDictionary());
        }
        this.markUsed(pdfDictionary);
    }

    protected void setViewerPreferences() {
        this.reader.setViewerPreferences(this.viewerPreferences);
        this.markUsed(this.reader.getTrailer().get(PdfName.ROOT));
    }

    @Override
    public void setViewerPreferences(int n2) {
        this.useVp = true;
        this.viewerPreferences.setViewerPreferences(n2);
    }

    void sweepKids(PdfObject pdfObject) {
        if ((pdfObject = PdfReader.killIndirect(pdfObject)) != null) {
            if (!pdfObject.isDictionary()) {
                return;
            }
            if ((pdfObject = (PdfArray)PdfReader.killIndirect(((PdfDictionary)pdfObject).get(PdfName.KIDS))) == null) {
                return;
            }
            for (int i2 = 0; i2 < pdfObject.size(); ++i2) {
                this.sweepKids(pdfObject.getPdfObject(i2));
            }
        }
    }

    public void unRegisterReader(PdfReader pdfReader) {
        if (!this.readers2intrefs.containsKey(pdfReader)) {
            return;
        }
        this.readers2intrefs.remove(pdfReader);
        RandomAccessFileOrArray randomAccessFileOrArray = this.readers2file.get(pdfReader);
        if (randomAccessFileOrArray == null) {
            return;
        }
        this.readers2file.remove(pdfReader);
        try {
            randomAccessFileOrArray.close();
            return;
        }
        catch (Exception exception) {
            return;
        }
    }

    protected void updateNamedDestinations() {
        Object object = this.reader.getCatalog().getAsDict(PdfName.NAMES);
        PdfObject pdfObject = object;
        if (object != null) {
            pdfObject = object.getAsDict(PdfName.DESTS);
        }
        object = pdfObject;
        if (pdfObject == null) {
            object = this.reader.getCatalog().getAsDict(PdfName.DESTS);
        }
        pdfObject = object;
        if (object == null) {
            pdfObject = new PdfDictionary();
            object = new PdfDictionary();
            pdfObject.put(PdfName.NAMES, new PdfArray());
            object.put(PdfName.DESTS, pdfObject);
            this.reader.getCatalog().put(PdfName.NAMES, (PdfObject)object);
        }
        pdfObject = this.getLastChildInNameTree((PdfDictionary)pdfObject);
        for (Object e2 : this.namedDestinations.keySet()) {
            pdfObject.add(new PdfString(e2.toString()));
            pdfObject.add(this.addToBody(this.namedDestinations.get(e2), this.getPdfIndirectReference()).getIndirectReference());
        }
    }

    static class PageStamp {
        StampContent over;
        PdfDictionary pageN;
        PageResources pageResources;
        int replacePoint = 0;
        StampContent under;

        PageStamp(PdfStamperImp pdfStamperImp, PdfReader object, PdfDictionary pdfDictionary) {
            this.pageN = pdfDictionary;
            this.pageResources = new PageResources();
            object = pdfDictionary.getAsDict(PdfName.RESOURCES);
            this.pageResources.setOriginalResources((PdfDictionary)object, pdfStamperImp.namePtr);
        }
    }

}

