/*
 * Decompiled with CFR 0_132.
 */
package com.itextpdf.text.pdf.codec;

import com.itextpdf.text.DocWriter;
import java.io.ByteArrayOutputStream;
import java.io.OutputStream;
import java.util.zip.DeflaterOutputStream;

public class PngWriter {
    private static final byte[] IDAT;
    private static final byte[] IEND;
    private static final byte[] IHDR;
    private static final byte[] PLTE;
    private static final byte[] PNG_SIGNTURE;
    private static int[] crc_table;
    private static final byte[] iCCP;
    private OutputStream outp;

    static {
        PNG_SIGNTURE = new byte[]{-119, 80, 78, 71, 13, 10, 26, 10};
        IHDR = DocWriter.getISOBytes("IHDR");
        PLTE = DocWriter.getISOBytes("PLTE");
        IDAT = DocWriter.getISOBytes("IDAT");
        IEND = DocWriter.getISOBytes("IEND");
        iCCP = DocWriter.getISOBytes("iCCP");
    }

    public PngWriter(OutputStream outputStream) {
        this.outp = outputStream;
        outputStream.write(PNG_SIGNTURE);
    }

    private static int crc(byte[] arrby) {
        return PngWriter.update_crc(-1, arrby, 0, arrby.length);
    }

    private static int crc(byte[] arrby, int n2, int n3) {
        return PngWriter.update_crc(-1, arrby, n2, n3);
    }

    private static void make_crc_table() {
        if (crc_table != null) {
            return;
        }
        int[] arrn = new int[256];
        for (int i2 = 0; i2 < 256; ++i2) {
            int n2 = i2;
            for (int i3 = 0; i3 < 8; ++i3) {
                if ((n2 & 1) != 0) {
                    n2 = n2 >>> 1 ^ -306674912;
                    continue;
                }
                n2 >>>= 1;
            }
            arrn[i2] = n2;
        }
        crc_table = arrn;
    }

    public static void outputInt(int n2, OutputStream outputStream) {
        outputStream.write((byte)(n2 >> 24));
        outputStream.write((byte)(n2 >> 16));
        outputStream.write((byte)(n2 >> 8));
        outputStream.write((byte)n2);
    }

    private static int update_crc(int n2, byte[] arrby, int n3, int n4) {
        if (crc_table == null) {
            PngWriter.make_crc_table();
        }
        int n5 = 0;
        int n6 = n2;
        for (n2 = n5; n2 < n4; ++n2) {
            n6 = n6 >>> 8 ^ crc_table[(arrby[n2 + n3] ^ n6) & 255];
        }
        return n6;
    }

    public void outputInt(int n2) {
        PngWriter.outputInt(n2, this.outp);
    }

    public void writeChunk(byte[] arrby, byte[] arrby2) {
        this.outputInt(arrby2.length);
        this.outp.write(arrby, 0, 4);
        this.outp.write(arrby2);
        this.outputInt(PngWriter.update_crc(PngWriter.update_crc(-1, arrby, 0, arrby.length), arrby2, 0, arrby2.length));
    }

    public void writeData(byte[] arrby, int n2) {
        int n3;
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        DeflaterOutputStream deflaterOutputStream = new DeflaterOutputStream(byteArrayOutputStream);
        for (n3 = 0; n3 < arrby.length - n2; n3 += n2) {
            deflaterOutputStream.write(0);
            deflaterOutputStream.write(arrby, n3, n2);
        }
        n2 = arrby.length - n3;
        if (n2 > 0) {
            deflaterOutputStream.write(0);
            deflaterOutputStream.write(arrby, n3, n2);
        }
        deflaterOutputStream.close();
        this.writeChunk(IDAT, byteArrayOutputStream.toByteArray());
    }

    public void writeEnd() {
        this.writeChunk(IEND, new byte[0]);
    }

    public void writeHeader(int n2, int n3, int n4, int n5) {
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        PngWriter.outputInt(n2, byteArrayOutputStream);
        PngWriter.outputInt(n3, byteArrayOutputStream);
        byteArrayOutputStream.write(n4);
        byteArrayOutputStream.write(n5);
        byteArrayOutputStream.write(0);
        byteArrayOutputStream.write(0);
        byteArrayOutputStream.write(0);
        this.writeChunk(IHDR, byteArrayOutputStream.toByteArray());
    }

    public void writeIccProfile(byte[] arrby) {
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        byteArrayOutputStream.write(73);
        byteArrayOutputStream.write(67);
        byteArrayOutputStream.write(67);
        byteArrayOutputStream.write(0);
        byteArrayOutputStream.write(0);
        DeflaterOutputStream deflaterOutputStream = new DeflaterOutputStream(byteArrayOutputStream);
        deflaterOutputStream.write(arrby);
        deflaterOutputStream.close();
        this.writeChunk(iCCP, byteArrayOutputStream.toByteArray());
    }

    public void writePalette(byte[] arrby) {
        this.writeChunk(PLTE, arrby);
    }
}

