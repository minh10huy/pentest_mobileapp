/*
 * Decompiled with CFR 0_132.
 */
package com.itextpdf.text.pdf.codec;

import com.itextpdf.text.pdf.codec.LZWCompressor;
import java.io.OutputStream;
import java.util.Collection;
import java.util.Iterator;
import java.util.TreeMap;

public class TiffWriter {
    private TreeMap<Integer, FieldBase> ifd = new TreeMap();

    public static void compressLZW(OutputStream object, int n2, byte[] arrby, int n3, int n4, int n5) {
        int n6 = 1;
        LZWCompressor lZWCompressor = new LZWCompressor((OutputStream)object, 8, true);
        n2 = n2 == 2 ? n6 : 0;
        if (n2 == 0) {
            lZWCompressor.compress(arrby, 0, arrby.length);
        } else {
            object = n2 != 0 ? new byte[n5] : null;
            n6 = 0;
            for (n2 = 0; n2 < n3; ++n2) {
                System.arraycopy(arrby, n6, object, 0, n5);
                for (int i2 = n5 - 1; i2 >= n4; --i2) {
                    object[i2] = (byte)(object[i2] - object[i2 - n4]);
                }
                lZWCompressor.compress((byte[])object, 0, n5);
                n6 += n5;
            }
        }
        lZWCompressor.flush();
    }

    public static void writeLong(int n2, OutputStream outputStream) {
        outputStream.write(n2 >> 24 & 255);
        outputStream.write(n2 >> 16 & 255);
        outputStream.write(n2 >> 8 & 255);
        outputStream.write(n2 & 255);
    }

    public static void writeShort(int n2, OutputStream outputStream) {
        outputStream.write(n2 >> 8 & 255);
        outputStream.write(n2 & 255);
    }

    public void addField(FieldBase fieldBase) {
        this.ifd.put(fieldBase.getTag(), fieldBase);
    }

    public int getIfdSize() {
        return this.ifd.size() * 12 + 6;
    }

    public void writeFile(OutputStream outputStream) {
        outputStream.write(77);
        outputStream.write(77);
        outputStream.write(0);
        outputStream.write(42);
        TiffWriter.writeLong(8, outputStream);
        TiffWriter.writeShort(this.ifd.size(), outputStream);
        int n2 = this.getIfdSize() + 8;
        for (FieldBase fieldBase : this.ifd.values()) {
            int n3 = fieldBase.getValueSize();
            int n4 = n2;
            if (n3 > 4) {
                fieldBase.setOffset(n2);
                n4 = n2 + n3;
            }
            fieldBase.writeField(outputStream);
            n2 = n4;
        }
        TiffWriter.writeLong(0, outputStream);
        Iterator<FieldBase> iterator = this.ifd.values().iterator();
        while (iterator.hasNext()) {
            iterator.next().writeValue(outputStream);
        }
    }

    public static class FieldAscii
    extends FieldBase {
        public FieldAscii(int n2, String arrby) {
            super(n2, 2, arrby.getBytes().length + 1);
            arrby = arrby.getBytes();
            this.data = new byte[arrby.length + 1];
            System.arraycopy(arrby, 0, this.data, 0, arrby.length);
        }
    }

    public static abstract class FieldBase {
        private int count;
        protected byte[] data;
        private int fieldType;
        private int offset;
        private int tag;

        protected FieldBase(int n2, int n3, int n4) {
            this.tag = n2;
            this.fieldType = n3;
            this.count = n4;
        }

        public int getTag() {
            return this.tag;
        }

        public int getValueSize() {
            return this.data.length + 1 & -2;
        }

        public void setOffset(int n2) {
            this.offset = n2;
        }

        public void writeField(OutputStream outputStream) {
            TiffWriter.writeShort(this.tag, outputStream);
            TiffWriter.writeShort(this.fieldType, outputStream);
            TiffWriter.writeLong(this.count, outputStream);
            if (this.data.length <= 4) {
                outputStream.write(this.data);
                for (int i2 = this.data.length; i2 < 4; ++i2) {
                    outputStream.write(0);
                }
            } else {
                TiffWriter.writeLong(this.offset, outputStream);
            }
        }

        public void writeValue(OutputStream outputStream) {
            if (this.data.length <= 4) {
                return;
            }
            outputStream.write(this.data);
            if ((this.data.length & 1) == 1) {
                outputStream.write(0);
            }
        }
    }

    public static class FieldByte
    extends FieldBase {
        public FieldByte(int n2, byte[] arrby) {
            super(n2, 1, arrby.length);
            this.data = arrby;
        }
    }

    public static class FieldImage
    extends FieldBase {
        public FieldImage(byte[] arrby) {
            super(273, 4, 1);
            this.data = arrby;
        }
    }

    public static class FieldLong
    extends FieldBase {
        public FieldLong(int n2, int n3) {
            super(n2, 4, 1);
            this.data = new byte[4];
            this.data[0] = (byte)(n3 >> 24);
            this.data[1] = (byte)(n3 >> 16);
            this.data[2] = (byte)(n3 >> 8);
            this.data[3] = (byte)n3;
        }

        public FieldLong(int n2, int[] arrn) {
            super(n2, 4, arrn.length);
            this.data = new byte[arrn.length * 4];
            int n3 = arrn.length;
            int n4 = 0;
            for (n2 = 0; n2 < n3; ++n2) {
                int n5 = arrn[n2];
                byte[] arrby = this.data;
                int n6 = n4 + 1;
                arrby[n4] = (byte)(n5 >> 24);
                arrby = this.data;
                n4 = n6 + 1;
                arrby[n6] = (byte)(n5 >> 16);
                arrby = this.data;
                n6 = n4 + 1;
                arrby[n4] = (byte)(n5 >> 8);
                this.data[n6] = (byte)n5;
                n4 = n6 + 1;
            }
        }
    }

    public static class FieldRational
    extends FieldBase {
        public FieldRational(int n2, int[] arrn) {
            this(n2, new int[][]{arrn});
        }

        public FieldRational(int n2, int[][] arrn) {
            super(n2, 5, arrn.length);
            this.data = new byte[arrn.length * 8];
            int n3 = arrn.length;
            int n4 = 0;
            for (n2 = 0; n2 < n3; ++n2) {
                int[] arrn2 = arrn[n2];
                byte[] arrby = this.data;
                int n5 = n4 + 1;
                arrby[n4] = (byte)(arrn2[0] >> 24);
                arrby = this.data;
                n4 = n5 + 1;
                arrby[n5] = (byte)(arrn2[0] >> 16);
                arrby = this.data;
                n5 = n4 + 1;
                arrby[n4] = (byte)(arrn2[0] >> 8);
                arrby = this.data;
                n4 = n5 + 1;
                arrby[n5] = (byte)arrn2[0];
                arrby = this.data;
                n5 = n4 + 1;
                arrby[n4] = (byte)(arrn2[1] >> 24);
                arrby = this.data;
                n4 = n5 + 1;
                arrby[n5] = (byte)(arrn2[1] >> 16);
                arrby = this.data;
                n5 = n4 + 1;
                arrby[n4] = (byte)(arrn2[1] >> 8);
                this.data[n5] = (byte)arrn2[1];
                n4 = n5 + 1;
            }
        }
    }

    public static class FieldShort
    extends FieldBase {
        public FieldShort(int n2, int n3) {
            super(n2, 3, 1);
            this.data = new byte[2];
            this.data[0] = (byte)(n3 >> 8);
            this.data[1] = (byte)n3;
        }

        public FieldShort(int n2, int[] arrn) {
            super(n2, 3, arrn.length);
            this.data = new byte[arrn.length * 2];
            int n3 = arrn.length;
            int n4 = 0;
            for (n2 = 0; n2 < n3; ++n2) {
                int n5 = arrn[n2];
                byte[] arrby = this.data;
                int n6 = n4 + 1;
                arrby[n4] = (byte)(n5 >> 8);
                this.data[n6] = (byte)n5;
                n4 = n6 + 1;
            }
        }
    }

    public static class FieldUndefined
    extends FieldBase {
        public FieldUndefined(int n2, byte[] arrby) {
            super(n2, 7, arrby.length);
            this.data = arrby;
        }
    }

}

