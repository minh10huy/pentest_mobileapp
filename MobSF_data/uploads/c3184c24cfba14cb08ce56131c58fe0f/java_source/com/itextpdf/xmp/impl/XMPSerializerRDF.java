/*
 * Decompiled with CFR 0_132.
 */
package com.itextpdf.xmp.impl;

import com.itextpdf.xmp.XMPException;
import com.itextpdf.xmp.XMPMeta;
import com.itextpdf.xmp.XMPMetaFactory;
import com.itextpdf.xmp.impl.CountOutputStream;
import com.itextpdf.xmp.impl.QName;
import com.itextpdf.xmp.impl.Utils;
import com.itextpdf.xmp.impl.XMPMetaImpl;
import com.itextpdf.xmp.impl.XMPNode;
import com.itextpdf.xmp.impl.XMPNodeUtils;
import com.itextpdf.xmp.options.PropertyOptions;
import com.itextpdf.xmp.options.SerializeOptions;
import java.io.IOException;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.util.Arrays;
import java.util.Collection;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Set;

public class XMPSerializerRDF {
    private static final int DEFAULT_PAD = 2048;
    private static final String PACKET_HEADER = "<?xpacket begin=\"\ufeff\" id=\"W5M0MpCehiHzreSzNTczkc9d\"?>";
    private static final String PACKET_TRAILER = "<?xpacket end=\"";
    private static final String PACKET_TRAILER2 = "\"?>";
    static final Set RDF_ATTR_QUALIFIER = new HashSet<String>(Arrays.asList("xml:lang", "rdf:resource", "rdf:ID", "rdf:bagID", "rdf:nodeID"));
    private static final String RDF_EMPTY_STRUCT = "<rdf:Description/>";
    private static final String RDF_RDF_END = "</rdf:RDF>";
    private static final String RDF_RDF_START = "<rdf:RDF xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\">";
    private static final String RDF_SCHEMA_END = "</rdf:Description>";
    private static final String RDF_SCHEMA_START = "<rdf:Description rdf:about=";
    private static final String RDF_STRUCT_END = "</rdf:Description>";
    private static final String RDF_STRUCT_START = "<rdf:Description";
    private static final String RDF_XMPMETA_END = "</x:xmpmeta>";
    private static final String RDF_XMPMETA_START = "<x:xmpmeta xmlns:x=\"adobe:ns:meta/\" x:xmptk=\"";
    private SerializeOptions options;
    private CountOutputStream outputStream;
    private int padding;
    private int unicodeSize = 1;
    private OutputStreamWriter writer;
    private XMPMetaImpl xmp;

    private void addPadding(int n2) {
        if (this.options.getExactPacketLength()) {
            n2 = this.outputStream.getBytesWritten() + n2 * this.unicodeSize;
            if (n2 <= this.padding) {
                this.padding -= n2;
            } else {
                throw new XMPException("Can't fit into specified packet size", 107);
            }
        }
        this.padding /= this.unicodeSize;
        int n3 = this.options.getNewline().length();
        if (this.padding >= n3) {
            int n4;
            n2 = this.padding - n3;
            while ((n2 = (this.padding = n2)) >= (n4 = n3 + 100)) {
                this.writeChars(100, ' ');
                this.writeNewline();
                n2 = this.padding - n4;
            }
            this.writeChars(this.padding, ' ');
            this.writeNewline();
            return;
        }
        this.writeChars(this.padding, ' ');
    }

    private void appendNodeValue(String string2, boolean bl2) {
        String string3 = string2;
        if (string2 == null) {
            string3 = "";
        }
        this.write(Utils.escapeXML(string3, bl2, true));
    }

    private boolean canBeRDFAttrProp(XMPNode xMPNode) {
        if (!(xMPNode.hasQualifier() || xMPNode.getOptions().isURI() || xMPNode.getOptions().isCompositeProperty() || xMPNode.getOptions().containsOneOf(1073741824) || "[]".equals(xMPNode.getName()))) {
            return true;
        }
        return false;
    }

    private void declareNamespace(String object, String charSequence, Set set, int n2) {
        String string2 = object;
        String string3 = charSequence;
        if (charSequence == null) {
            if ((object = new QName((String)object)).hasPrefix()) {
                string2 = object.getPrefix();
                object = XMPMetaFactory.getSchemaRegistry();
                charSequence = new StringBuilder();
                charSequence.append(string2);
                charSequence.append(":");
                string3 = object.getNamespaceURI(charSequence.toString());
                this.declareNamespace(string2, string3, set, n2);
            } else {
                return;
            }
        }
        if (!set.contains(string2)) {
            this.writeNewline();
            this.writeIndent(n2);
            this.write("xmlns:");
            this.write(string2);
            this.write("=\"");
            this.write(string3);
            this.write(34);
            set.add(string2);
        }
    }

    private void declareUsedNamespaces(XMPNode object, Set set, int n2) {
        Object object2;
        if (object.getOptions().isSchemaNode()) {
            this.declareNamespace(object.getValue().substring(0, object.getValue().length() - 1), object.getName(), set, n2);
        } else if (object.getOptions().isStruct()) {
            object2 = object.iterateChildren();
            while (object2.hasNext()) {
                this.declareNamespace(((XMPNode)object2.next()).getName(), null, set, n2);
            }
        }
        object2 = object.iterateChildren();
        while (object2.hasNext()) {
            this.declareUsedNamespaces((XMPNode)object2.next(), set, n2);
        }
        object = object.iterateQualifier();
        while (object.hasNext()) {
            object2 = (XMPNode)object.next();
            this.declareNamespace(object2.getName(), null, set, n2);
            this.declareUsedNamespaces((XMPNode)object2, set, n2);
        }
    }

    /*
     * Enabled aggressive block sorting
     */
    private void emitRDFArrayTag(XMPNode object, boolean bl2, int n2) {
        if (bl2 || object.hasChildren()) {
            this.writeIndent(n2);
            String string2 = bl2 ? "<rdf:" : "</rdf:";
            this.write(string2);
            string2 = object.getOptions().isArrayAlternate() ? "Alt" : (object.getOptions().isArrayOrdered() ? "Seq" : "Bag");
            this.write(string2);
            object = bl2 && !object.hasChildren() ? "/>" : ">";
            this.write((String)object);
            this.writeNewline();
        }
    }

    private void endOuterRDFDescription(int n2) {
        this.writeIndent(n2 + 1);
        this.write("</rdf:Description>");
        this.writeNewline();
    }

    private String serializeAsRDF() {
        boolean bl2 = this.options.getOmitPacketWrapper();
        int n2 = 0;
        if (!bl2) {
            this.writeIndent(0);
            this.write(PACKET_HEADER);
            this.writeNewline();
        }
        if (!this.options.getOmitXmpMetaElement()) {
            this.writeIndent(0);
            this.write(RDF_XMPMETA_START);
            if (!this.options.getOmitVersionAttribute()) {
                this.write(XMPMetaFactory.getVersionInfo().getMessage());
            }
            this.write("\">");
            this.writeNewline();
            n2 = 1;
        }
        this.writeIndent(n2);
        this.write(RDF_RDF_START);
        this.writeNewline();
        if (this.options.getUseCanonicalFormat()) {
            this.serializeCanonicalRDFSchemas(n2);
        } else {
            this.serializeCompactRDFSchemas(n2);
        }
        this.writeIndent(n2);
        this.write(RDF_RDF_END);
        this.writeNewline();
        if (!this.options.getOmitXmpMetaElement()) {
            this.writeIndent(n2 - 1);
            this.write(RDF_XMPMETA_END);
            this.writeNewline();
        }
        String string2 = "";
        CharSequence charSequence = string2;
        if (!this.options.getOmitPacketWrapper()) {
            for (n2 = this.options.getBaseIndent(); n2 > 0; --n2) {
                charSequence = new StringBuilder();
                charSequence.append(string2);
                charSequence.append(this.options.getIndent());
                string2 = charSequence.toString();
            }
            charSequence = new StringBuilder();
            charSequence.append(string2);
            charSequence.append(PACKET_TRAILER);
            string2 = charSequence.toString();
            charSequence = new StringBuilder();
            charSequence.append(string2);
            char c2 = this.options.getReadOnlyPacket() ? (char)'r' : 'w';
            charSequence.append(c2);
            string2 = charSequence.toString();
            charSequence = new StringBuilder();
            charSequence.append(string2);
            charSequence.append(PACKET_TRAILER2);
            charSequence = charSequence.toString();
        }
        return charSequence;
    }

    /*
     * Enabled aggressive block sorting
     */
    private void serializeCanonicalRDFProperty(XMPNode object, boolean bl2, boolean bl3, int n2) {
        int n3;
        int n4;
        String string2;
        block29 : {
            block27 : {
                block28 : {
                    Object object2;
                    block31 : {
                        block23 : {
                            int n5;
                            block24 : {
                                block32 : {
                                    boolean bl4;
                                    block30 : {
                                        block25 : {
                                            int n6;
                                            int n7;
                                            block26 : {
                                                block22 : {
                                                    object2 = object.getName();
                                                    if (bl3) {
                                                        string2 = "rdf:value";
                                                    } else {
                                                        string2 = object2;
                                                        if ("[]".equals(object2)) {
                                                            string2 = "rdf:li";
                                                        }
                                                    }
                                                    this.writeIndent(n2);
                                                    this.write(60);
                                                    this.write(string2);
                                                    object2 = object.iterateQualifier();
                                                    n6 = 0;
                                                    n4 = 0;
                                                    n3 = 0;
                                                    bl4 = false;
                                                    do {
                                                        boolean bl5 = object2.hasNext();
                                                        n7 = 1;
                                                        n5 = 1;
                                                        if (!bl5) break;
                                                        XMPNode xMPNode = (XMPNode)object2.next();
                                                        if (!RDF_ATTR_QUALIFIER.contains(xMPNode.getName())) {
                                                            n3 = 1;
                                                            continue;
                                                        }
                                                        bl4 = bl5 = "rdf:resource".equals(xMPNode.getName());
                                                        if (bl3) continue;
                                                        this.write(32);
                                                        this.write(xMPNode.getName());
                                                        this.write("=\"");
                                                        this.appendNodeValue(xMPNode.getValue(), true);
                                                        this.write(34);
                                                        bl4 = bl5;
                                                    } while (true);
                                                    if (n3 == 0 || bl3) break block22;
                                                    if (bl4) {
                                                        throw new XMPException("Can't mix rdf:resource and general qualifiers", 202);
                                                    }
                                                    if (bl2) {
                                                        this.write(">");
                                                        this.writeNewline();
                                                        n3 = n2 + 1;
                                                        this.writeIndent(n3);
                                                        this.write(RDF_STRUCT_START);
                                                        object2 = ">";
                                                    } else {
                                                        object2 = " rdf:parseType=\"Resource\">";
                                                        n3 = n2;
                                                    }
                                                    this.write((String)object2);
                                                    this.writeNewline();
                                                    n2 = n3 + 1;
                                                    this.serializeCanonicalRDFProperty((XMPNode)object, bl2, true, n2);
                                                    object = object.iterateQualifier();
                                                    while (object.hasNext()) {
                                                        object2 = (XMPNode)object.next();
                                                        if (RDF_ATTR_QUALIFIER.contains(object2.getName())) continue;
                                                        this.serializeCanonicalRDFProperty((XMPNode)object2, bl2, false, n2);
                                                    }
                                                    n4 = n5;
                                                    n2 = n3;
                                                    if (!bl2) break block23;
                                                    break block24;
                                                }
                                                if (object.getOptions().isCompositeProperty()) break block25;
                                                if (!object.getOptions().isURI()) break block26;
                                                this.write(" rdf:resource=\"");
                                                this.appendNodeValue(object.getValue(), true);
                                                object = "\"/>";
                                                break block27;
                                            }
                                            if (object.getValue() == null || "".equals(object.getValue())) break block28;
                                            this.write(62);
                                            this.appendNodeValue(object.getValue(), false);
                                            n3 = n6;
                                            n4 = n7;
                                            break block29;
                                        }
                                        if (!object.getOptions().isArray()) break block30;
                                        this.write(62);
                                        this.writeNewline();
                                        n3 = n2 + 1;
                                        this.emitRDFArrayTag((XMPNode)object, true, n3);
                                        if (object.getOptions().isArrayAltText()) {
                                            XMPNodeUtils.normalizeLangArray((XMPNode)object);
                                        }
                                        object2 = object.iterateChildren();
                                        while (object2.hasNext()) {
                                            this.serializeCanonicalRDFProperty((XMPNode)object2.next(), bl2, false, n2 + 2);
                                        }
                                        this.emitRDFArrayTag((XMPNode)object, false, n3);
                                        n4 = n5;
                                        break block23;
                                    }
                                    if (bl4) break block31;
                                    if (object.hasChildren()) break block32;
                                    if (bl2) {
                                        this.write(">");
                                        this.writeNewline();
                                        this.writeIndent(n2 + 1);
                                        this.write(RDF_EMPTY_STRUCT);
                                        n3 = 1;
                                    } else {
                                        this.write(" rdf:parseType=\"Resource\"/>");
                                        n3 = n4;
                                    }
                                    this.writeNewline();
                                    n4 = n3;
                                    break block23;
                                }
                                if (bl2) {
                                    this.write(">");
                                    this.writeNewline();
                                    n3 = n2 + 1;
                                    this.writeIndent(n3);
                                    this.write(RDF_STRUCT_START);
                                    object2 = ">";
                                } else {
                                    object2 = " rdf:parseType=\"Resource\">";
                                    n3 = n2;
                                }
                                this.write((String)object2);
                                this.writeNewline();
                                object = object.iterateChildren();
                                while (object.hasNext()) {
                                    this.serializeCanonicalRDFProperty((XMPNode)object.next(), bl2, false, n3 + 1);
                                }
                                n4 = n5;
                                n2 = n3;
                                if (!bl2) break block23;
                            }
                            this.writeIndent(n3);
                            this.write("</rdf:Description>");
                            this.writeNewline();
                            n2 = n3 - 1;
                            n4 = n5;
                        }
                        n3 = 1;
                        break block29;
                    }
                    object = object.iterateChildren();
                    while (object.hasNext()) {
                        object2 = (XMPNode)object.next();
                        if (!this.canBeRDFAttrProp((XMPNode)object2)) {
                            throw new XMPException("Can't mix rdf:resource and complex fields", 202);
                        }
                        this.writeNewline();
                        this.writeIndent(n2 + 1);
                        this.write(32);
                        this.write(object2.getName());
                        this.write("=\"");
                        this.appendNodeValue(object2.getValue(), true);
                        this.write(34);
                    }
                }
                object = "/>";
            }
            this.write((String)object);
            this.writeNewline();
            return;
        }
        if (n4 == 0) return;
        if (n3 != 0) {
            this.writeIndent(n2);
        }
        this.write("</");
        this.write(string2);
        this.write(62);
        this.writeNewline();
    }

    private void serializeCanonicalRDFSchema(XMPNode object, int n2) {
        object = object.iterateChildren();
        while (object.hasNext()) {
            this.serializeCanonicalRDFProperty((XMPNode)object.next(), this.options.getUseCanonicalFormat(), false, n2 + 2);
        }
    }

    private void serializeCanonicalRDFSchemas(int n2) {
        if (this.xmp.getRoot().getChildrenLength() > 0) {
            this.startOuterRDFDescription(this.xmp.getRoot(), n2);
            Iterator iterator = this.xmp.getRoot().iterateChildren();
            while (iterator.hasNext()) {
                this.serializeCanonicalRDFSchema((XMPNode)iterator.next(), n2);
            }
            this.endOuterRDFDescription(n2);
            return;
        }
        this.writeIndent(n2 + 1);
        this.write(RDF_SCHEMA_START);
        this.writeTreeName();
        this.write("/>");
        this.writeNewline();
    }

    private void serializeCompactRDFArrayProp(XMPNode xMPNode, int n2) {
        this.write(62);
        this.writeNewline();
        int n3 = n2 + 1;
        this.emitRDFArrayTag(xMPNode, true, n3);
        if (xMPNode.getOptions().isArrayAltText()) {
            XMPNodeUtils.normalizeLangArray(xMPNode);
        }
        this.serializeCompactRDFElementProps(xMPNode, n2 + 2);
        this.emitRDFArrayTag(xMPNode, false, n3);
    }

    private boolean serializeCompactRDFAttrProps(XMPNode object, int n2) {
        object = object.iterateChildren();
        boolean bl2 = true;
        while (object.hasNext()) {
            XMPNode xMPNode = (XMPNode)object.next();
            if (this.canBeRDFAttrProp(xMPNode)) {
                this.writeNewline();
                this.writeIndent(n2);
                this.write(xMPNode.getName());
                this.write("=\"");
                this.appendNodeValue(xMPNode.getValue(), true);
                this.write(34);
                continue;
            }
            bl2 = false;
        }
        return bl2;
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive block sorting
     * Lifted jumps to return sites
     */
    private void serializeCompactRDFElementProps(XMPNode var1_1, int var2_2) {
        var8_3 = var1_1.iterateChildren();
        while (var8_3.hasNext() != false) {
            block9 : {
                var9_9 = (XMPNode)var8_3.next();
                if (this.canBeRDFAttrProp(var9_9)) continue;
                var7_8 = var9_9.getName();
                var1_1 = var7_8;
                if ("[]".equals(var7_8)) {
                    var1_1 = "rdf:li";
                }
                this.writeIndent(var2_2);
                this.write(60);
                this.write((String)var1_1);
                var7_8 = var9_9.iterateQualifier();
                var3_4 = false;
                var4_5 = false;
                do {
                    var6_7 = var7_8.hasNext();
                    var5_6 = true;
                    if (!var6_7) break;
                    var10_10 = (XMPNode)var7_8.next();
                    if (!XMPSerializerRDF.RDF_ATTR_QUALIFIER.contains(var10_10.getName())) {
                        var3_4 = true;
                        continue;
                    }
                    var4_5 = "rdf:resource".equals(var10_10.getName());
                    this.write(32);
                    this.write(var10_10.getName());
                    this.write("=\"");
                    this.appendNodeValue(var10_10.getValue(), true);
                    this.write(34);
                } while (true);
                if (!var3_4) break block9;
                this.serializeCompactRDFGeneralQualifier(var2_2, var9_9);
                ** GOTO lbl41
            }
            if (!var9_9.getOptions().isCompositeProperty()) {
                var7_8 = this.serializeCompactRDFSimpleProp(var9_9);
                var4_5 = (Boolean)var7_8[0];
                var5_6 = (Boolean)var7_8[1];
            } else if (var9_9.getOptions().isArray()) {
                this.serializeCompactRDFArrayProp(var9_9, var2_2);
lbl41: // 2 sources:
                var4_5 = true;
            } else {
                var4_5 = this.serializeCompactRDFStructProp(var9_9, var2_2, var4_5);
            }
            if (!var4_5) continue;
            if (var5_6) {
                this.writeIndent(var2_2);
            }
            this.write("</");
            this.write((String)var1_1);
            this.write(62);
            this.writeNewline();
        }
    }

    private void serializeCompactRDFGeneralQualifier(int n2, XMPNode object) {
        this.write(" rdf:parseType=\"Resource\">");
        this.writeNewline();
        this.serializeCanonicalRDFProperty((XMPNode)object, false, true, ++n2);
        object = object.iterateQualifier();
        while (object.hasNext()) {
            this.serializeCanonicalRDFProperty((XMPNode)object.next(), false, false, n2);
        }
    }

    /*
     * Enabled aggressive block sorting
     */
    private void serializeCompactRDFSchemas(int n2) {
        int n3 = n2 + 1;
        this.writeIndent(n3);
        this.write(RDF_SCHEMA_START);
        this.writeTreeName();
        Object object = new HashSet<String>();
        object.add("xml");
        object.add("rdf");
        Iterator iterator = this.xmp.getRoot().iterateChildren();
        while (iterator.hasNext()) {
            this.declareUsedNamespaces((XMPNode)iterator.next(), (Set)object, n2 + 3);
        }
        object = this.xmp.getRoot().iterateChildren();
        boolean bl2 = true;
        while (object.hasNext()) {
            bl2 &= this.serializeCompactRDFAttrProps((XMPNode)object.next(), n2 + 2);
        }
        if (!bl2) {
            this.write(62);
            this.writeNewline();
            object = this.xmp.getRoot().iterateChildren();
            while (object.hasNext()) {
                this.serializeCompactRDFElementProps((XMPNode)object.next(), n2 + 2);
            }
            this.writeIndent(n3);
            object = "</rdf:Description>";
        } else {
            object = "/>";
        }
        this.write((String)object);
        this.writeNewline();
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive block sorting
     * Lifted jumps to return sites
     */
    private Object[] serializeCompactRDFSimpleProp(XMPNode var1_1) {
        block2 : {
            var3_2 = Boolean.TRUE;
            var2_3 = Boolean.TRUE;
            if (!var1_1.getOptions().isURI()) break block2;
            this.write(" rdf:resource=\"");
            this.appendNodeValue(var1_1.getValue(), true);
            var1_1 = "\"/>";
            ** GOTO lbl16
        }
        if (var1_1.getValue() != null && var1_1.getValue().length() != 0) {
            this.write(62);
            this.appendNodeValue(var1_1.getValue(), false);
            var2_3 = Boolean.FALSE;
            var1_1 = var3_2;
            return new Object[]{var1_1, var2_3};
        } else {
            var1_1 = "/>";
lbl16: // 2 sources:
            this.write((String)var1_1);
            this.writeNewline();
            var1_1 = Boolean.FALSE;
        }
        return new Object[]{var1_1, var2_3};
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive block sorting
     * Lifted jumps to return sites
     */
    private boolean serializeCompactRDFStructProp(XMPNode var1_1, int var2_2, boolean var3_3) {
        block10 : {
            block9 : {
                block8 : {
                    var8_4 = var1_1.iterateChildren();
                    var5_5 = false;
                    var4_6 = 0;
                    do lbl-1000: // 3 sources:
                    {
                        var6_7 = var5_5;
                        var7_8 = var4_6;
                        if (!var8_4.hasNext()) break;
                        if (this.canBeRDFAttrProp((XMPNode)var8_4.next())) {
                            var6_7 = true;
                            var7_8 = var4_6;
                        } else {
                            var7_8 = 1;
                            var6_7 = var5_5;
                        }
                        var5_5 = var6_7;
                        var4_6 = var7_8;
                        if (!var6_7) ** GOTO lbl-1000
                        var5_5 = var6_7;
                        var4_6 = var7_8;
                    } while (var7_8 == 0);
                    if (var3_3) {
                        if (var7_8 != 0) throw new XMPException("Can't mix rdf:resource qualifier and element fields", 202);
                    }
                    if (var1_1.hasChildren()) break block8;
                    var1_1 = " rdf:parseType=\"Resource\"/>";
                    break block9;
                }
                if (var7_8 != 0) break block10;
                this.serializeCompactRDFAttrProps((XMPNode)var1_1, var2_2 + 1);
                var1_1 = "/>";
            }
            this.write((String)var1_1);
            this.writeNewline();
            return false;
        }
        if (!var6_7) {
            this.write(" rdf:parseType=\"Resource\">");
            this.writeNewline();
            this.serializeCompactRDFElementProps((XMPNode)var1_1, var2_2 + 1);
            return true;
        }
        this.write(62);
        this.writeNewline();
        var4_6 = var2_2 + 1;
        this.writeIndent(var4_6);
        this.write("<rdf:Description");
        this.serializeCompactRDFAttrProps((XMPNode)var1_1, var2_2 + 2);
        this.write(">");
        this.writeNewline();
        this.serializeCompactRDFElementProps((XMPNode)var1_1, var4_6);
        this.writeIndent(var4_6);
        this.write("</rdf:Description>");
        this.writeNewline();
        return true;
    }

    private void startOuterRDFDescription(XMPNode xMPNode, int n2) {
        this.writeIndent(n2 + 1);
        this.write(RDF_SCHEMA_START);
        this.writeTreeName();
        HashSet<String> hashSet = new HashSet<String>();
        hashSet.add("xml");
        hashSet.add("rdf");
        this.declareUsedNamespaces(xMPNode, hashSet, n2 + 3);
        this.write(62);
        this.writeNewline();
    }

    private void write(int n2) {
        this.writer.write(n2);
    }

    private void write(String string2) {
        this.writer.write(string2);
    }

    private void writeChars(int n2, char c2) {
        while (n2 > 0) {
            this.writer.write(c2);
            --n2;
        }
    }

    private void writeIndent(int n2) {
        for (n2 = this.options.getBaseIndent() + n2; n2 > 0; --n2) {
            this.writer.write(this.options.getIndent());
        }
    }

    private void writeNewline() {
        this.writer.write(this.options.getNewline());
    }

    private void writeTreeName() {
        this.write(34);
        String string2 = this.xmp.getRoot().getName();
        if (string2 != null) {
            this.appendNodeValue(string2, true);
        }
        this.write(34);
    }

    /*
     * Enabled aggressive block sorting
     * Lifted jumps to return sites
     */
    protected void checkOptionsConsistence() {
        block8 : {
            block7 : {
                block6 : {
                    if (this.options.getEncodeUTF16BE() | this.options.getEncodeUTF16LE()) {
                        this.unicodeSize = 2;
                    }
                    if (this.options.getExactPacketLength()) {
                        if (this.options.getOmitPacketWrapper() | this.options.getIncludeThumbnailPad()) throw new XMPException("Inconsistent options for exact size serialize", 103);
                        if ((this.options.getPadding() & this.unicodeSize - 1) != 0) throw new XMPException("Exact size must be a multiple of the Unicode element", 103);
                        return;
                    }
                    if (!this.options.getReadOnlyPacket()) break block6;
                    if (this.options.getOmitPacketWrapper() | this.options.getIncludeThumbnailPad()) throw new XMPException("Inconsistent options for read-only packet", 103);
                    break block7;
                }
                if (!this.options.getOmitPacketWrapper()) break block8;
                if (this.options.getIncludeThumbnailPad()) throw new XMPException("Inconsistent options for non-packet serialize", 103);
            }
            this.padding = 0;
            return;
        }
        if (this.padding == 0) {
            this.padding = this.unicodeSize * 2048;
        }
        if (!this.options.getIncludeThumbnailPad()) return;
        if (this.xmp.doesPropertyExist("http://ns.adobe.com/xap/1.0/", "Thumbnails")) return;
        this.padding += this.unicodeSize * 10000;
    }

    /*
     * Enabled force condition propagation
     * Lifted jumps to return sites
     */
    public void serialize(XMPMeta object, OutputStream outputStream, SerializeOptions serializeOptions) {
        try {
            this.outputStream = new CountOutputStream(outputStream);
            this.writer = new OutputStreamWriter((OutputStream)this.outputStream, serializeOptions.getEncoding());
            this.xmp = (XMPMetaImpl)object;
            this.options = serializeOptions;
            this.padding = serializeOptions.getPadding();
            this.writer = new OutputStreamWriter((OutputStream)this.outputStream, serializeOptions.getEncoding());
            this.checkOptionsConsistence();
            object = this.serializeAsRDF();
            this.writer.flush();
            this.addPadding(object.length());
            this.write((String)object);
            this.writer.flush();
            this.outputStream.close();
            return;
        }
        catch (IOException iOException) {
            throw new XMPException("Error writing to the OutputStream", 0);
        }
    }
}

