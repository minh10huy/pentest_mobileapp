/*
 * Decompiled with CFR 0_132.
 * 
 * Could not load the following classes:
 *  android.content.Context
 *  android.content.SharedPreferences
 *  android.content.SharedPreferences$Editor
 *  android.text.TextUtils
 *  org.json.JSONArray
 *  org.json.JSONException
 *  org.json.JSONObject
 */
package com.google.firebase.auth.internal;

import android.content.Context;
import android.content.SharedPreferences;
import android.text.TextUtils;
import com.google.android.gms.common.internal.ah;
import com.google.android.gms.internal.azm;
import com.google.android.gms.internal.bbc;
import com.google.android.gms.internal.xu;
import com.google.firebase.auth.internal.e;
import com.google.firebase.auth.internal.h;
import com.google.firebase.auth.j;
import com.google.firebase.auth.o;
import com.google.firebase.b;
import java.util.ArrayList;
import java.util.List;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

public final class q {
    private Context a;
    private String b;
    private SharedPreferences c;
    private xu d;

    public q(Context object, String string2) {
        ah.a(object);
        this.b = ah.a(string2);
        this.a = object.getApplicationContext();
        object = String.format("com.google.firebase.auth.api.Store.%s", this.b);
        this.c = this.a.getSharedPreferences((String)object, 0);
        this.d = new xu("StorageHelpers", new String[0]);
    }

    private final h a(JSONObject object) {
        boolean bl2;
        String string2;
        Object object2;
        String string3;
        String string4;
        block8 : {
            string4 = object.getString("cachedTokenState");
            string2 = object.getString("applicationName");
            bl2 = object.getBoolean("anonymous");
            string3 = "2";
            object2 = object.getString("version");
            if (object2 == null) break block8;
            string3 = object2;
        }
        object = object.getJSONArray("userInfos");
        int n2 = object.length();
        object2 = new ArrayList(n2);
        for (int i2 = 0; i2 < n2; ++i2) {
            object2.add(e.a(object.getString(i2)));
            continue;
        }
        try {
            object = new h(b.a(string2), (List<? extends o>)object2);
            if (!TextUtils.isEmpty((CharSequence)string4)) {
                object.a(bbc.b(string4));
            }
            ((h)object.a(bl2)).a(string3);
            return object;
        }
        catch (azm | ArrayIndexOutOfBoundsException | IllegalArgumentException | JSONException object3) {
            this.d.a((Throwable)object3);
            return null;
        }
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    private final String c(j object) {
        JSONObject jSONObject = new JSONObject();
        if (!h.class.isAssignableFrom(object.getClass())) {
            return null;
        }
        object = (h)object;
        try {
            jSONObject.put("cachedTokenState", (Object)object.g());
            jSONObject.put("applicationName", (Object)object.e().b());
            jSONObject.put("type", (Object)"com.google.firebase.auth.internal.DefaultFirebaseUser");
            if (object.k() != null) {
                JSONArray jSONArray = new JSONArray();
                List<e> list = object.k();
                for (int i2 = 0; i2 < list.size(); ++i2) {
                    jSONArray.put((Object)list.get(i2).f());
                }
                jSONObject.put("userInfos", (Object)jSONArray);
            }
            jSONObject.put("anonymous", object.b());
            jSONObject.put("version", (Object)"2");
            return jSONObject.toString();
        }
        catch (Exception exception) {
            this.d.a("Failed to turn object into JSON", exception, new Object[0]);
            throw new azm(exception);
        }
    }

    public final j a() {
        Object object = this.c.getString("com.google.firebase.auth.FIREBASE_USER", null);
        if (TextUtils.isEmpty((CharSequence)object)) {
            return null;
        }
        try {
            object = new JSONObject((String)object);
            if (object.has("type") && "com.google.firebase.auth.internal.DefaultFirebaseUser".equalsIgnoreCase(object.optString("type"))) {
                object = this.a((JSONObject)object);
                return object;
            }
            return null;
        }
        catch (Exception exception) {
            return null;
        }
    }

    public final void a(j object) {
        ah.a(object);
        object = this.c((j)object);
        if (!TextUtils.isEmpty((CharSequence)object)) {
            this.c.edit().putString("com.google.firebase.auth.FIREBASE_USER", (String)object).apply();
        }
    }

    public final void a(j j2, bbc bbc2) {
        ah.a(j2);
        ah.a(bbc2);
        this.c.edit().putString(String.format("com.google.firebase.auth.GET_TOKEN_RESPONSE.%s", j2.a()), bbc2.f()).apply();
    }

    public final void a(String string2) {
        this.c.edit().remove(string2).apply();
    }

    public final bbc b(j object) {
        ah.a(object);
        object = this.c.getString(String.format("com.google.firebase.auth.GET_TOKEN_RESPONSE.%s", object.a()), null);
        if (object != null) {
            return bbc.b((String)object);
        }
        return null;
    }
}

