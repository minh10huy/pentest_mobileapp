/*
 * Decompiled with CFR 0_132.
 * 
 * Could not load the following classes:
 *  android.app.PendingIntent
 *  android.content.Context
 *  android.content.Intent
 *  android.os.Bundle
 *  android.os.Handler
 *  android.os.Looper
 *  android.os.Message
 *  android.os.Messenger
 *  android.os.Parcelable
 *  android.util.Log
 */
package com.google.firebase.iid;

import android.app.PendingIntent;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.os.Message;
import android.os.Messenger;
import android.os.Parcelable;
import android.util.Log;
import com.google.android.gms.c.e;
import com.google.android.gms.c.f;
import com.google.android.gms.c.h;
import com.google.firebase.iid.aa;
import com.google.firebase.iid.ac;
import com.google.firebase.iid.m;
import com.google.firebase.iid.o;
import com.google.firebase.iid.y;
import java.util.concurrent.ExecutionException;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

final class ab {
    private static int a;
    private static PendingIntent b;
    private final android.support.v4.g.m<String, f<Bundle>> c = new android.support.v4.g.m();
    private final Context d;
    private final aa e;
    private Messenger f;
    private Messenger g;
    private m h;

    public ab(Context context, aa aa2) {
        this.d = context;
        this.e = aa2;
        this.f = new Messenger((Handler)new ac(this, Looper.getMainLooper()));
    }

    private static String a() {
        synchronized (ab.class) {
            int n2 = a;
            a = n2 + 1;
            String string2 = Integer.toString(n2);
            return string2;
        }
    }

    private static void a(Context context, Intent intent) {
        synchronized (ab.class) {
            if (b == null) {
                Intent intent2 = new Intent();
                intent2.setPackage("com.google.example.invalidpackage");
                b = PendingIntent.getBroadcast((Context)context, (int)0, (Intent)intent2, (int)0);
            }
            intent.putExtra("app", (Parcelable)b);
            return;
        }
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    private final void a(Intent object) {
        Object object2;
        String string2 = object.getStringExtra("error");
        if (string2 == null) {
            object = String.valueOf((Object)object.getExtras());
            StringBuilder stringBuilder = new StringBuilder(String.valueOf(object).length() + 49);
            stringBuilder.append("Unexpected response, no error or registration id ");
            stringBuilder.append((String)object);
            Log.w((String)"FirebaseInstanceId", (String)stringBuilder.toString());
            return;
        }
        if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
            object2 = String.valueOf(string2);
            object2 = object2.length() != 0 ? "Received InstanceID error ".concat((String)object2) : new String("Received InstanceID error ");
            Log.d((String)"FirebaseInstanceId", (String)object2);
        }
        if (string2.startsWith("|")) {
            object2 = string2.split("\\|");
            if (((String[])object2).length > 2 && "ID".equals(object2[1])) {
                String string3 = object2[2];
                string2 = object2[3];
                object2 = string2;
                if (string2.startsWith(":")) {
                    object2 = string2.substring(1);
                }
                this.a(string3, object.putExtra("error", (String)object2).getExtras());
                return;
            }
            object = String.valueOf(string2);
            object = object.length() != 0 ? "Unexpected structured response ".concat((String)object) : new String("Unexpected structured response ");
            Log.w((String)"FirebaseInstanceId", (String)object);
            return;
        }
        object2 = this.c;
        synchronized (object2) {
            int n2 = 0;
            while (n2 < this.c.size()) {
                this.a(this.c.b(n2), object.getExtras());
                ++n2;
            }
            return;
        }
    }

    private final void a(Message object) {
        if (object != null && object.obj instanceof Intent) {
            Intent intent;
            Object object2 = (Intent)object.obj;
            object2.setExtrasClassLoader((ClassLoader)new m.a());
            if (object2.hasExtra("google.messenger")) {
                if ((object2 = object2.getParcelableExtra("google.messenger")) instanceof m) {
                    this.h = (m)object2;
                }
                if (object2 instanceof Messenger) {
                    this.g = (Messenger)object2;
                }
            }
            if (!"com.google.android.c2dm.intent.REGISTRATION".equals(object = (intent = (Intent)object.obj).getAction())) {
                if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
                    object = (object = String.valueOf(object)).length() != 0 ? "Unexpected response action: ".concat((String)object) : new String("Unexpected response action: ");
                    Log.d((String)"FirebaseInstanceId", (String)object);
                }
                return;
            }
            object = object2 = intent.getStringExtra("registration_id");
            if (object2 == null) {
                object = intent.getStringExtra("unregistered");
            }
            if (object == null) {
                this.a(intent);
                return;
            }
            object2 = Pattern.compile("\\|ID\\|([^|]+)\\|:?+(.*)").matcher((CharSequence)object);
            if (!object2.matches()) {
                if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
                    object = (object = String.valueOf(object)).length() != 0 ? "Unexpected response string: ".concat((String)object) : new String("Unexpected response string: ");
                    Log.d((String)"FirebaseInstanceId", (String)object);
                }
                return;
            }
            object = object2.group(1);
            object2 = object2.group(2);
            intent = intent.getExtras();
            intent.putString("registration_id", (String)object2);
            this.a((String)object, (Bundle)intent);
            return;
        }
        Log.w((String)"FirebaseInstanceId", (String)"Dropping invalid message");
    }

    static /* synthetic */ void a(ab ab2, Message message) {
        ab2.a(message);
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    private final void a(String string2, Bundle bundle) {
        android.support.v4.g.m<String, f<Bundle>> m2 = this.c;
        synchronized (m2) {
            f<Bundle> f2 = this.c.remove(string2);
            if (f2 != null) {
                f2.a(bundle);
                return;
            }
            string2 = (string2 = String.valueOf(string2)).length() != 0 ? "Missing callback for ".concat(string2) : new String("Missing callback for ");
            Log.w((String)"FirebaseInstanceId", (String)string2);
            return;
        }
    }

    private final Bundle b(Bundle bundle) {
        Bundle bundle2;
        Bundle bundle3 = bundle2 = this.c(bundle);
        if (bundle2 != null) {
            bundle3 = bundle2;
            if (bundle2.containsKey("google.messenger")) {
                bundle3 = bundle = this.c(bundle);
                if (bundle != null) {
                    bundle3 = bundle;
                    if (bundle.containsKey("google.messenger")) {
                        bundle3 = null;
                    }
                }
            }
        }
        return bundle3;
    }

    /*
     * Exception decompiling
     */
    private final Bundle c(Bundle var1_1) {
        // This method has failed to decompile.  When submitting a bug report, please provide this stack trace, and (if you hold appropriate legal rights) the relevant class file.
        // org.benf.cfr.reader.util.ConfusedCFRException: Tried to end blocks [12[CATCHBLOCK]], but top level block is 4[TRYBLOCK]
        // org.benf.cfr.reader.bytecode.analysis.opgraph.Op04StructuredStatement.processEndingBlocks(Op04StructuredStatement.java:416)
        // org.benf.cfr.reader.bytecode.analysis.opgraph.Op04StructuredStatement.buildNestedBlocks(Op04StructuredStatement.java:468)
        // org.benf.cfr.reader.bytecode.analysis.opgraph.Op03SimpleStatement.createInitialStructuredBlock(Op03SimpleStatement.java:2960)
        // org.benf.cfr.reader.bytecode.CodeAnalyser.getAnalysisInner(CodeAnalyser.java:818)
        // org.benf.cfr.reader.bytecode.CodeAnalyser.getAnalysisOrWrapFail(CodeAnalyser.java:196)
        // org.benf.cfr.reader.bytecode.CodeAnalyser.getAnalysis(CodeAnalyser.java:141)
        // org.benf.cfr.reader.entities.attributes.AttributeCode.analyse(AttributeCode.java:95)
        // org.benf.cfr.reader.entities.Method.analyse(Method.java:372)
        // org.benf.cfr.reader.entities.ClassFile.analyseMid(ClassFile.java:867)
        // org.benf.cfr.reader.entities.ClassFile.analyseTop(ClassFile.java:768)
        // org.benf.cfr.reader.Main.doJar(Main.java:141)
        // org.benf.cfr.reader.Main.main(Main.java:242)
        throw new IllegalStateException("Decompilation failed");
    }

    final Bundle a(Bundle bundle) {
        if (this.e.d() >= 12000000) {
            Bundle bundle2 = o.a(this.d).b(1, bundle);
            try {
                bundle2 = h.a(bundle2);
                return bundle2;
            }
            catch (InterruptedException | ExecutionException exception) {
                if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
                    String string2 = String.valueOf(exception);
                    StringBuilder stringBuilder = new StringBuilder(String.valueOf(string2).length() + 22);
                    stringBuilder.append("Error making request: ");
                    stringBuilder.append(string2);
                    Log.d((String)"FirebaseInstanceId", (String)stringBuilder.toString());
                }
                if (exception.getCause() instanceof y && ((y)exception.getCause()).a() == 4) {
                    return this.b(bundle);
                }
                return null;
            }
        }
        return this.b(bundle);
    }
}

