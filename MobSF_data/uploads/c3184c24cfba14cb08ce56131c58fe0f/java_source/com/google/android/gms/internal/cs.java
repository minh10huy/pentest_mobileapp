/*
 * Decompiled with CFR 0_132.
 * 
 * Could not load the following classes:
 *  android.content.Context
 *  android.content.pm.ApplicationInfo
 *  android.content.pm.PackageInfo
 *  android.location.Location
 *  android.net.ConnectivityManager
 *  android.net.NetworkInfo
 *  android.os.Bundle
 *  android.os.Handler
 *  android.os.Looper
 *  android.text.TextUtils
 *  org.json.JSONException
 *  org.json.JSONObject
 */
package com.google.android.gms.internal;

import android.content.Context;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageInfo;
import android.location.Location;
import android.net.ConnectivityManager;
import android.net.NetworkInfo;
import android.os.Bundle;
import android.os.Handler;
import android.os.Looper;
import android.text.TextUtils;
import com.google.android.gms.ads.c.a;
import com.google.android.gms.ads.internal.av;
import com.google.android.gms.common.util.n;
import com.google.android.gms.internal.ak;
import com.google.android.gms.internal.bj;
import com.google.android.gms.internal.bn;
import com.google.android.gms.internal.bnx;
import com.google.android.gms.internal.bpu;
import com.google.android.gms.internal.bpy;
import com.google.android.gms.internal.bqj;
import com.google.android.gms.internal.bs;
import com.google.android.gms.internal.bsy;
import com.google.android.gms.internal.bsz;
import com.google.android.gms.internal.btk;
import com.google.android.gms.internal.btv;
import com.google.android.gms.internal.btx;
import com.google.android.gms.internal.bu;
import com.google.android.gms.internal.bx;
import com.google.android.gms.internal.cad;
import com.google.android.gms.internal.cat;
import com.google.android.gms.internal.cc;
import com.google.android.gms.internal.cdw;
import com.google.android.gms.internal.cq;
import com.google.android.gms.internal.cr;
import com.google.android.gms.internal.ct;
import com.google.android.gms.internal.cu;
import com.google.android.gms.internal.cv;
import com.google.android.gms.internal.cw;
import com.google.android.gms.internal.cx;
import com.google.android.gms.internal.cy;
import com.google.android.gms.internal.dc;
import com.google.android.gms.internal.de;
import com.google.android.gms.internal.dg;
import com.google.android.gms.internal.dn;
import com.google.android.gms.internal.do;
import com.google.android.gms.internal.dp;
import com.google.android.gms.internal.dq;
import com.google.android.gms.internal.gf;
import com.google.android.gms.internal.gk;
import com.google.android.gms.internal.hc;
import com.google.android.gms.internal.he;
import com.google.android.gms.internal.hm;
import com.google.android.gms.internal.hs;
import com.google.android.gms.internal.kd;
import com.google.android.gms.internal.km;
import com.google.android.gms.internal.kp;
import com.google.android.gms.internal.ks;
import com.google.android.gms.internal.ku;
import com.google.android.gms.internal.lf;
import java.io.BufferedOutputStream;
import java.io.Closeable;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLConnection;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.UUID;
import java.util.concurrent.Executor;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;
import org.json.JSONException;
import org.json.JSONObject;

@ak
public final class cs
extends bs {
    private static final Object a = new Object();
    private static cs b;
    private final Context c;
    private final cr d;
    private final ScheduledExecutorService e = Executors.newSingleThreadScheduledExecutor();

    private cs(Context context, cr cr2) {
        this.c = context;
        this.d = cr2;
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    private static bn a(Context object, cr cr2, bj bj2, ScheduledExecutorService object2) {
        JSONObject jSONObject;
        Object object3;
        Object object4;
        btv btv2;
        btx btx2;
        void var2_5;
        void var5_25;
        void var0_3;
        Object object5;
        Object object6;
        void var5_20;
        void var5_14;
        he.b("Starting ad request from service using: google.afma.request.getAdDictionary");
        bsz<Boolean> bsz2 = btk.J;
        btx2 = new btx(bqj.f().a(bsz2), "load_ad", var2_5.d.a);
        if (var2_5.a > 10 && var2_5.A != -1L) {
            btx2.a(btx2.a(var2_5.A), "cts");
        }
        btv2 = btx2.a();
        lf<Bundle> lf2 = var1_4.i.a((Context)object);
        object4 = btk.cq;
        Bundle bundle = ku.a(lf2, bqj.f().a(object4), TimeUnit.MILLISECONDS, (ScheduledExecutorService)object5);
        lf<dq> lf3 = var1_4.h.a((Context)object);
        object4 = btk.bn;
        Object object7 = ku.a(lf3, bqj.f().a(object4), TimeUnit.MILLISECONDS, (ScheduledExecutorService)object5);
        Object object8 = var1_4.c.a(var2_5.g.packageName);
        Object object9 = var1_4.j.a(var2_5.h, var2_5.g);
        Object object10 = av.p().a((Context)object);
        object4 = ku.a(null);
        Bundle bundle2 = var2_5.c.c;
        boolean bl2 = bundle2 != null && bundle2.getString("_ad") != null;
        bsz<Long> bsz3 = object4;
        if (var2_5.G) {
            bsz<Long> bsz4 = object4;
            if (!bl2) {
                lf<Location> lf4 = var1_4.f.a(var2_5.f);
            }
        }
        object4 = btk.ch;
        Location location = ku.a(var5_14, bqj.f().a(object4), TimeUnit.MILLISECONDS, (ScheduledExecutorService)object5);
        object4 = ku.a(null);
        bsz<Boolean> bsz5 = btk.aC;
        if (bqj.f().a(bsz5).booleanValue()) {
            lf<a.a> lf5 = var1_4.j.a((Context)object);
            object4 = btk.aD;
            object4 = ku.a(lf5, bqj.f().a(object4), TimeUnit.MILLISECONDS, (ScheduledExecutorService)object5);
        }
        if (var2_5.a >= 4 && var2_5.o != null) {
            Bundle bundle3 = var2_5.o;
        } else {
            Object var5_19 = null;
        }
        object3 = btk.Z;
        bqj.f().a(object3).booleanValue();
        av.e();
        if (hs.a(object, object.getPackageName(), "android.permission.ACCESS_NETWORK_STATE") && ((ConnectivityManager)object.getSystemService("connectivity")).getActiveNetworkInfo() == null) {
            he.b("Device is offline.");
        }
        object3 = var2_5.a >= 7 ? var2_5.v : UUID.randomUUID().toString();
        new cy((Context)object, (String)object3, var2_5.f.packageName);
        if (var2_5.c.c != null && (object6 = var2_5.c.c.getString("_ad")) != null) {
            return cx.a(object, (bj)var2_5, (String)object6);
        }
        object6 = var1_4.d.a(var2_5.w);
        Object object11 = btk.cq;
        bundle = ku.a(bundle, null, bqj.f().a(object11), TimeUnit.MILLISECONDS);
        object7 = ku.a(object7, null);
        location = ku.a(location, null);
        object11 = ku.a(object4, null);
        object9 = ku.a(object9, null);
        object4 = ku.a(object8, null);
        if ((object10 = (dg)ku.a(object10, null)) == null) {
            he.e("Error fetching device info. This is not recoverable.");
            return new bn(0);
        }
        object8 = new cq();
        object8.i = var2_5;
        object8.j = object10;
        object8.e = object7;
        object8.d = location;
        object8.b = bundle;
        object8.g = object9;
        object8.h = object11;
        if (object6 == null) {
            object8.c.clear();
        }
        object8.c = object6;
        object8.a = var5_20;
        object8.f = object4;
        object8.k = var1_4.b.a((Context)object);
        object8.l = var1_4.k;
        jSONObject = cx.a(object, (cq)object8);
        if (jSONObject == null) {
            return new bn(0);
        }
        if (var2_5.a < 7) {
            try {
                jSONObject.put("request_id", object3);
            }
            catch (JSONException jSONException) {}
        }
        jSONObject.toString();
        btx2.a(btv2, "arc");
        btx2.a();
        object5 = ku.a(ku.a(var1_4.l.a().b(jSONObject), ct.a, (Executor)object5), 10L, TimeUnit.SECONDS, (ScheduledExecutorService)object5);
        lf<Void> lf6 = var1_4.e.a();
        if (lf6 != null) {
            ks.a(lf6, "AdRequestServiceImpl.loadAd.flags");
        }
        Object var5_23 = null;
        object3 = ku.a(object5, null);
        if (object3 == null) {
            return new bn(0);
        }
        if (object3.a() != -2) {
            return new bn(object3.a());
        }
        btx2.d();
        if (!TextUtils.isEmpty((CharSequence)object3.i())) {
            bn bn2 = cx.a(object, (bj)var2_5, object3.i());
        }
        object5 = var5_25;
        if (var5_25 == null) {
            object5 = var5_25;
            if (!TextUtils.isEmpty((CharSequence)object3.e())) {
                void var1_4;
                object5 = cs.a((bj)var2_5, object, var2_5.k.a, object3.e(), (String)object4, (de)object3, btx2, (cr)var1_4);
            }
        }
        lf lf7 = object5;
        if (object5 == null) {
            bn bn3 = new bn(0);
        }
        btx2.a(btv2, "tts");
        var0_3.w = btx2.b();
        return var0_3;
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     * Lifted jumps to return sites
     */
    public static bn a(bj var0, Context var1_6, String var2_10, String var3_11, String var4_12, de var5_13, btx var6_14, cr var7_15) {
        var12_17 = var6_15 != null ? var6_15.a() : null;
        try {
            var17_18 = new dc((bj)var0, var5_14.c());
            var13_19 /* !! */  = String.valueOf(var3_12);
            var13_19 /* !! */  = var13_19 /* !! */ .length() != 0 ? "AdRequestServiceImpl: Sending request: ".concat((String)var13_19 /* !! */ ) : new String("AdRequestServiceImpl: Sending request: ");
            he.b((String)var13_19 /* !! */ );
            var3_12 = new URL((String)var3_12);
            var10_20 = av.l().b();
            var8_21 = 0;
            do {
                var14_23 = var0;
                if (var7_16 != null) {
                    var7_16.g.a();
                }
                var16_25 = (HttpURLConnection)var3_12.openConnection();
                break;
            } while (true);
        }
        catch (IOException var0_3) {
            var0_4 = String.valueOf(var0_3.getMessage());
            var0_4 = var0_4.length() != 0 ? "Error while connecting to ad server: ".concat(var0_4) : new String("Error while connecting to ad server: ");
            he.e(var0_4);
            return new bn(2);
        }
        {
            block33 : {
                block32 : {
                    block35 : {
                        block34 : {
                            block31 : {
                                av.e().a((Context)var1_7 /* !! */ , var2_11, false, var16_25);
                                if (!TextUtils.isEmpty((CharSequence)var4_13) && var5_14.g()) {
                                    var16_25.addRequestProperty("x-afma-drt-cookie", (String)var4_13);
                                }
                                var13_19 /* !! */  = var14_23.H;
                                if (!TextUtils.isEmpty((CharSequence)var13_19 /* !! */ )) {
                                    he.b("Sending webview cookie in ad request header.");
                                    var16_25.addRequestProperty("Cookie", (String)var13_19 /* !! */ );
                                }
                                if (var5_14 == null || TextUtils.isEmpty((CharSequence)var5_14.d())) ** GOTO lbl48
                                var16_25.setDoOutput(true);
                                var15_24 = var5_14.d().getBytes();
                                var16_25.setFixedLengthStreamingMode(var15_24.length);
                                var13_19 /* !! */  = new BufferedOutputStream(var16_25.getOutputStream());
                                var13_19 /* !! */ .write(var15_24);
                                {
                                    catch (Throwable var0_5) {
                                        var1_7 /* !! */  = var13_19 /* !! */ ;
                                        break block31;
                                    }
                                }
                                n.a((Closeable)var13_19 /* !! */ );
                                var13_19 /* !! */  = var15_24;
                                break block34;
                                catch (Throwable var0_6) {
                                    var1_7 /* !! */  = null;
                                }
                            }
                            n.a(var1_7 /* !! */ );
                            throw var0_1;
lbl48: // 1 sources:
                            var13_19 /* !! */  = null;
                        }
                        var14_23 = new kd(var14_23.v);
                        var14_23.a(var16_25, var13_19 /* !! */ );
                        var9_22 = var16_25.getResponseCode();
                        var13_19 /* !! */  = var16_25.getHeaderFields();
                        var14_23.a(var16_25, var9_22);
                        if (var9_22 < 200 || var9_22 >= 300) ** GOTO lbl84
                        var1_7 /* !! */  = var3_12.toString();
                        var0 = new InputStreamReader(var16_25.getInputStream());
                        try {
                            av.e();
                            var2_11 = hs.a((InputStreamReader)var0);
                        }
                        catch (Throwable var1_8) {}
                        n.a((Closeable)var0);
                        var14_23.a(var2_11);
                        cs.a((String)var1_7 /* !! */ , (Map<String, List<String>>)var13_19 /* !! */ , var2_11, var9_22);
                        var17_18.a((String)var1_7 /* !! */ , (Map<String, List<String>>)var13_19 /* !! */ , var2_11);
                        if (var6_15 != null) {
                            var6_15.a(var12_17, new String[]{"ufe"});
                        }
                        var0 = var17_18.a(var10_20, var5_14.j());
                        var16_25.disconnect();
                        if (var7_16 == null) return var0;
                        var7_16.g.b();
                        return var0;
                        break block35;
                        catch (Throwable var1_9) {
                            var0 = null;
                        }
                    }
                    n.a((Closeable)var0);
                    throw var1_10;
lbl84: // 1 sources:
                    cs.a(var3_12.toString(), (Map<String, List<String>>)var13_19 /* !! */ , null, var9_22);
                    if (var9_22 < 300 || var9_22 >= 400) break;
                    var3_12 = var16_25.getHeaderField("Location");
                    if (!TextUtils.isEmpty((CharSequence)var3_12)) break block32;
                    he.e("No location header to follow redirect.");
                    var0 = new bn(0);
                    var16_25.disconnect();
                    if (var7_16 == null) return var0;
                    var7_16.g.b();
                    return var0;
                }
                var3_12 = new URL((String)var3_12);
                ++var8_21;
                var14_23 = btk.cS;
                if (var8_21 <= bqj.f().a(var14_23)) break block33;
                he.e("Too many redirects.");
                var0 = new bn(0);
                var16_25.disconnect();
                if (var7_16 == null) return var0;
                var7_16.g.b();
                return var0;
            }
            var17_18.a((Map<String, List<String>>)var13_19 /* !! */ );
            var16_25.disconnect();
            if (var7_16 == null) continue;
            var7_16.g.b();
            continue;
        }
        var0 = new StringBuilder(46);
        var0.append("Received error HTTP response code: ");
        var0.append(var9_22);
        he.e(var0.toString());
        var0 = new bn(0);
        {
            catch (Throwable var0_2) {
                var16_25.disconnect();
                if (var7_16 == null) throw var0_2;
                var7_16.g.b();
                throw var0_2;
            }
        }
        var16_25.disconnect();
        if (var7_16 == null) return var0;
        var7_16.g.b();
        return var0;
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    public static cs a(Context object, cr cr2) {
        Object object2 = a;
        synchronized (object2) {
            if (b != null) return b;
            Context context = object;
            if (object.getApplicationContext() != null) {
                context = object.getApplicationContext();
            }
            btk.a(context);
            b = new cs(context, cr2);
            if (context.getApplicationContext() != null) {
                av.e().c(context);
            }
            hc.a(context);
            return b;
        }
    }

    static final /* synthetic */ lf a(JSONObject jSONObject) {
        return ku.a(new de(jSONObject));
    }

    private static void a(String charSequence2, Map<String, List<String>> map, String string2, int n2) {
        if (he.a(2)) {
            void var2_10;
            void var1_9;
            void var3_11;
            StringBuilder stringBuilder = new StringBuilder(String.valueOf(charSequence2).length() + 39);
            stringBuilder.append("Http Response: {\n  URL:\n    ");
            stringBuilder.append((String)charSequence2);
            stringBuilder.append("\n  Headers:");
            he.a(stringBuilder.toString());
            if (var1_9 != null) {
                for (String string3 : var1_9.keySet()) {
                    Object object = new StringBuilder(String.valueOf(string3).length() + 5);
                    object.append("    ");
                    object.append(string3);
                    object.append(":");
                    he.a(object.toString());
                    object = ((List)var1_9.get(string3)).iterator();
                    while (object.hasNext()) {
                        void var0_7;
                        String string4 = String.valueOf((String)object.next());
                        if (string4.length() != 0) {
                            String string5 = "      ".concat(string4);
                        } else {
                            String string6 = new String("      ");
                        }
                        he.a((String)var0_7);
                    }
                }
            }
            he.a("  Body:");
            if (var2_10 != null) {
                int n3 = 0;
                while (n3 < Math.min(var2_10.length(), 100000)) {
                    int n4 = var2_10.length();
                    int n5 = n3 + 1000;
                    he.a(var2_10.substring(n3, Math.min(n4, n5)));
                    n3 = n5;
                }
            } else {
                he.a("    null");
            }
            StringBuilder stringBuilder2 = new StringBuilder(34);
            stringBuilder2.append("  Response Code:\n    ");
            stringBuilder2.append((int)var3_11);
            stringBuilder2.append("\n}");
            he.a(stringBuilder2.toString());
        }
    }

    @Override
    public final bn a(bj bj2) {
        return cs.a(this.c, this.d, bj2, this.e);
    }

    @Override
    public final void a(bj object, bu bu2) {
        av.i().a(this.c, object.k);
        object = hm.a(new cu(this, (bj)object, bu2));
        av.t().a();
        av.t().b().postDelayed((Runnable)new cv(this, (Future)object), 60000L);
    }

    @Override
    public final void a(cc cc2, bx bx2) {
        he.a("Nonagon code path entered in octagon");
        throw new IllegalArgumentException();
    }
}

