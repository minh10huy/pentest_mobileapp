/*
 * Decompiled with CFR 0_132.
 * 
 * Could not load the following classes:
 *  android.content.Context
 *  android.content.SharedPreferences
 *  android.content.SharedPreferences$Editor
 *  android.os.Bundle
 *  android.os.Parcel
 *  android.os.Parcelable
 *  android.os.Parcelable$Creator
 *  android.util.Base64
 */
package com.google.android.gms.internal;

import android.content.Context;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.os.Parcel;
import android.os.Parcelable;
import android.util.Base64;
import com.google.android.gms.ads.internal.av;
import com.google.android.gms.ads.internal.l;
import com.google.android.gms.internal.ak;
import com.google.android.gms.internal.bpu;
import com.google.android.gms.internal.bqj;
import com.google.android.gms.internal.bsz;
import com.google.android.gms.internal.btk;
import com.google.android.gms.internal.byp;
import com.google.android.gms.internal.bzv;
import com.google.android.gms.internal.bzw;
import com.google.android.gms.internal.bzx;
import com.google.android.gms.internal.bzy;
import com.google.android.gms.internal.caa;
import com.google.android.gms.internal.dg;
import com.google.android.gms.internal.dh;
import com.google.android.gms.internal.he;
import java.io.IOException;
import java.io.UnsupportedEncodingException;
import java.util.Collection;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.Map;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

@ak
public final class bzu {
    private final Map<bzv, bzw> a = new HashMap<bzv, bzw>();
    private final LinkedList<bzv> b = new LinkedList();
    private byp c;

    static Set<String> a(bpu bpu2) {
        HashSet<String> hashSet = new HashSet<String>();
        hashSet.addAll(bpu2.c.keySet());
        bpu2 = bpu2.m.getBundle("com.google.ads.mediation.admob.AdMobAdapter");
        if (bpu2 != null) {
            hashSet.addAll(bpu2.keySet());
        }
        return hashSet;
    }

    private static void a(Bundle bundle, String object) {
        while (((String[])(object = object.split("/", 2))).length != 0) {
            String string2 = object[0];
            if (((String[])object).length == 1) {
                bundle.remove(string2);
                return;
            }
            if ((bundle = bundle.getBundle(string2)) == null) {
                return;
            }
            object = object[1];
        }
        return;
    }

    private static void a(String string2, bzv bzv2) {
        if (he.a(2)) {
            he.a(String.format(string2, bzv2));
        }
    }

    /*
     * Enabled force condition propagation
     * Lifted jumps to return sites
     */
    private static String[] a(String arrstring) {
        int n2;
        try {
            arrstring = arrstring.split("\u0000");
            n2 = 0;
        }
        catch (UnsupportedEncodingException unsupportedEncodingException) {
            return new String[0];
        }
        do {
            if (n2 >= arrstring.length) return arrstring;
            arrstring[n2] = new String(Base64.decode((String)arrstring[n2], (int)0), "UTF-8");
            ++n2;
            continue;
            break;
        } while (true);
    }

    static bpu b(bpu bpu2) {
        bpu2 = bzu.d(bpu2);
        Bundle bundle = bpu2.m.getBundle("com.google.ads.mediation.admob.AdMobAdapter");
        if (bundle != null) {
            bundle.putBoolean("_skipMediation", true);
        }
        bpu2.c.putBoolean("_skipMediation", true);
        return bpu2;
    }

    /*
     * Enabled force condition propagation
     * Lifted jumps to return sites
     */
    private final String b() {
        try {
            CharSequence charSequence = new StringBuilder();
            Iterator<bzv> iterator = this.b.iterator();
            while (iterator.hasNext()) {
                charSequence.append(Base64.encodeToString((byte[])iterator.next().toString().getBytes("UTF-8"), (int)0));
                if (!iterator.hasNext()) continue;
                charSequence.append("\u0000");
            }
            return charSequence.toString();
        }
        catch (UnsupportedEncodingException unsupportedEncodingException) {
            return "";
        }
    }

    private static boolean b(String string2) {
        try {
            bsz<String> bsz2 = btk.aS;
            boolean bl2 = Pattern.matches(bqj.f().a(bsz2), string2);
            return bl2;
        }
        catch (RuntimeException runtimeException) {
            av.i().a(runtimeException, "InterstitialAdPool.isExcludedAdUnit");
            return false;
        }
    }

    private static bpu c(bpu bpu2) {
        bpu2 = bzu.d(bpu2);
        String[] arrstring = btk.aO;
        for (String string2 : bqj.f().a(arrstring).split(",")) {
            bzu.a(bpu2.m, string2);
            if (!string2.startsWith("com.google.ads.mediation.admob.AdMobAdapter/")) continue;
            string2 = string2.replaceFirst("com.google.ads.mediation.admob.AdMobAdapter/", "");
            bzu.a(bpu2.c, string2);
        }
        return bpu2;
    }

    private static String c(String string2) {
        try {
            Object object = Pattern.compile("([^/]+/[0-9]+).*").matcher(string2);
            if (object.matches()) {
                object = object.group(1);
                return object;
            }
            return string2;
        }
        catch (RuntimeException runtimeException) {
            return string2;
        }
    }

    private static bpu d(bpu bpu2) {
        Object object = Parcel.obtain();
        bpu2.writeToParcel((Parcel)object, 0);
        object.setDataPosition(0);
        bpu bpu3 = (bpu)bpu.CREATOR.createFromParcel(object);
        object.recycle();
        object = btk.aG;
        bpu2 = bpu3;
        if (((Boolean)bqj.f().a(object)).booleanValue()) {
            bpu2 = bpu3.a();
        }
        return bpu2;
    }

    final bzx a(bpu object, String object2) {
        if (bzu.b((String)object2)) {
            return null;
        }
        int n2 = new dh((Context)this.c.a()).a().n;
        Object object3 = bzu.c((bpu)object);
        bsz<Integer> bsz2 = bzu.c((String)object2);
        bzv bzv2 = new bzv((bpu)object3, (String)((Object)bsz2), n2);
        object = object2 = this.a.get(bzv2);
        if (object2 == null) {
            bzu.a("Interstitial pool created at %s.", bzv2);
            object = new bzw((bpu)object3, (String)((Object)bsz2), n2);
            this.a.put(bzv2, (bzw)object);
        }
        this.b.remove(bzv2);
        this.b.add(bzv2);
        object.g();
        do {
            n2 = this.b.size();
            object2 = btk.aP;
            if (n2 <= bqj.f().a(object2)) break;
            object2 = this.b.remove();
            bsz2 = this.a.get(object2);
            bzu.a("Evicting interstitial queue for %s.", (bzv)object2);
            while (bsz2.d() > 0) {
                bzx bzx2 = bsz2.a(null);
                if (bzx2.e) {
                    bzy.a().c();
                }
                bzx2.a.H();
            }
            this.a.remove(object2);
        } while (true);
        while (object.d() > 0) {
            object2 = object.a((bpu)object3);
            if (object2.e) {
                long l2 = av.l().a();
                long l3 = object2.d;
                bsz2 = btk.aR;
                if (l2 - l3 > (long)bqj.f().a(bsz2).intValue() * 1000L) {
                    bzu.a("Expired interstitial at %s.", bzv2);
                    bzy.a().b();
                    continue;
                }
            }
            object = object2.b != null ? " (inline) " : " ";
            object3 = new StringBuilder(String.valueOf(object).length() + 34);
            object3.append("Pooled interstitial");
            object3.append((String)object);
            object3.append("returned at %s.");
            bzu.a(object3.toString(), bzv2);
            return object2;
        }
        return null;
    }

    final void a() {
        if (this.c == null) {
            return;
        }
        for (Map.Entry<bzv, bzw> entry : this.a.entrySet()) {
            int n2;
            int n3;
            bzv bzv2 = entry.getKey();
            bzw object = entry.getValue();
            if (he.a(2)) {
                n2 = object.d();
                n3 = object.e();
                if (n3 < n2) {
                    he.a(String.format("Loading %s/%s pooled interstitials for %s.", n2 - n3, n2, bzv2));
                }
            }
            n2 = object.f() + 0;
            do {
                n3 = object.d();
                bsz<Integer> bsz2 = btk.aQ;
                if (n3 >= bqj.f().a(bsz2)) break;
                bzu.a("Pooling and loading one new interstitial for %s.", bzv2);
                if (!object.a(this.c)) continue;
                ++n2;
            } while (true);
            bzy.a().a(n2);
        }
        if (this.c != null) {
            SharedPreferences.Editor editor = this.c.a().getSharedPreferences("com.google.android.gms.ads.internal.interstitial.InterstitialAdPool", 0).edit();
            editor.clear();
            for (Map.Entry entry : this.a.entrySet()) {
                bzv bzv2 = (bzv)entry.getKey();
                bzw bzw2 = (bzw)entry.getValue();
                if (!bzw2.h()) continue;
                String string2 = new caa(bzw2).a();
                editor.putString(bzv2.toString(), string2);
                bzu.a("Saved interstitial queue for %s.", bzv2);
            }
            editor.putString("PoolKeys", this.b());
            editor.apply();
        }
    }

    final void a(byp arrstring) {
        if (this.c == null) {
            this.c = arrstring.b();
            if (this.c != null) {
                int n2;
                Object object2;
                Object object;
                arrstring = this.c.a();
                int n3 = 0;
                arrstring = arrstring.getSharedPreferences("com.google.android.gms.ads.internal.interstitial.InterstitialAdPool", 0);
                while (this.b.size() > 0) {
                    object = this.b.remove();
                    object2 = this.a.get(object);
                    bzu.a("Flushing interstitial queue for %s.", (bzv)object);
                    while (object2.d() > 0) {
                        object2.a(null).a.H();
                    }
                    this.a.remove(object);
                }
                try {
                    object = new HashMap();
                    for (Map.Entry entry : arrstring.getAll().entrySet()) {
                        if (((String)entry.getKey()).equals("PoolKeys")) continue;
                        Object object3 = caa.a((String)entry.getValue());
                        bzv bzv2 = new bzv(object3.a, object3.b, object3.c);
                        if (this.a.containsKey(bzv2)) continue;
                        object3 = new bzw(object3.a, object3.b, object3.c);
                        this.a.put(bzv2, (bzw)object3);
                        object.put(bzv2.toString(), bzv2);
                        bzu.a("Restored interstitial queue for %s.", bzv2);
                    }
                    arrstring = bzu.a(arrstring.getString("PoolKeys", ""));
                    n2 = arrstring.length;
                }
                catch (IOException | RuntimeException exception) {
                    av.i().a(exception, "InterstitialAdPool.restore");
                    he.c("Malformed preferences value for InterstitialAdPool.", exception);
                    this.a.clear();
                    this.b.clear();
                }
                while (n3 < n2) {
                    object2 = (bzv)object.get(arrstring[n3]);
                    if (this.a.containsKey(object2)) {
                        this.b.add((bzv)object2);
                    }
                    ++n3;
                }
                return;
            }
        }
    }

    final void b(bpu bpu2, String object) {
        if (this.c == null) {
            return;
        }
        int n2 = new dh((Context)this.c.a()).a().n;
        bpu bpu3 = bzu.c(bpu2);
        String string2 = bzu.c((String)object);
        bzv bzv2 = new bzv(bpu3, string2, n2);
        bzw bzw2 = this.a.get(bzv2);
        object = bzw2;
        if (bzw2 == null) {
            bzu.a("Interstitial pool created at %s.", bzv2);
            object = new bzw(bpu3, string2, n2);
            this.a.put(bzv2, (bzw)object);
        }
        object.a(this.c, bpu2);
        object.g();
        bzu.a("Inline entry added to the queue at %s.", bzv2);
    }
}

