/*
 * Decompiled with CFR 0_132.
 */
package c.a.a.d;

import c.a.a.b.c;
import c.a.a.d.a;
import c.a.a.d.d;
import c.a.a.e.f;
import c.a.a.e.g;
import c.a.a.e.k;
import c.a.a.e.l;
import c.a.a.g.e;
import java.io.File;
import java.io.IOException;
import java.io.OutputStream;
import java.util.ArrayList;
import java.util.List;
import java.util.TimeZone;
import java.util.zip.CRC32;

public class b
extends a {
    protected OutputStream a;
    protected f b;
    protected g c;
    protected l d;
    protected k e;
    protected CRC32 f;
    private File g;
    private c.a.a.b.b h;
    private long i;
    private long j;
    private byte[] k;
    private int l;
    private long m;

    public b(OutputStream outputStream, k k2) {
        this.a = outputStream;
        this.a(k2);
        this.f = new CRC32();
        this.i = 0L;
        this.j = 0L;
        this.k = new byte[16];
        this.l = 0;
        this.m = 0L;
    }

    private int a(File file) {
        if (file != null) {
            if (!file.exists()) {
                return 0;
            }
            if (file.isDirectory()) {
                if (file.isHidden()) {
                    return 18;
                }
                return 16;
            }
            if (!file.canWrite() && file.isHidden()) {
                return 3;
            }
            if (!file.canWrite()) {
                return 1;
            }
            if (file.isHidden()) {
                return 2;
            }
            return 0;
        }
        throw new c.a.a.c.a("input file is null, cannot get file attributes");
    }

    /*
     * Enabled aggressive block sorting
     */
    private c.a.a.e.a a(l l2) {
        if (l2 == null) {
            throw new c.a.a.c.a("zip parameters are null, cannot generate AES Extra Data record");
        }
        c.a.a.e.a a2 = new c.a.a.e.a();
        a2.a(39169L);
        a2.a(7);
        a2.a("AE");
        a2.b(2);
        int n2 = l2.g();
        int n3 = 1;
        if (n2 != 1) {
            n2 = l2.g();
            n3 = 3;
            if (n2 != 3) {
                throw new c.a.a.c.a("invalid AES key strength, cannot generate AES Extra data record");
            }
        }
        a2.c(n3);
        a2.d(l2.a());
        return a2;
    }

    private void a(k k2) {
        k k3 = k2;
        if (k2 == null) {
            k3 = new k();
        }
        this.e = k3;
        if (this.e.c() == null) {
            this.e.a(new c.a.a.e.d());
        }
        if (this.e.b() == null) {
            this.e.a(new c.a.a.e.b());
        }
        if (this.e.b().a() == null) {
            this.e.b().a(new ArrayList());
        }
        if (this.e.a() == null) {
            this.e.a(new ArrayList());
        }
        if (this.a instanceof d && ((d)this.a).b()) {
            this.e.a(true);
            this.e.a(((d)this.a).c());
        }
        this.e.c().a(101010256L);
    }

    private void a(byte[] arrby, int n2, int n3) {
        if (this.h != null) {
            try {
                this.h.a(arrby, n2, n3);
            }
            catch (c.a.a.c.a a2) {
                throw new IOException(a2.getMessage());
            }
        }
        this.a.write(arrby, n2, n3);
        long l2 = this.i;
        long l3 = n3;
        this.i = l2 + l3;
        this.j += l3;
    }

    private int[] a(boolean bl2, int n2) {
        int[] arrn = new int[8];
        arrn[0] = bl2 ? 1 : 0;
        if (n2 != 8) {
            arrn[1] = 0;
            arrn[2] = 0;
        }
        arrn[3] = 1;
        return arrn;
    }

    /*
     * Enabled force condition propagation
     * Lifted jumps to return sites
     */
    private void c() {
        void var2_4;
        if (!this.d.b()) {
            this.h = null;
            return;
        }
        int n2 = this.d.c();
        if (n2 != 0) {
            if (n2 != 99) throw new c.a.a.c.a("invalid encprytion method");
            c.a.a.b.a a2 = new c.a.a.b.a(this.d.f(), this.d.g());
        } else {
            c c2 = new c(this.d.f(), (this.c.e() & 65535) << 16);
        }
        this.h = var2_4;
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive block sorting
     * Lifted jumps to return sites
     */
    private void d() {
        block17 : {
            block18 : {
                block16 : {
                    this.b = new f();
                    this.b.a(33639248);
                    this.b.b(20);
                    this.b.c(20);
                    if (this.d.b() && this.d.c() == 99) {
                        this.b.d(99);
                        this.b.a(this.a(this.d));
                    } else {
                        this.b.d(this.d.a());
                    }
                    if (this.d.b()) {
                        this.b.b(true);
                        this.b.i(this.d.c());
                    }
                    if (this.d.n()) {
                        this.b.e((int)e.a(System.currentTimeMillis()));
                        if (e.a(this.d.m()) == false) throw new c.a.a.c.a("fileNameInZip is null or empty");
                        var7_1 = this.d.m();
                    } else {
                        this.b.e((int)e.a(e.a(this.g, this.d.j())));
                        this.b.c(this.g.length());
                        var7_1 = e.a(this.g.getAbsolutePath(), this.d.i(), this.d.l());
                    }
                    if (e.a((String)var7_1) == false) throw new c.a.a.c.a("fileName is null or empty. unable to create file header");
                    this.b.a((String)var7_1);
                    if (e.a(this.e.j())) {
                        var8_2 = this.b;
                        var1_3 = e.a((String)var7_1, this.e.j());
                    } else {
                        var8_2 = this.b;
                        var1_3 = e.g((String)var7_1);
                    }
                    var8_2.f(var1_3);
                    if (this.a instanceof d) {
                        this.b.h(((d)this.a).d());
                    } else {
                        this.b.h(0);
                    }
                    var1_3 = this.d.n() == false ? this.a(this.g) : 0;
                    var8_2 = new byte[4];
                    var8_2[0] = (byte)var1_3;
                    this.b.c((byte[])var8_2);
                    if (this.d.n()) {
                        var8_2 = this.b;
                        var2_4 = var7_1.endsWith("/") != false || var7_1.endsWith("\\") != false;
                        var8_2.a(var2_4);
                    } else {
                        this.b.a(this.g.isDirectory());
                    }
                    var2_4 = this.b.p();
                    var3_5 = 0L;
                    if (!var2_4) break block16;
                    this.b.b(0L);
                    this.b.c(0L);
                    break block17;
                }
                if (this.d.n()) break block17;
                var5_6 = e.c(this.g);
                if (this.d.a() != 0) ** GOTO lbl-1000
                if (this.d.c() != 0) break block18;
                var7_1 = this.b;
                var3_5 = 12L + var5_6;
                ** GOTO lbl69
            }
            if (this.d.c() == 99) {
                var1_3 = this.d.g();
                if (var1_3 != 1) {
                    if (var1_3 != 3) throw new c.a.a.c.a("invalid aes key strength, cannot determine key sizes");
                    var1_3 = 16;
                } else {
                    var1_3 = 8;
                }
                this.b.b((long)var1_3 + var5_6 + 10L + 2L);
            } else lbl-1000: // 2 sources:
            {
                var7_1 = this.b;
lbl69: // 2 sources:
                var7_1.b(var3_5);
            }
            this.b.c(var5_6);
        }
        if (this.d.b() && this.d.c() == 0) {
            this.b.a((long)this.d.k());
        }
        var7_1 = new byte[2];
        var7_1[0] = c.a.a.g.d.a(this.a(this.b.q(), this.d.a()));
        var2_4 = e.a(this.e.j());
        var7_1[1] = var2_4 != false && this.e.j().equalsIgnoreCase("UTF8") != false || var2_4 == false && e.f(this.b.o()).equals("UTF8") != false ? (Object)8 : (Object)false;
        this.b.a((byte[])var7_1);
    }

    private void e() {
        if (this.b != null) {
            this.c = new g();
            this.c.a(67324752);
            this.c.b(this.b.c());
            this.c.c(this.b.e());
            this.c.d(this.b.f());
            this.c.c(this.b.i());
            this.c.e(this.b.j());
            this.c.a(this.b.o());
            this.c.a(this.b.q());
            this.c.g(this.b.r());
            this.c.a(this.b.w());
            this.c.a(this.b.g());
            this.c.b(this.b.h());
            this.c.a((byte[])this.b.d().clone());
            return;
        }
        throw new c.a.a.c.a("file header is null, cannot create local file header");
    }

    public void a() {
        long l2;
        if (this.l != 0) {
            this.a(this.k, 0, this.l);
            this.l = 0;
        }
        if (this.d.b() && this.d.c() == 99) {
            if (this.h instanceof c.a.a.b.a) {
                this.a.write(((c.a.a.b.a)this.h).a());
                this.j += 10L;
                this.i += 10L;
            } else {
                throw new c.a.a.c.a("invalid encrypter for AES encrypted file");
            }
        }
        this.b.b(this.j);
        this.c.b(this.j);
        if (this.d.n()) {
            this.b.c(this.m);
            if (this.c.h() != this.m) {
                this.c.c(this.m);
            }
        }
        long l3 = l2 = this.f.getValue();
        if (this.b.q()) {
            l3 = l2;
            if (this.b.r() == 99) {
                l3 = 0L;
            }
        }
        if (this.d.b() && this.d.c() == 99) {
            this.b.a(0L);
            this.c.a(0L);
        } else {
            this.b.a(l3);
            this.c.a(l3);
        }
        this.e.a().add(this.c);
        this.e.b().a().add(this.b);
        c.a.a.a.b b2 = new c.a.a.a.b();
        this.i += (long)b2.a(this.c, this.a);
        this.f.reset();
        this.j = 0L;
        this.h = null;
        this.m = 0L;
    }

    public void a(int n2) {
        if (n2 <= 0) {
            return;
        }
        long l2 = n2;
        if (l2 <= this.j) {
            this.j -= l2;
        }
    }

    /*
     * Unable to fully structure code
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     * Lifted jumps to return sites
     */
    public void a(File var1_1, l var2_5) {
        if (!var2_5.n()) {
            if (var1_1 == null) throw new c.a.a.c.a("input file is null");
        }
        if (!var2_5.n()) {
            if (e.a((File)var1_1) == false) throw new c.a.a.c.a("input file does not exist");
        }
        try {
            block20 : {
                block21 : {
                    block18 : {
                        block19 : {
                            block17 : {
                                this.g = var1_1;
                                this.d = (l)var2_5.clone();
                                if (var2_5.n()) break block17;
                                if (!this.g.isDirectory()) break block18;
                                this.d.a(false);
                                this.d.b(-1);
                                var1_1 = this.d;
                                break block19;
                            }
                            if (e.a(this.d.m()) == false) throw new c.a.a.c.a("file name is empty for external stream");
                            if (!this.d.m().endsWith("/") && !this.d.m().endsWith("\\")) break block18;
                            this.d.a(false);
                            this.d.b(-1);
                            var1_1 = this.d;
                        }
                        var1_1.a(0);
                    }
                    this.d();
                    this.e();
                    if (this.e.d() && (this.e.b() == null || this.e.b().a() == null || this.e.b().a().size() == 0)) {
                        var1_1 = new byte[4];
                        c.a.a.g.d.a((byte[])var1_1, 0, 134695760);
                        this.a.write((byte[])var1_1);
                        this.i += 4L;
                    }
                    if (!(this.a instanceof d)) break block20;
                    if (this.i != 4L) break block21;
                    var1_1 = this.b;
                    ** GOTO lbl41
                }
                var1_1 = this.b;
                var3_6 = ((d)this.a).a();
                ** GOTO lbl45
            }
            if (this.i == 4L) {
                var1_1 = this.b;
lbl41: // 2 sources:
                var1_1.d(4L);
            } else {
                var1_1 = this.b;
                var3_6 = this.i;
lbl45: // 2 sources:
                var1_1.d(var3_6);
            }
            var1_1 = new c.a.a.a.b();
            this.i += (long)var1_1.a(this.e, this.c, this.a);
            if (this.d.b()) {
                this.c();
                if (this.h != null) {
                    if (var2_5.c() == 0) {
                        var1_1 = ((c)this.h).a();
                        this.a.write((byte[])var1_1);
                        this.i += (long)((Object)var1_1).length;
                        this.j += (long)((Object)var1_1).length;
                    } else if (var2_5.c() == 99) {
                        var1_1 = ((c.a.a.b.a)this.h).c();
                        var2_5 = ((c.a.a.b.a)this.h).b();
                        this.a.write((byte[])var1_1);
                        this.a.write(var2_5);
                        this.i += (long)(((Object)var1_1).length + var2_5.length);
                        this.j += (long)(((Object)var1_1).length + var2_5.length);
                    }
                }
            }
            this.f.reset();
            return;
        }
        catch (Exception var1_2) {
            throw new c.a.a.c.a(var1_2);
        }
        catch (c.a.a.c.a var1_3) {
            throw var1_3;
        }
        catch (CloneNotSupportedException var1_4) {
            throw new c.a.a.c.a(var1_4);
        }
    }

    public void b() {
        this.e.c().b(this.i);
        new c.a.a.a.b().a(this.e, this.a);
    }

    protected void b(int n2) {
        if (n2 > 0) {
            this.m += (long)n2;
        }
    }

    @Override
    public void close() {
        if (this.a != null) {
            this.a.close();
        }
    }

    @Override
    public void write(int n2) {
        this.write(new byte[]{(byte)n2}, 0, 1);
    }

    @Override
    public void write(byte[] arrby) {
        if (arrby != null) {
            if (arrby.length == 0) {
                return;
            }
            this.write(arrby, 0, arrby.length);
            return;
        }
        throw new NullPointerException();
    }

    @Override
    public void write(byte[] arrby, int n2, int n3) {
        if (n3 == 0) {
            return;
        }
        int n4 = n2;
        int n5 = n3;
        if (this.d.b()) {
            n4 = n2;
            n5 = n3;
            if (this.d.c() == 99) {
                int n6 = n2;
                int n7 = n3;
                if (this.l != 0) {
                    if (n3 >= 16 - this.l) {
                        System.arraycopy(arrby, n2, this.k, this.l, 16 - this.l);
                        this.a(this.k, 0, this.k.length);
                        n6 = 16 - this.l;
                        n7 = n3 - n6;
                        this.l = 0;
                    } else {
                        System.arraycopy(arrby, n2, this.k, this.l, n3);
                        this.l += n3;
                        return;
                    }
                }
                n4 = n6;
                n5 = n7;
                if (n7 != 0) {
                    n2 = n7 % 16;
                    n4 = n6;
                    n5 = n7;
                    if (n2 != 0) {
                        System.arraycopy(arrby, n7 + n6 - n2, this.k, 0, n2);
                        this.l = n2;
                        n5 = n7 - this.l;
                        n4 = n6;
                    }
                }
            }
        }
        if (n5 != 0) {
            this.a(arrby, n4, n5);
        }
    }
}

