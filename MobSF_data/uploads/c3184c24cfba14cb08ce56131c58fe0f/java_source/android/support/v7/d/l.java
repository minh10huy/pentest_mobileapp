/*
 * Decompiled with CFR 0_132.
 * 
 * Could not load the following classes:
 *  android.content.ComponentName
 *  android.content.Context
 *  android.content.Intent
 *  android.content.ServiceConnection
 *  android.os.Bundle
 *  android.os.DeadObjectException
 *  android.os.Handler
 *  android.os.IBinder
 *  android.os.IBinder$DeathRecipient
 *  android.os.Message
 *  android.os.Messenger
 *  android.os.RemoteException
 *  android.util.Log
 *  android.util.SparseArray
 */
package android.support.v7.d;

import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.ServiceConnection;
import android.os.Bundle;
import android.os.DeadObjectException;
import android.os.Handler;
import android.os.IBinder;
import android.os.Message;
import android.os.Messenger;
import android.os.RemoteException;
import android.support.v7.d.c;
import android.support.v7.d.e;
import android.support.v7.d.g;
import android.util.Log;
import android.util.SparseArray;
import java.lang.ref.WeakReference;
import java.util.ArrayList;
import java.util.List;

final class l
extends android.support.v7.d.c
implements ServiceConnection {
    static final boolean a = Log.isLoggable((String)"MediaRouteProviderProxy", (int)3);
    final c b;
    private final ComponentName c;
    private final ArrayList<b> d = new ArrayList();
    private boolean e;
    private boolean f;
    private a g;
    private boolean h;

    public l(Context context, ComponentName componentName) {
        super(context, new c.c(componentName));
        this.c = componentName;
        this.b = new c();
    }

    private c.d c(String object, String string2) {
        Object object2 = this.f();
        if (object2 != null) {
            object2 = object2.a();
            int n2 = object2.size();
            for (int i2 = 0; i2 < n2; ++i2) {
                if (!((android.support.v7.d.a)object2.get(i2)).a().equals(object)) continue;
                object = new b((String)object, string2);
                this.d.add((b)object);
                if (this.h) {
                    object.a(this.g);
                }
                this.k();
                return object;
            }
        }
        return null;
    }

    private void k() {
        if (this.l()) {
            this.m();
            return;
        }
        this.n();
    }

    private boolean l() {
        if (this.e) {
            if (this.d() != null) {
                return true;
            }
            if (!this.d.isEmpty()) {
                return true;
            }
        }
        return false;
    }

    private void m() {
        block5 : {
            if (!this.f) {
                StringBuilder stringBuilder;
                if (a) {
                    stringBuilder = new StringBuilder();
                    stringBuilder.append(this);
                    stringBuilder.append(": Binding");
                    Log.d((String)"MediaRouteProviderProxy", (String)stringBuilder.toString());
                }
                stringBuilder = new Intent("android.media.MediaRouteProviderService");
                stringBuilder.setComponent(this.c);
                try {
                    this.f = this.a().bindService((Intent)stringBuilder, (ServiceConnection)this, 1);
                    if (!this.f && a) {
                        stringBuilder = new StringBuilder();
                        stringBuilder.append(this);
                        stringBuilder.append(": Bind failed");
                        Log.d((String)"MediaRouteProviderProxy", (String)stringBuilder.toString());
                        return;
                    }
                }
                catch (SecurityException securityException) {
                    if (!a) break block5;
                    StringBuilder stringBuilder2 = new StringBuilder();
                    stringBuilder2.append(this);
                    stringBuilder2.append(": Bind failed");
                    Log.d((String)"MediaRouteProviderProxy", (String)stringBuilder2.toString(), (Throwable)securityException);
                }
            }
        }
    }

    private void n() {
        if (this.f) {
            if (a) {
                StringBuilder stringBuilder = new StringBuilder();
                stringBuilder.append(this);
                stringBuilder.append(": Unbinding");
                Log.d((String)"MediaRouteProviderProxy", (String)stringBuilder.toString());
            }
            this.f = false;
            this.o();
            this.a().unbindService((ServiceConnection)this);
        }
    }

    private void o() {
        if (this.g != null) {
            this.a((android.support.v7.d.d)null);
            this.h = false;
            this.q();
            this.g.b();
            this.g = null;
        }
    }

    private void p() {
        int n2 = this.d.size();
        for (int i2 = 0; i2 < n2; ++i2) {
            this.d.get(i2).a(this.g);
        }
    }

    private void q() {
        int n2 = this.d.size();
        for (int i2 = 0; i2 < n2; ++i2) {
            this.d.get(i2).d();
        }
    }

    @Override
    public c.d a(String string2) {
        if (string2 != null) {
            return this.c(string2, null);
        }
        throw new IllegalArgumentException("routeId cannot be null");
    }

    @Override
    public c.d a(String string2, String string3) {
        if (string2 != null) {
            if (string3 != null) {
                return this.c(string2, string3);
            }
            throw new IllegalArgumentException("routeGroupId cannot be null");
        }
        throw new IllegalArgumentException("routeId cannot be null");
    }

    void a(a object) {
        if (this.g == object) {
            this.h = true;
            this.p();
            object = this.d();
            if (object != null) {
                this.g.a((android.support.v7.d.b)object);
            }
        }
    }

    void a(a object, android.support.v7.d.d d2) {
        if (this.g == object) {
            if (a) {
                object = new StringBuilder();
                object.append(this);
                object.append(": Descriptor changed, descriptor=");
                object.append(d2);
                Log.d((String)"MediaRouteProviderProxy", (String)object.toString());
            }
            this.a(d2);
        }
    }

    void a(a object, String string2) {
        if (this.g == object) {
            if (a) {
                object = new StringBuilder();
                object.append(this);
                object.append(": Service connection error - ");
                object.append(string2);
                Log.d((String)"MediaRouteProviderProxy", (String)object.toString());
            }
            this.n();
        }
    }

    void a(b b2) {
        this.d.remove(b2);
        b2.d();
        this.k();
    }

    @Override
    public void b(android.support.v7.d.b b2) {
        if (this.h) {
            this.g.a(b2);
        }
        this.k();
    }

    void b(a object) {
        if (this.g == object) {
            if (a) {
                object = new StringBuilder();
                object.append(this);
                object.append(": Service connection died");
                Log.d((String)"MediaRouteProviderProxy", (String)object.toString());
            }
            this.o();
        }
    }

    public boolean b(String string2, String string3) {
        if (this.c.getPackageName().equals(string2) && this.c.getClassName().equals(string3)) {
            return true;
        }
        return false;
    }

    public void h() {
        if (!this.e) {
            if (a) {
                StringBuilder stringBuilder = new StringBuilder();
                stringBuilder.append(this);
                stringBuilder.append(": Starting");
                Log.d((String)"MediaRouteProviderProxy", (String)stringBuilder.toString());
            }
            this.e = true;
            this.k();
        }
    }

    public void i() {
        if (this.e) {
            if (a) {
                StringBuilder stringBuilder = new StringBuilder();
                stringBuilder.append(this);
                stringBuilder.append(": Stopping");
                Log.d((String)"MediaRouteProviderProxy", (String)stringBuilder.toString());
            }
            this.e = false;
            this.k();
        }
    }

    public void j() {
        if (this.g == null && this.l()) {
            this.n();
            this.m();
        }
    }

    public void onServiceConnected(ComponentName object, IBinder iBinder) {
        if (a) {
            object = new StringBuilder();
            object.append(this);
            object.append(": Connected");
            Log.d((String)"MediaRouteProviderProxy", (String)object.toString());
        }
        if (this.f) {
            this.o();
            object = iBinder != null ? new Messenger(iBinder) : null;
            if (e.a((Messenger)object)) {
                if ((object = new a((Messenger)object)).a()) {
                    this.g = object;
                    return;
                }
                if (a) {
                    object = new StringBuilder();
                    object.append(this);
                    object.append(": Registration failed");
                    Log.d((String)"MediaRouteProviderProxy", (String)object.toString());
                    return;
                }
            } else {
                object = new StringBuilder();
                object.append(this);
                object.append(": Service returned invalid messenger binder");
                Log.e((String)"MediaRouteProviderProxy", (String)object.toString());
            }
        }
    }

    public void onServiceDisconnected(ComponentName object) {
        if (a) {
            object = new StringBuilder();
            object.append(this);
            object.append(": Service disconnected");
            Log.d((String)"MediaRouteProviderProxy", (String)object.toString());
        }
        this.o();
    }

    public String toString() {
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.append("Service connection ");
        stringBuilder.append(this.c.flattenToShortString());
        return stringBuilder.toString();
    }

    private final class a
    implements IBinder.DeathRecipient {
        private final Messenger b;
        private final d c;
        private final Messenger d;
        private int e = 1;
        private int f = 1;
        private int g;
        private int h;
        private final SparseArray<g.c> i = new SparseArray();

        public a(Messenger messenger) {
            this.b = messenger;
            this.c = new d(this);
            this.d = new Messenger((Handler)this.c);
        }

        /*
         * Enabled force condition propagation
         * Lifted jumps to return sites
         */
        private boolean a(int n2, int n3, int n4, Object object, Bundle bundle) {
            Message message = Message.obtain();
            message.what = n2;
            message.arg1 = n3;
            message.arg2 = n4;
            message.obj = object;
            message.setData(bundle);
            message.replyTo = this.d;
            try {
                this.b.send(message);
                return true;
            }
            catch (RemoteException remoteException) {
                if (n2 != 2) {
                    Log.e((String)"MediaRouteProviderProxy", (String)"Could not send message to service.", (Throwable)remoteException);
                }
                do {
                    return false;
                    break;
                } while (true);
            }
            catch (DeadObjectException deadObjectException) {
                return false;
            }
        }

        public int a(String string2, String string3) {
            int n2 = this.f;
            this.f = n2 + 1;
            Bundle bundle = new Bundle();
            bundle.putString("routeId", string2);
            bundle.putString("routeGroupId", string3);
            int n3 = this.e;
            this.e = n3 + 1;
            this.a(3, n3, n2, null, bundle);
            return n2;
        }

        public void a(int n2, int n3) {
            Bundle bundle = new Bundle();
            bundle.putInt("unselectReason", n3);
            n3 = this.e;
            this.e = n3 + 1;
            this.a(6, n3, n2, null, bundle);
        }

        public void a(android.support.v7.d.b b2) {
            int n2 = this.e;
            this.e = n2 + 1;
            b2 = b2 != null ? b2.d() : null;
            this.a(10, n2, 0, b2, null);
        }

        /*
         * Enabled aggressive block sorting
         * Enabled unnecessary exception pruning
         * Enabled aggressive exception aggregation
         */
        public boolean a() {
            int n2 = this.e;
            this.e = n2 + 1;
            this.h = n2;
            if (!this.a(1, this.h, 2, null, null)) {
                return false;
            }
            try {
                this.b.getBinder().linkToDeath((IBinder.DeathRecipient)this, 0);
                return true;
            }
            catch (RemoteException remoteException) {}
            this.binderDied();
            return false;
        }

        public boolean a(int n2) {
            g.c c2;
            if (n2 == this.h) {
                this.h = 0;
                l.this.a(this, "Registration failed");
            }
            if ((c2 = (g.c)this.i.get(n2)) != null) {
                this.i.remove(n2);
                c2.a(null, null);
            }
            return true;
        }

        public boolean a(int n2, int n3, Bundle bundle) {
            if (this.g == 0 && n2 == this.h && n3 >= 1) {
                this.h = 0;
                this.g = n3;
                l.this.a(this, android.support.v7.d.d.a(bundle));
                l.this.a(this);
                return true;
            }
            return false;
        }

        public boolean a(int n2, Bundle bundle) {
            g.c c2 = (g.c)this.i.get(n2);
            if (c2 != null) {
                this.i.remove(n2);
                c2.a(bundle);
                return true;
            }
            return false;
        }

        public boolean a(int n2, String string2, Bundle bundle) {
            g.c c2 = (g.c)this.i.get(n2);
            if (c2 != null) {
                this.i.remove(n2);
                c2.a(string2, bundle);
                return true;
            }
            return false;
        }

        public boolean a(Bundle bundle) {
            if (this.g != 0) {
                l.this.a(this, android.support.v7.d.d.a(bundle));
                return true;
            }
            return false;
        }

        public void b() {
            this.a(2, 0, 0, null, null);
            this.c.a();
            this.b.getBinder().unlinkToDeath((IBinder.DeathRecipient)this, 0);
            l.this.b.post(new Runnable(){

                @Override
                public void run() {
                    a.this.c();
                }
            });
        }

        public void b(int n2, int n3) {
            Bundle bundle = new Bundle();
            bundle.putInt("volume", n3);
            n3 = this.e;
            this.e = n3 + 1;
            this.a(7, n3, n2, null, bundle);
        }

        public boolean b(int n2) {
            return true;
        }

        public void binderDied() {
            l.this.b.post(new Runnable(){

                @Override
                public void run() {
                    l.this.b(a.this);
                }
            });
        }

        void c() {
            for (int i2 = 0; i2 < this.i.size(); ++i2) {
                ((g.c)this.i.valueAt(i2)).a(null, null);
            }
            this.i.clear();
        }

        public void c(int n2) {
            int n3 = this.e;
            this.e = n3 + 1;
            this.a(4, n3, n2, null, null);
        }

        public void c(int n2, int n3) {
            Bundle bundle = new Bundle();
            bundle.putInt("volume", n3);
            n3 = this.e;
            this.e = n3 + 1;
            this.a(8, n3, n2, null, bundle);
        }

        public void d(int n2) {
            int n3 = this.e;
            this.e = n3 + 1;
            this.a(5, n3, n2, null, null);
        }

    }

    private final class b
    extends c.d {
        private final String b;
        private final String c;
        private boolean d;
        private int e = -1;
        private int f;
        private a g;
        private int h;

        public b(String string2, String string3) {
            this.b = string2;
            this.c = string3;
        }

        @Override
        public void a() {
            l.this.a(this);
        }

        @Override
        public void a(int n2) {
            this.d = false;
            if (this.g != null) {
                this.g.a(this.h, n2);
            }
        }

        public void a(a a2) {
            this.g = a2;
            this.h = a2.a(this.b, this.c);
            if (this.d) {
                a2.d(this.h);
                if (this.e >= 0) {
                    a2.b(this.h, this.e);
                    this.e = -1;
                }
                if (this.f != 0) {
                    a2.c(this.h, this.f);
                    this.f = 0;
                }
            }
        }

        @Override
        public void b() {
            this.d = true;
            if (this.g != null) {
                this.g.d(this.h);
            }
        }

        @Override
        public void b(int n2) {
            if (this.g != null) {
                this.g.b(this.h, n2);
                return;
            }
            this.e = n2;
            this.f = 0;
        }

        @Override
        public void c() {
            this.a(0);
        }

        @Override
        public void c(int n2) {
            if (this.g != null) {
                this.g.c(this.h, n2);
                return;
            }
            this.f += n2;
        }

        public void d() {
            if (this.g != null) {
                this.g.c(this.h);
                this.g = null;
                this.h = 0;
            }
        }
    }

    private static final class c
    extends Handler {
        c() {
        }
    }

    private static final class d
    extends Handler {
        private final WeakReference<a> a;

        public d(a a2) {
            this.a = new WeakReference<a>(a2);
        }

        private boolean a(a a2, int n2, int n3, int n4, Object object, Bundle object2) {
            switch (n2) {
                default: {
                    break;
                }
                case 5: {
                    if (object != null && !(object instanceof Bundle)) break;
                    return a2.a((Bundle)object);
                }
                case 4: {
                    if (object != null && !(object instanceof Bundle)) break;
                    object2 = object2 == null ? null : object2.getString("error");
                    return a2.a(n3, (String)object2, (Bundle)object);
                }
                case 3: {
                    if (object != null && !(object instanceof Bundle)) break;
                    return a2.a(n3, (Bundle)object);
                }
                case 2: {
                    if (object != null && !(object instanceof Bundle)) break;
                    return a2.a(n3, n4, (Bundle)object);
                }
                case 1: {
                    a2.b(n3);
                    return true;
                }
                case 0: {
                    a2.a(n3);
                    return true;
                }
            }
            return false;
        }

        public void a() {
            this.a.clear();
        }

        public void handleMessage(Message message) {
            Object object = this.a.get();
            if (object != null && !this.a((a)object, message.what, message.arg1, message.arg2, message.obj, message.peekData()) && l.a) {
                object = new StringBuilder();
                object.append("Unhandled message from server: ");
                object.append((Object)message);
                Log.d((String)"MediaRouteProviderProxy", (String)object.toString());
            }
        }
    }

}

