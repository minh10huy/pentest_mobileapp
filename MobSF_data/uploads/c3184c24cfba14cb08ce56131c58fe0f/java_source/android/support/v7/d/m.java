/*
 * Decompiled with CFR 0_132.
 * 
 * Could not load the following classes:
 *  android.content.BroadcastReceiver
 *  android.content.ComponentName
 *  android.content.Context
 *  android.content.Intent
 *  android.content.IntentFilter
 *  android.content.pm.PackageManager
 *  android.content.pm.ResolveInfo
 *  android.content.pm.ServiceInfo
 *  android.os.Handler
 */
package android.support.v7.d;

import android.content.BroadcastReceiver;
import android.content.ComponentName;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.content.pm.PackageManager;
import android.content.pm.ResolveInfo;
import android.content.pm.ServiceInfo;
import android.os.Handler;
import android.support.v7.d.c;
import android.support.v7.d.l;
import java.util.ArrayList;
import java.util.Collections;
import java.util.Iterator;
import java.util.List;

final class m {
    private final Context a;
    private final a b;
    private final Handler c;
    private final PackageManager d;
    private final ArrayList<l> e = new ArrayList();
    private boolean f;
    private final BroadcastReceiver g = new BroadcastReceiver(){

        public void onReceive(Context context, Intent intent) {
            m.this.b();
        }
    };
    private final Runnable h = new Runnable(){

        @Override
        public void run() {
            m.this.b();
        }
    };

    public m(Context context, a a2) {
        this.a = context;
        this.b = a2;
        this.c = new Handler();
        this.d = context.getPackageManager();
    }

    private int a(String string2, String string3) {
        int n2 = this.e.size();
        for (int i2 = 0; i2 < n2; ++i2) {
            if (!this.e.get(i2).b(string2, string3)) continue;
            return i2;
        }
        return -1;
    }

    public void a() {
        if (!this.f) {
            this.f = true;
            IntentFilter intentFilter = new IntentFilter();
            intentFilter.addAction("android.intent.action.PACKAGE_ADDED");
            intentFilter.addAction("android.intent.action.PACKAGE_REMOVED");
            intentFilter.addAction("android.intent.action.PACKAGE_CHANGED");
            intentFilter.addAction("android.intent.action.PACKAGE_REPLACED");
            intentFilter.addAction("android.intent.action.PACKAGE_RESTARTED");
            intentFilter.addDataScheme("package");
            this.a.registerReceiver(this.g, intentFilter, null, this.c);
            this.c.post(this.h);
        }
    }

    void b() {
        int n2;
        if (!this.f) {
            return;
        }
        Object object = new Intent("android.media.MediaRouteProviderService");
        Object object2 = this.d;
        int n3 = 0;
        object = object2.queryIntentServices((Intent)object, 0).iterator();
        while (object.hasNext()) {
            object2 = ((ResolveInfo)object.next()).serviceInfo;
            if (object2 == null) continue;
            int n4 = this.a(object2.packageName, object2.name);
            if (n4 < 0) {
                object2 = new l(this.a, new ComponentName(object2.packageName, object2.name));
                object2.h();
                ArrayList<l> arrayList = this.e;
                n2 = n3 + 1;
                arrayList.add(n3, (l)object2);
                this.b.a((c)object2);
                n3 = n2;
                continue;
            }
            if (n4 < n3) continue;
            object2 = this.e.get(n4);
            object2.h();
            object2.j();
            object2 = this.e;
            n2 = n3 + 1;
            Collections.swap(object2, n4, n3);
            n3 = n2;
        }
        if (n3 < this.e.size()) {
            for (n2 = this.e.size() - 1; n2 >= n3; --n2) {
                object = this.e.get(n2);
                this.b.b((c)object);
                this.e.remove(object);
                object.i();
            }
        }
    }

    public static interface a {
        public void a(c var1);

        public void b(c var1);
    }

}

