/*
 * Decompiled with CFR 0_132.
 * 
 * Could not load the following classes:
 *  android.content.Context
 *  android.content.SharedPreferences
 *  android.content.SharedPreferences$Editor
 *  android.text.TextUtils
 *  android.util.Base64
 *  android.util.Log
 */
package com.google.firebase.iid;

import android.content.Context;
import android.content.SharedPreferences;
import android.support.annotation.Nullable;
import android.support.annotation.WorkerThread;
import android.support.v4.content.ContextCompat;
import android.text.TextUtils;
import android.util.Base64;
import android.util.Log;
import com.google.firebase.iid.zza;
import com.google.firebase.iid.zzau;
import com.google.firebase.iid.zzx;
import com.google.firebase.iid.zzy;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.io.UnsupportedEncodingException;
import java.security.GeneralSecurityException;
import java.security.KeyFactory;
import java.security.KeyPair;
import java.security.NoSuchAlgorithmException;
import java.security.PrivateKey;
import java.security.PublicKey;
import java.security.spec.InvalidKeySpecException;
import java.security.spec.KeySpec;
import java.security.spec.PKCS8EncodedKeySpec;
import java.security.spec.X509EncodedKeySpec;
import java.util.Properties;

final class zzw {
    zzw() {
    }

    @Nullable
    private static zzx zza(SharedPreferences sharedPreferences, String string2) throws zzy {
        String string3 = zzau.zzc(string2, "|P|");
        zzx zzx2 = null;
        string3 = sharedPreferences.getString(string3, null);
        String string4 = sharedPreferences.getString(zzau.zzc(string2, "|K|"), null);
        if (string3 != null) {
            if (string4 == null) {
                return null;
            }
            zzx2 = new zzx(zzw.zzb(string3, string4), zzw.zzb(sharedPreferences, string2));
        }
        return zzx2;
    }

    /*
     * Exception decompiling
     */
    @Nullable
    private static zzx zza(File var0) throws zzy, IOException {
        // This method has failed to decompile.  When submitting a bug report, please provide this stack trace, and (if you hold appropriate legal rights) the relevant class file.
        // org.benf.cfr.reader.util.ConfusedCFRException: Tried to end blocks [0[TRYBLOCK]], but top level block is 4[CATCHBLOCK]
        // org.benf.cfr.reader.bytecode.analysis.opgraph.Op04StructuredStatement.processEndingBlocks(Op04StructuredStatement.java:416)
        // org.benf.cfr.reader.bytecode.analysis.opgraph.Op04StructuredStatement.buildNestedBlocks(Op04StructuredStatement.java:468)
        // org.benf.cfr.reader.bytecode.analysis.opgraph.Op03SimpleStatement.createInitialStructuredBlock(Op03SimpleStatement.java:2960)
        // org.benf.cfr.reader.bytecode.CodeAnalyser.getAnalysisInner(CodeAnalyser.java:818)
        // org.benf.cfr.reader.bytecode.CodeAnalyser.getAnalysisOrWrapFail(CodeAnalyser.java:196)
        // org.benf.cfr.reader.bytecode.CodeAnalyser.getAnalysis(CodeAnalyser.java:141)
        // org.benf.cfr.reader.entities.attributes.AttributeCode.analyse(AttributeCode.java:95)
        // org.benf.cfr.reader.entities.Method.analyse(Method.java:372)
        // org.benf.cfr.reader.entities.ClassFile.analyseMid(ClassFile.java:867)
        // org.benf.cfr.reader.entities.ClassFile.analyseTop(ClassFile.java:768)
        // org.benf.cfr.reader.Main.doJar(Main.java:141)
        // org.benf.cfr.reader.Main.main(Main.java:242)
        throw new IllegalStateException("Decompilation failed");
    }

    static void zza(Context arrfile) {
        for (File file : zzw.zzb((Context)arrfile).listFiles()) {
            if (!file.getName().startsWith("com.google.InstanceId")) continue;
            file.delete();
        }
    }

    /*
     * WARNING - Removed back jump from a try to a catch block - possible behaviour change.
     * Loose catch block
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     * Lifted jumps to return sites
     */
    private static void zza(Context object, String object2, zzx object3) {
        Throwable throwable2222;
        try {
            if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
                Log.d((String)"FirebaseInstanceId", (String)"Writing key to properties file");
            }
            object = zzw.zzf((Context)object, (String)object2);
            object.createNewFile();
            object2 = new Properties();
            object2.setProperty("pub", zzx.zza((zzx)object3));
            object2.setProperty("pri", zzx.zzb((zzx)object3));
            object2.setProperty("cre", String.valueOf(zzx.zzc((zzx)object3)));
            object3 = new FileOutputStream((File)object);
            object = null;
        }
        catch (IOException iOException) {
            String string2 = String.valueOf(iOException);
            object2 = new StringBuilder(String.valueOf(string2).length() + 21);
            object2.append("Failed to write key: ");
            object2.append(string2);
            Log.w((String)"FirebaseInstanceId", (String)object2.toString());
            return;
        }
        object2.store((OutputStream)object3, null);
        zzw.zza(null, (FileOutputStream)object3);
        return;
        {
            catch (Throwable throwable2222) {
            }
            catch (Throwable throwable3) {}
            object = throwable3;
            {
                throw throwable3;
            }
        }
        zzw.zza((Throwable)object, (FileOutputStream)object3);
        throw throwable2222;
    }

    private static /* synthetic */ void zza(Throwable throwable, FileInputStream fileInputStream) {
        if (throwable != null) {
            try {
                fileInputStream.close();
                return;
            }
            catch (Throwable throwable2) {
                com.google.android.gms.internal.firebase_messaging.zza.zza(throwable, throwable2);
                return;
            }
        }
        fileInputStream.close();
    }

    private static /* synthetic */ void zza(Throwable throwable, FileOutputStream fileOutputStream) {
        if (throwable != null) {
            try {
                fileOutputStream.close();
                return;
            }
            catch (Throwable throwable2) {
                com.google.android.gms.internal.firebase_messaging.zza.zza(throwable, throwable2);
                return;
            }
        }
        fileOutputStream.close();
    }

    /*
     * Enabled force condition propagation
     * Lifted jumps to return sites
     */
    private static long zzb(SharedPreferences object, String string2) {
        void var1_3;
        String string3 = object.getString(zzau.zzc((String)var1_3, "cre"), null);
        if (string3 == null) return 0L;
        try {
            return Long.parseLong(string3);
        }
        catch (NumberFormatException numberFormatException) {
            return 0L;
        }
    }

    private static File zzb(Context context) {
        File file = ContextCompat.getNoBackupFilesDir(context);
        if (file != null && file.isDirectory()) {
            return file;
        }
        Log.w((String)"FirebaseInstanceId", (String)"noBackupFilesDir doesn't exist, using regular files directory instead");
        return context.getFilesDir();
    }

    private static KeyPair zzb(String object, String object2) throws zzy {
        try {
            object = Base64.decode((String)object, (int)8);
            object2 = Base64.decode((String)object2, (int)8);
        }
        catch (IllegalArgumentException illegalArgumentException) {
            throw new zzy(illegalArgumentException);
        }
        try {
            KeyFactory keyFactory = KeyFactory.getInstance("RSA");
            object = new KeyPair(keyFactory.generatePublic(new X509EncodedKeySpec((byte[])object)), keyFactory.generatePrivate(new PKCS8EncodedKeySpec((byte[])object2)));
            return object;
        }
        catch (NoSuchAlgorithmException | InvalidKeySpecException generalSecurityException) {
            object2 = String.valueOf(generalSecurityException);
            StringBuilder stringBuilder = new StringBuilder(String.valueOf(object2).length() + 19);
            stringBuilder.append("Invalid key stored ");
            stringBuilder.append((String)object2);
            Log.w((String)"FirebaseInstanceId", (String)stringBuilder.toString());
            throw new zzy(generalSecurityException);
        }
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    private final void zzb(Context context, String string2, zzx zzx2) {
        context = context.getSharedPreferences("com.google.android.gms.appid", 0);
        try {
            boolean bl = zzx2.equals(zzw.zza((SharedPreferences)context, string2));
            if (bl) {
                return;
            }
        }
        catch (zzy zzy2) {}
        if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
            Log.d((String)"FirebaseInstanceId", (String)"Writing key to shared preferences");
        }
        context = context.edit();
        context.putString(zzau.zzc(string2, "|P|"), zzx.zza(zzx2));
        context.putString(zzau.zzc(string2, "|K|"), zzx.zzb(zzx2));
        context.putString(zzau.zzc(string2, "cre"), String.valueOf(zzx.zzc(zzx2)));
        context.commit();
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    @Nullable
    private final zzx zzd(Context context, String string2) throws zzy {
        zzx zzx2;
        try {
            zzx2 = this.zze(context, string2);
            if (zzx2 != null) {
                this.zzb(context, string2, zzx2);
                return zzx2;
            }
            zzx2 = null;
        }
        catch (zzy zzy2) {
            // empty catch block
        }
        try {
            zzx zzx3 = zzw.zza(context.getSharedPreferences("com.google.android.gms.appid", 0), string2);
            if (zzx3 != null) {
                zzw.zza(context, string2, zzx3);
                return zzx3;
            }
        }
        catch (zzy zzy3) {
            // empty catch block
        }
        if (zzx2 != null) {
            throw zzx2;
        }
        return null;
    }

    @Nullable
    private final zzx zze(Context object, String object2) throws zzy {
        if (!(object = zzw.zzf((Context)object, (String)object2)).exists()) {
            return null;
        }
        try {
            object2 = zzw.zza((File)object);
            return object2;
        }
        catch (IOException iOException) {
            StringBuilder stringBuilder;
            String string2;
            if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
                string2 = String.valueOf(iOException);
                stringBuilder = new StringBuilder(String.valueOf(string2).length() + 40);
                stringBuilder.append("Failed to read key from file, retrying: ");
                stringBuilder.append(string2);
                Log.d((String)"FirebaseInstanceId", (String)stringBuilder.toString());
            }
            try {
                object = zzw.zza((File)object);
                return object;
            }
            catch (IOException iOException2) {
                string2 = String.valueOf(iOException2);
                stringBuilder = new StringBuilder(String.valueOf(string2).length() + 45);
                stringBuilder.append("IID file exists, but failed to read from it: ");
                stringBuilder.append(string2);
                Log.w((String)"FirebaseInstanceId", (String)stringBuilder.toString());
                throw new zzy(iOException2);
            }
        }
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    private static File zzf(Context context, String string2) {
        if (TextUtils.isEmpty((CharSequence)string2)) {
            string2 = "com.google.InstanceId.properties";
            return new File(zzw.zzb(context), string2);
        }
        try {
            string2 = Base64.encodeToString((byte[])string2.getBytes("UTF-8"), (int)11);
            StringBuilder stringBuilder = new StringBuilder(String.valueOf(string2).length() + 33);
            stringBuilder.append("com.google.InstanceId_");
            stringBuilder.append(string2);
            stringBuilder.append(".properties");
            string2 = stringBuilder.toString();
            return new File(zzw.zzb(context), string2);
        }
        catch (UnsupportedEncodingException unsupportedEncodingException) {
            throw new AssertionError(unsupportedEncodingException);
        }
    }

    @WorkerThread
    final zzx zzb(Context context, String string2) throws zzy {
        zzx zzx2 = this.zzd(context, string2);
        if (zzx2 != null) {
            return zzx2;
        }
        return this.zzc(context, string2);
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    @WorkerThread
    final zzx zzc(Context context, String string2) {
        zzx zzx2;
        zzx2 = new zzx(zza.zzb(), System.currentTimeMillis());
        try {
            zzx zzx3 = this.zzd(context, string2);
            if (zzx3 != null) {
                if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
                    Log.d((String)"FirebaseInstanceId", (String)"Loaded key after generating new one, using loaded one");
                }
                return zzx3;
            }
        }
        catch (zzy zzy2) {}
        if (Log.isLoggable((String)"FirebaseInstanceId", (int)3)) {
            Log.d((String)"FirebaseInstanceId", (String)"Generated new key");
        }
        zzw.zza(context, string2, zzx2);
        this.zzb(context, string2, zzx2);
        return zzx2;
    }
}

