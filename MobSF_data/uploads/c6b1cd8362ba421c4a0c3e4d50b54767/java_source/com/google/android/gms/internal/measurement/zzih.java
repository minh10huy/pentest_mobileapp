/*
 * Decompiled with CFR 0_132.
 * 
 * Could not load the following classes:
 *  android.app.Activity
 *  android.content.Context
 *  android.os.Bundle
 */
package com.google.android.gms.internal.measurement;

import android.app.Activity;
import android.content.Context;
import android.os.Bundle;
import android.support.annotation.MainThread;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.support.annotation.Size;
import android.support.annotation.WorkerThread;
import android.support.v4.util.ArrayMap;
import com.google.android.gms.common.internal.Preconditions;
import com.google.android.gms.common.util.Clock;
import com.google.android.gms.common.util.VisibleForTesting;
import com.google.android.gms.internal.measurement.zzdu;
import com.google.android.gms.internal.measurement.zzdx;
import com.google.android.gms.internal.measurement.zzdz;
import com.google.android.gms.internal.measurement.zzee;
import com.google.android.gms.internal.measurement.zzeh;
import com.google.android.gms.internal.measurement.zzer;
import com.google.android.gms.internal.measurement.zzfd;
import com.google.android.gms.internal.measurement.zzfe;
import com.google.android.gms.internal.measurement.zzfg;
import com.google.android.gms.internal.measurement.zzfi;
import com.google.android.gms.internal.measurement.zzfk;
import com.google.android.gms.internal.measurement.zzft;
import com.google.android.gms.internal.measurement.zzgi;
import com.google.android.gms.internal.measurement.zzgn;
import com.google.android.gms.internal.measurement.zzhm;
import com.google.android.gms.internal.measurement.zzig;
import com.google.android.gms.internal.measurement.zzii;
import com.google.android.gms.internal.measurement.zzij;
import com.google.android.gms.internal.measurement.zzik;
import com.google.android.gms.internal.measurement.zzjj;
import com.google.android.gms.internal.measurement.zzkd;
import java.util.Map;

public final class zzih
extends zzdz {
    @VisibleForTesting
    protected zzig zzaqd;
    private volatile zzig zzaqe;
    private zzig zzaqf;
    private final Map<Activity, zzig> zzaqg = new ArrayMap<Activity, zzig>();
    private zzig zzaqh;
    private String zzaqi;

    public zzih(zzgn zzgn2) {
        super(zzgn2);
    }

    @MainThread
    private final void zza(Activity activity, zzig zzig2, boolean bl) {
        zzig zzig3 = this.zzaqe == null ? this.zzaqf : this.zzaqe;
        zzig zzig4 = zzig2;
        if (zzig2.zzaqa == null) {
            zzig4 = new zzig(zzig2.zzuk, zzih.zzcd(activity.getClass().getCanonicalName()), zzig2.zzaqb);
        }
        this.zzaqf = this.zzaqe;
        this.zzaqe = zzig4;
        this.zzgh().zzc(new zzii(this, bl, zzig3, zzig4));
    }

    @WorkerThread
    private final void zza(@NonNull zzig zzig2) {
        this.zzfx().zzp(this.zzbt().elapsedRealtime());
        if (this.zzgd().zzl(zzig2.zzaqc)) {
            zzig2.zzaqc = false;
        }
    }

    public static void zza(zzig zzig2, Bundle bundle, boolean bl) {
        if (bundle != null && zzig2 != null && (!bundle.containsKey("_sc") || bl)) {
            if (zzig2.zzuk != null) {
                bundle.putString("_sn", zzig2.zzuk);
            } else {
                bundle.remove("_sn");
            }
            bundle.putString("_sc", zzig2.zzaqa);
            bundle.putLong("_si", zzig2.zzaqb);
            return;
        }
        if (bundle != null && zzig2 == null && bl) {
            bundle.remove("_sn");
            bundle.remove("_sc");
            bundle.remove("_si");
        }
    }

    static /* synthetic */ void zza(zzih zzih2, zzig zzig2) {
        zzih2.zza(zzig2);
    }

    @VisibleForTesting
    private static String zzcd(String object) {
        object = ((String[])(object = object.split("\\."))).length > 0 ? object[((String[])object).length - 1] : "";
        Object object2 = object;
        if (object.length() > 100) {
            object2 = object.substring(0, 100);
        }
        return object2;
    }

    @MainThread
    private final zzig zze(@NonNull Activity activity) {
        zzig zzig2;
        Preconditions.checkNotNull(activity);
        zzig zzig3 = zzig2 = this.zzaqg.get((Object)activity);
        if (zzig2 == null) {
            zzig3 = new zzig(null, zzih.zzcd(activity.getClass().getCanonicalName()), this.zzgg().zzln());
            this.zzaqg.put(activity, zzig3);
        }
        return zzig3;
    }

    @MainThread
    public final void onActivityCreated(Activity activity, Bundle object) {
        if (object == null) {
            return;
        }
        if ((object = object.getBundle("com.google.firebase.analytics.screen_service")) == null) {
            return;
        }
        object = new zzig(object.getString("name"), object.getString("referrer_name"), object.getLong("id"));
        this.zzaqg.put(activity, (zzig)object);
    }

    @MainThread
    public final void onActivityDestroyed(Activity activity) {
        this.zzaqg.remove((Object)activity);
    }

    @MainThread
    public final void onActivityPaused(Activity object) {
        object = this.zze((Activity)object);
        this.zzaqf = this.zzaqe;
        this.zzaqe = null;
        this.zzgh().zzc(new zzij(this, (zzig)object));
    }

    @MainThread
    public final void onActivityResumed(Activity object) {
        this.zza((Activity)object, this.zze((Activity)object), false);
        object = this.zzfx();
        long l = object.zzbt().elapsedRealtime();
        object.zzgh().zzc(new zzdx((zzdu)object, l));
    }

    @MainThread
    public final void onActivitySaveInstanceState(Activity object, Bundle bundle) {
        if (bundle == null) {
            return;
        }
        if ((object = this.zzaqg.get(object)) == null) {
            return;
        }
        Bundle bundle2 = new Bundle();
        bundle2.putLong("id", object.zzaqb);
        bundle2.putString("name", object.zzuk);
        bundle2.putString("referrer_name", object.zzaqa);
        bundle.putBundle("com.google.firebase.analytics.screen_service", bundle2);
    }

    @MainThread
    public final void setCurrentScreen(@NonNull Activity activity, @Nullable @Size(max=36L, min=1L) String object, @Nullable @Size(max=36L, min=1L) String object2) {
        if (!zzee.isMainThread()) {
            this.zzgi().zziy().log("setCurrentScreen must be called from the main thread");
            return;
        }
        if (this.zzaqe == null) {
            this.zzgi().zziy().log("setCurrentScreen cannot be called while no activity active");
            return;
        }
        if (this.zzaqg.get((Object)activity) == null) {
            this.zzgi().zziy().log("setCurrentScreen must be called with an activity in the activity lifecycle");
            return;
        }
        String string2 = object2;
        if (object2 == null) {
            string2 = zzih.zzcd(activity.getClass().getCanonicalName());
        }
        boolean bl = this.zzaqe.zzaqa.equals(string2);
        boolean bl2 = zzkd.zzs(this.zzaqe.zzuk, (String)object);
        if (bl && bl2) {
            this.zzgi().zziz().log("setCurrentScreen cannot be called with the same class and name");
            return;
        }
        if (object != null && (object.length() <= 0 || object.length() > 100)) {
            this.zzgi().zziy().zzg("Invalid screen name length in setCurrentScreen. Length", object.length());
            return;
        }
        if (string2 != null && (string2.length() <= 0 || string2.length() > 100)) {
            this.zzgi().zziy().zzg("Invalid class name length in setCurrentScreen. Length", string2.length());
            return;
        }
        zzfk zzfk2 = this.zzgi().zzjc();
        object2 = object == null ? "null" : object;
        zzfk2.zze("Setting current screen to name, class", object2, string2);
        object = new zzig((String)object, string2, this.zzgg().zzln());
        this.zzaqg.put(activity, (zzig)object);
        this.zza(activity, (zzig)object, true);
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    @WorkerThread
    public final void zza(String string2, zzig zzig2) {
        this.zzab();
        synchronized (this) {
            if (this.zzaqi == null || this.zzaqi.equals(string2) || zzig2 != null) {
                this.zzaqi = string2;
                this.zzaqh = zzig2;
            }
            return;
        }
    }

    @Override
    protected final boolean zzgn() {
        return false;
    }

    @WorkerThread
    public final zzig zzkn() {
        this.zzch();
        this.zzab();
        return this.zzaqd;
    }

    public final zzig zzko() {
        this.zzfv();
        return this.zzaqe;
    }
}

