/*
 * Decompiled with CFR 0_132.
 */
package com.itextpdf.text.xml.xmp;

import com.itextpdf.text.ExceptionConverter;
import com.itextpdf.text.xml.XmlDomWriter;
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.NamedNodeMap;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.w3c.dom.Text;
import org.xml.sax.SAXException;

@Deprecated
public class XmpReader {
    public static final String EXTRASPACE = "                                                                                                   \n";
    public static final String XPACKET_PI_BEGIN = "<?xpacket begin=\"\ufeff\" id=\"W5M0MpCehiHzreSzNTczkc9d\"?>\n";
    public static final String XPACKET_PI_END_W = "<?xpacket end=\"w\"?>";
    private Document domDocument;

    public XmpReader(byte[] arrby) throws SAXException, IOException {
        try {
            DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
            documentBuilderFactory.setNamespaceAware(true);
            this.domDocument = documentBuilderFactory.newDocumentBuilder().parse(new ByteArrayInputStream(arrby));
            return;
        }
        catch (ParserConfigurationException parserConfigurationException) {
            throw new ExceptionConverter(parserConfigurationException);
        }
    }

    public boolean add(String object, String object2, String string2, String string3) {
        Object object3 = this.domDocument.getElementsByTagName((String)object);
        if (object3.getLength() == 0) {
            return false;
        }
        for (int i = 0; i < object3.getLength(); ++i) {
            object = object3.item(i);
            NamedNodeMap namedNodeMap = object.getAttributes();
            for (int j = 0; j < namedNodeMap.getLength(); ++j) {
                Node node = namedNodeMap.item(j);
                if (!object2.equals(node.getNodeValue())) continue;
                object3 = node.getLocalName();
                object2 = this.domDocument.createElementNS((String)object2, string2);
                object2.setPrefix((String)object3);
                object2.appendChild(this.domDocument.createTextNode(string3));
                object.appendChild((Node)object2);
                return true;
            }
        }
        return false;
    }

    public boolean replaceDescriptionAttribute(String string2, String string3, String string4) {
        NodeList nodeList = this.domDocument.getElementsByTagNameNS("http://www.w3.org/1999/02/22-rdf-syntax-ns#", "Description");
        if (nodeList.getLength() == 0) {
            return false;
        }
        for (int i = 0; i < nodeList.getLength(); ++i) {
            Node node = nodeList.item(i).getAttributes().getNamedItemNS(string2, string3);
            if (node == null) continue;
            node.setNodeValue(string4);
            return true;
        }
        return false;
    }

    public boolean replaceNode(String object, String object2, String string2) {
        object = this.domDocument.getElementsByTagNameNS((String)object, (String)object2);
        int n = object.getLength();
        if (n == 0) {
            return false;
        }
        for (int i = 0; i < object.getLength(); ++i) {
            object2 = object.item(i);
            this.setNodeText(this.domDocument, (Node)object2, string2);
        }
        return true;
    }

    public byte[] serializeDoc() throws IOException {
        XmlDomWriter xmlDomWriter = new XmlDomWriter();
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        xmlDomWriter.setOutput(byteArrayOutputStream, null);
        byteArrayOutputStream.write(XPACKET_PI_BEGIN.getBytes("UTF-8"));
        byteArrayOutputStream.flush();
        NodeList nodeList = this.domDocument.getElementsByTagName("x:xmpmeta");
        xmlDomWriter.write(nodeList.item(0));
        byteArrayOutputStream.flush();
        for (int i = 0; i < 20; ++i) {
            byteArrayOutputStream.write(EXTRASPACE.getBytes());
        }
        byteArrayOutputStream.write(XPACKET_PI_END_W.getBytes());
        byteArrayOutputStream.close();
        return byteArrayOutputStream.toByteArray();
    }

    public boolean setNodeText(Document document, Node node, String string2) {
        Node node2;
        if (node == null) {
            return false;
        }
        while ((node2 = node.getFirstChild()) != null) {
            node.removeChild(node2);
        }
        node.appendChild(document.createTextNode(string2));
        return true;
    }
}

