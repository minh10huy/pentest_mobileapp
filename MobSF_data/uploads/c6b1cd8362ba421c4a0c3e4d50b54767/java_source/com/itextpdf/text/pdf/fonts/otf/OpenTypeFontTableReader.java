/*
 * Decompiled with CFR 0_132.
 */
package com.itextpdf.text.pdf.fonts.otf;

import com.itextpdf.text.log.Logger;
import com.itextpdf.text.log.LoggerFactory;
import com.itextpdf.text.pdf.RandomAccessFileOrArray;
import com.itextpdf.text.pdf.fonts.otf.FontReadingException;
import com.itextpdf.text.pdf.fonts.otf.Language;
import com.itextpdf.text.pdf.fonts.otf.TableHeader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.Set;

public abstract class OpenTypeFontTableReader {
    protected static final Logger LOG = LoggerFactory.getLogger(OpenTypeFontTableReader.class);
    protected final RandomAccessFileOrArray rf;
    private List<String> supportedLanguages;
    protected final int tableLocation;

    public OpenTypeFontTableReader(RandomAccessFileOrArray randomAccessFileOrArray, int n) throws IOException {
        this.rf = randomAccessFileOrArray;
        this.tableLocation = n;
    }

    private void readFeatureListTable(int n) throws IOException {
        this.rf.seek(n);
        int n2 = this.rf.readShort();
        Object object = LOG;
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.append("featureCount=");
        stringBuilder.append(n2);
        object.debug(stringBuilder.toString());
        object = new LinkedHashMap(n2);
        for (int i = 0; i < n2; ++i) {
            object.put(this.rf.readString(4, "utf-8"), this.rf.readShort());
        }
        for (String string2 : object.keySet()) {
            Logger logger = LOG;
            StringBuilder stringBuilder2 = new StringBuilder();
            stringBuilder2.append("*************featureName=");
            stringBuilder2.append(string2);
            logger.debug(stringBuilder2.toString());
            this.readFeatureTable((Short)object.get(string2) + n);
        }
    }

    private void readFeatureTable(int n) throws IOException {
        this.rf.seek(n);
        n = this.rf.readShort();
        Object object = LOG;
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.append("featureParamsOffset=");
        stringBuilder.append(n);
        object.debug(stringBuilder.toString());
        int n2 = this.rf.readShort();
        object = LOG;
        stringBuilder = new StringBuilder();
        stringBuilder.append("lookupCount=");
        stringBuilder.append(n2);
        object.debug(stringBuilder.toString());
        object = new ArrayList(n2);
        for (n = 0; n < n2; ++n) {
            object.add(this.rf.readShort());
        }
    }

    private TableHeader readHeader() throws IOException {
        this.rf.seek(this.tableLocation);
        return new TableHeader(this.rf.readInt(), this.rf.readUnsignedShort(), this.rf.readUnsignedShort(), this.rf.readUnsignedShort());
    }

    private void readLangSysRecord(Map<String, Integer> map) throws IOException {
        map.put(this.rf.readString(4, "utf-8"), Integer.valueOf(this.rf.readShort()));
    }

    private void readLangSysTable(int n) throws IOException {
        this.rf.seek(n);
        n = this.rf.readShort();
        Object object = LOG;
        Object object2 = new StringBuilder();
        object2.append("lookupOrderOffset=");
        object2.append(n);
        object.debug(object2.toString());
        n = this.rf.readShort();
        object = LOG;
        object2 = new StringBuilder();
        object2.append("reqFeatureIndex=");
        object2.append(n);
        object.debug(object2.toString());
        int n2 = this.rf.readShort();
        object = new ArrayList(n2);
        for (n = 0; n < n2; ++n) {
            object.add(this.rf.readShort());
        }
        object2 = LOG;
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.append("featureListIndices=");
        stringBuilder.append(object);
        object2.debug(stringBuilder.toString());
    }

    private void readLookupListTable(int n) throws IOException {
        this.rf.seek(n);
        int n2 = this.rf.readShort();
        ArrayList<Integer> arrayList = new ArrayList<Integer>();
        int n3 = 0;
        int n4 = 0;
        do {
            if (n4 >= n2) break;
            arrayList.add(Integer.valueOf(this.rf.readShort()));
            ++n4;
        } while (true);
        for (int i = n3; i < n2; ++i) {
            this.readLookupTable((Integer)arrayList.get(i) + n);
        }
    }

    private void readLookupTable(int n) throws IOException {
        this.rf.seek(n);
        short s = this.rf.readShort();
        this.rf.skipBytes(2);
        int n2 = this.rf.readShort();
        Object object = new ArrayList<Integer>();
        for (int i = 0; i < n2; ++i) {
            object.add(Integer.valueOf(this.rf.readShort()));
        }
        object = object.iterator();
        while (object.hasNext()) {
            this.readSubTable(s, (Integer)object.next() + n);
        }
    }

    private void readRangeRecord(List<Integer> list) throws IOException {
        short s = this.rf.readShort();
        this.rf.readShort();
        for (int i = this.rf.readShort(); i <= s; ++i) {
            list.add(i);
        }
    }

    private void readScriptListTable(int n) throws IOException {
        this.rf.seek(n);
        int n2 = this.rf.readShort();
        HashMap<String, Integer> hashMap = new HashMap<String, Integer>(n2);
        for (int i = 0; i < n2; ++i) {
            this.readScriptRecord(n, hashMap);
        }
        ArrayList<String> arrayList = new ArrayList<String>(n2);
        for (String string2 : hashMap.keySet()) {
            this.readScriptTable(hashMap.get(string2));
            arrayList.add(string2);
        }
        this.supportedLanguages = Collections.unmodifiableList(arrayList);
    }

    private void readScriptRecord(int n, Map<String, Integer> map) throws IOException {
        map.put(this.rf.readString(4, "utf-8"), n + this.rf.readShort());
    }

    private void readScriptTable(int n) throws IOException {
        this.rf.seek(n);
        short s = this.rf.readShort();
        int n2 = this.rf.readShort();
        if (n2 > 0) {
            LinkedHashMap<String, Integer> linkedHashMap = new LinkedHashMap<String, Integer>(n2);
            for (int i = 0; i < n2; ++i) {
                this.readLangSysRecord(linkedHashMap);
            }
            Iterator iterator = linkedHashMap.keySet().iterator();
            while (iterator.hasNext()) {
                this.readLangSysTable(linkedHashMap.get((String)iterator.next()) + n);
            }
        }
        this.readLangSysTable(n + s);
    }

    public Language getSupportedLanguage() throws FontReadingException {
        Object object = Language.values();
        for (String string2 : this.supportedLanguages) {
            for (Object object2 : object) {
                if (!object2.isSupported(string2)) continue;
                return object2;
            }
        }
        object = new StringBuilder();
        object.append("Unsupported languages ");
        object.append(this.supportedLanguages);
        throw new FontReadingException(object.toString());
    }

    /*
     * Enabled force condition propagation
     * Lifted jumps to return sites
     */
    protected final List<Integer> readCoverageFormat(int n) throws IOException {
        ArrayList<Integer> arrayList;
        this.rf.seek(n);
        short s = this.rf.readShort();
        short s2 = 0;
        n = 0;
        if (s == 1) {
            s2 = this.rf.readShort();
            ArrayList<Integer> arrayList2 = new ArrayList<Integer>(s2);
            do {
                arrayList = arrayList2;
                if (n >= s2) return Collections.unmodifiableList(arrayList);
                arrayList2.add(Integer.valueOf(this.rf.readShort()));
                ++n;
            } while (true);
        }
        if (s == 2) {
            s = this.rf.readShort();
            ArrayList<Integer> arrayList3 = new ArrayList<Integer>();
            n = s2;
            do {
                arrayList = arrayList3;
                if (n >= s) return Collections.unmodifiableList(arrayList);
                this.readRangeRecord(arrayList3);
                ++n;
            } while (true);
        }
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.append("Invalid coverage format: ");
        stringBuilder.append(s);
        throw new UnsupportedOperationException(stringBuilder.toString());
    }

    protected abstract void readSubTable(int var1, int var2) throws IOException;

    protected final void startReadingTable() throws FontReadingException {
        try {
            TableHeader tableHeader = this.readHeader();
            this.readScriptListTable(this.tableLocation + tableHeader.scriptListOffset);
            this.readFeatureListTable(this.tableLocation + tableHeader.featureListOffset);
            this.readLookupListTable(this.tableLocation + tableHeader.lookupListOffset);
            return;
        }
        catch (IOException iOException) {
            throw new FontReadingException("Error reading font file", iOException);
        }
    }
}

