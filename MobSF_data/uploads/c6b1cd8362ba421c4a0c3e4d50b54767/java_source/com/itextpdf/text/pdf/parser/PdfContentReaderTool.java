/*
 * Decompiled with CFR 0_132.
 */
package com.itextpdf.text.pdf.parser;

import com.itextpdf.text.pdf.PdfDictionary;
import com.itextpdf.text.pdf.PdfName;
import com.itextpdf.text.pdf.PdfNumber;
import com.itextpdf.text.pdf.PdfObject;
import com.itextpdf.text.pdf.PdfReader;
import com.itextpdf.text.pdf.PdfStream;
import com.itextpdf.text.pdf.RandomAccessFileOrArray;
import com.itextpdf.text.pdf.parser.ContentByteUtils;
import com.itextpdf.text.pdf.parser.LocationTextExtractionStrategy;
import com.itextpdf.text.pdf.parser.PdfTextExtractor;
import java.io.ByteArrayInputStream;
import java.io.Closeable;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.io.PrintStream;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.Set;

public class PdfContentReaderTool {
    public static String getDictionaryDetail(PdfDictionary pdfDictionary) {
        return PdfContentReaderTool.getDictionaryDetail(pdfDictionary, 0);
    }

    public static String getDictionaryDetail(PdfDictionary pdfDictionary, int n) {
        StringBuffer stringBuffer = new StringBuffer();
        stringBuffer.append('(');
        Object object = new ArrayList();
        for (PdfName pdfName : pdfDictionary.getKeys()) {
            PdfObject pdfObject = pdfDictionary.getDirectObject(pdfName);
            if (pdfObject.isDictionary()) {
                object.add(pdfName);
            }
            stringBuffer.append(pdfName);
            stringBuffer.append('=');
            stringBuffer.append(pdfObject);
            stringBuffer.append(", ");
        }
        if (stringBuffer.length() >= 2) {
            stringBuffer.setLength(stringBuffer.length() - 2);
        }
        stringBuffer.append(')');
        object = object.iterator();
        while (object.hasNext()) {
            int n2;
            PdfName pdfName = (PdfName)object.next();
            stringBuffer.append('\n');
            for (int i = 0; i < (n2 = n + 1); ++i) {
                stringBuffer.append('\t');
            }
            stringBuffer.append("Subdictionary ");
            stringBuffer.append(pdfName);
            stringBuffer.append(" = ");
            stringBuffer.append(PdfContentReaderTool.getDictionaryDetail(pdfDictionary.getAsDict(pdfName), n2));
        }
        return stringBuffer.toString();
    }

    public static String getXObjectDetail(PdfDictionary pdfDictionary) throws IOException {
        StringBuilder stringBuilder = new StringBuilder();
        if ((pdfDictionary = pdfDictionary.getAsDict(PdfName.XOBJECT)) == null) {
            return "No XObjects";
        }
        for (PdfName pdfName : pdfDictionary.getKeys()) {
            int n;
            PdfStream pdfStream = pdfDictionary.getAsStream(pdfName);
            Object object = new StringBuilder();
            object.append("------ ");
            object.append(pdfName);
            object.append(" - subtype = ");
            object.append(pdfStream.get(PdfName.SUBTYPE));
            object.append(" = ");
            object.append(pdfStream.getAsNumber(PdfName.LENGTH));
            object.append(" bytes ------\n");
            stringBuilder.append(object.toString());
            if (pdfStream.get(PdfName.SUBTYPE).equals(PdfName.IMAGE)) continue;
            object = new ByteArrayInputStream(ContentByteUtils.getContentBytesFromContentObject(pdfStream));
            while ((n = object.read()) != -1) {
                stringBuilder.append((char)n);
            }
            object = new StringBuilder();
            object.append("------ ");
            object.append(pdfName);
            object.append(" - subtype = ");
            object.append(pdfStream.get(PdfName.SUBTYPE));
            object.append("End of Content");
            object.append("------\n");
            stringBuilder.append(object.toString());
        }
        return stringBuilder.toString();
    }

    public static void listContentStream(File file, int n, PrintWriter printWriter) throws IOException {
        PdfContentReaderTool.listContentStreamForPage(new PdfReader(file.getCanonicalPath()), n, printWriter);
    }

    public static void listContentStream(File object, PrintWriter printWriter) throws IOException {
        object = new PdfReader(object.getCanonicalPath());
        int n = object.getNumberOfPages();
        for (int i = 1; i <= n; ++i) {
            PdfContentReaderTool.listContentStreamForPage((PdfReader)object, i, printWriter);
        }
    }

    public static void listContentStreamForPage(PdfReader object, int n, PrintWriter printWriter) throws IOException {
        int n2;
        Object object2 = new StringBuilder();
        object2.append("==============Page ");
        object2.append(n);
        object2.append("====================");
        printWriter.println(object2.toString());
        printWriter.println("- - - - - Dictionary - - - - - -");
        object2 = object.getPageN(n);
        printWriter.println(PdfContentReaderTool.getDictionaryDetail((PdfDictionary)object2));
        printWriter.println("- - - - - XObject Summary - - - - - -");
        printWriter.println(PdfContentReaderTool.getXObjectDetail(object2.getAsDict(PdfName.RESOURCES)));
        printWriter.println("- - - - - Content Stream - - - - - -");
        object2 = object.getSafeFile();
        byte[] arrby = object.getPageContent(n, (RandomAccessFileOrArray)object2);
        object2.close();
        printWriter.flush();
        object2 = new ByteArrayInputStream(arrby);
        while ((n2 = object2.read()) != -1) {
            printWriter.print((char)n2);
        }
        printWriter.flush();
        printWriter.println("- - - - - Text Extraction - - - - - -");
        object = PdfTextExtractor.getTextFromPage((PdfReader)object, n, new LocationTextExtractionStrategy());
        if (object.length() != 0) {
            printWriter.println((String)object);
        } else {
            object = new StringBuilder();
            object.append("No text found on page ");
            object.append(n);
            printWriter.println(object.toString());
        }
        printWriter.println();
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    public static void main(String[] arrstring) {
        try {
            if (arrstring.length >= 1 && arrstring.length <= 3) {
                Appendable appendable = new PrintWriter(System.out);
                Closeable closeable = appendable;
                if (arrstring.length >= 2) {
                    closeable = appendable;
                    if (arrstring[1].compareToIgnoreCase("stdout") != 0) {
                        closeable = System.out;
                        appendable = new StringBuilder();
                        appendable.append("Writing PDF content to ");
                        appendable.append(arrstring[1]);
                        closeable.println(appendable.toString());
                        closeable = new PrintWriter(new FileOutputStream(new File(arrstring[1])));
                    }
                }
                int n = arrstring.length >= 3 ? Integer.parseInt(arrstring[2]) : -1;
                if (n == -1) {
                    PdfContentReaderTool.listContentStream(new File(arrstring[0]), (PrintWriter)closeable);
                } else {
                    PdfContentReaderTool.listContentStream(new File(arrstring[0]), n, (PrintWriter)closeable);
                }
                closeable.flush();
                if (arrstring.length < 2) return;
                {
                    closeable.close();
                    closeable = System.out;
                    appendable = new StringBuilder();
                    appendable.append("Finished writing content to ");
                    appendable.append(arrstring[1]);
                    closeable.println(appendable.toString());
                    return;
                }
            }
            System.out.println("Usage:  PdfContentReaderTool <pdf file> [<output file>|stdout] [<page num>]");
            return;
        }
        catch (Exception exception) {
            exception.printStackTrace(System.err);
        }
    }
}

